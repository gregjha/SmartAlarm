if (self.CavalryLogger) { CavalryLogger.start_js(["J3rDU"]); }

__d("TypingDetector",["ArbiterMixin","Event","Input","Run","SubscriptionsHandler","TypingStates","createObjectFrom","emptyFunction"],(function a(b,c,d,e,f,g){__p&&__p();function h(i,j){this._input=i;this._ignoreKeys={};this._getValueFn=j}Object.assign(h.prototype,c("ArbiterMixin"),{_timeout:7e3,_currentState:c("TypingStates").INACTIVE,init:function i(){this.init=c("emptyFunction");this.reset();this._subscriptions=new(c("SubscriptionsHandler"))();this._subscriptions.addSubscriptions(c("Event").listen(this._input,"keyup",this._update.bind(this)),c("Run").onUnload(this._onunload.bind(this)))},reset:function i(){clearTimeout(this._checkTimer);this._checkTimer=null;this._lastKeystrokeAt=null;this._currentState=c("TypingStates").INACTIVE},setIgnoreKeys:function i(j){this._ignoreKeys=c("createObjectFrom")(j)},destroy:function i(){this._subscriptions.release()},_onunload:function i(){if(this._currentState==c("TypingStates").TYPING)this._transition(c("TypingStates").QUITTING)},_update:function i(event){__p&&__p();var j=c("Event").getKeyCode(event),k=this._currentState;if(!this._ignoreKeys[j]){var l=this._getValueFn?this._getValueFn():c("Input").getValue(this._input);if(l.trim().length===0){if(k==c("TypingStates").TYPING)this._transition(c("TypingStates").INACTIVE)}else if(k==c("TypingStates").TYPING)this._recordKeystroke();else if(k==c("TypingStates").INACTIVE){this._transition(c("TypingStates").TYPING);this._recordKeystroke()}}},_transition:function i(j){this.reset();this._currentState=j;this.inform("change",j)},_recordKeystroke:function i(){this._lastKeystrokeTime=Date.now();if(!this._checkTimer)this._checkTimer=setTimeout(this._checkTyping.bind(this),this._timeout)},_checkTyping:function i(){var j=this._lastKeystrokeTime+this._timeout,k=Date.now();if(k>j)this._transition(c("TypingStates").INACTIVE);else{clearTimeout(this._checkTimer);this._checkTimer=setTimeout(this._checkTyping.bind(this),j-k+10)}}});f.exports=h}),null);