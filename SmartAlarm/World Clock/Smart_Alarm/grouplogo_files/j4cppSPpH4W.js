if (self.CavalryLogger) { CavalryLogger.start_js(["txlNg"]); }

__d("MercurySyncClientPayloadTransformer",["DateConsts","LiveLocationStopReason","MercuryActionType","MercuryIDs","MessageLiveLocationClientSyncProtocolStopReason","PageCommItemStatus","keyMirror"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("keyMirror")(c("LiveLocationStopReason")),i=8;function j(q){__p&&__p();var r=q.payload;r=JSON.parse(String.fromCharCode.apply(null,r));var s=r&&r.deltas,t=s[0];if(t.deltaMessageReaction)return l(t.deltaMessageReaction);else if(t.liveLocationData)return n(t.liveLocationData);else if(t.deltaUpdateGroupEventRSVPStatus){var u=t.deltaUpdateGroupEventRSVPStatus;return m(u)}else if(t.deltaPageThreadFollowUpData)return p(t.deltaPageThreadFollowUpData);else if(t.deltaChangeViewerStatus)return k(t.deltaChangeViewerStatus);else return o(t)}function k(q){var r=q.actorFbid,s=q.canViewerReply,t=q.reason,u=q.threadKey,v=c("MercuryIDs").getParticipantIDFromUserID(u.otherUserFbId);return{action_type:c("MercuryActionType").BLOCK_STATUS_CHANGED,actorFbid:r,canViewerReply:s,reason:t,message_blocked_ids:[v],other_user_fbid:u.otherUserFbId.toString()}}function l(q){var r=q.messageId,s=q.offlineThreadingId,t=q.reaction,u=q.senderId,v=q.userId,w=q.threadKey.threadFbId||q.threadKey.otherUserFbId;return{action_type:c("MercuryActionType").REACTION_UPDATE,messageId:r,offlineThreadingId:s,reaction:t,senderId:u,thread_fbid:w.toString(),userId:v}}function m(q){var r=q.threadKey&&q.threadKey.threadFbId;if(!r)return null;var s=q.actorFbId,t=q.rsvpStatus;if(!s)return null;return{action_type:c("MercuryActionType").EVENT_RSVP_CHANGED,thread_fbid:r.toString(),actor_fbid:s.toString(),rsvp_status:t}}function n(q){__p&&__p();var r=q.threadKey;if(!r)return null;var s=r.threadFbId||r.otherUserFbId;if(!s)return null;if(!q.messageLiveLocations||q.messageLiveLocations.length!==1)return null;var t=q.messageLiveLocations[0],u=t.expirationTime,v=t.stopReason!=null||Date.now()/c("DateConsts").MS_PER_SEC>u,w=function w(A){return A/Math.pow(10,i)},x=t.coordinate?{latitude:w(t.coordinate.latitude),longitude:w(t.coordinate.longitude)}:null,y=null;if(t.destination)y={latitude:w(t.destination.latitude),longitude:w(t.destination.longitude),label:t.destination.label};var z=null;switch(t.stopReason){case c("MessageLiveLocationClientSyncProtocolStopReason").EXPIRED:z=h.EXPIRED;break;case c("MessageLiveLocationClientSyncProtocolStopReason").CANCELED:z=h.CANCELED;break;case c("MessageLiveLocationClientSyncProtocolStopReason").ARRIVED:z=h.ARRIVED;break}return{action_type:c("MercuryActionType").LIVE_LOCATION_UPDATE,thread_fbid:s.toString(),messageId:t.messageId,liveLocation:{live_location_id:t.id.toString(),is_expired:v,expiration_time:u,sender:{id:t.senderId.toString()},coordinate:x,location_title:t.locationTitle,sender_destination:y,stop_reason:z}}}function o(q){var r=q&&q.deltaPaymentPinProtectionStatusData,s=r&&r.threadKey&&r.threadKey.otherUserFbId,t=r&&r.isPinProtected;if(!s)return null;var u=s.toString();return{action_type:c("MercuryActionType").IS_PIN_PROTECTED,thread_fbid:u,is_pin_protected:t}}function p(q){var r=q.threadKey.otherUserFbId;return{action_type:c("MercuryActionType").UPDATE_COMM_STATUS,comm_status:q.isFollowUp?c("PageCommItemStatus").FOLLOW_UP:c("PageCommItemStatus").TODO,thread_fbid:r.toString()}}f.exports={transform:j}}),null);