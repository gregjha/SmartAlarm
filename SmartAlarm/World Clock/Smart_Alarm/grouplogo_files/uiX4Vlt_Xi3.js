if (self.CavalryLogger) { CavalryLogger.start_js(["ywyA7"]); }

__d("ChatPhotoUploader.react",["cx","fbt","Promise","Bootloader","ifRequired","InlineBlock.react","Link.react","MercuryConfig","MessengerEnvironment","React","ReactDOM","SubscriptionsHandler","emptyFunction","gkx","joinClasses"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j=c("React").PropTypes,k=c("React").createClass({displayName:"ChatPhotoUploader",_uploader:null,_uploaderPromiseIsResolving:false,_uploaderPromise:null,_subscriptions:null,propTypes:{actionURI:j.string,allowCrossPage:j.bool,customUI:j.bool,disabled:j.bool,imageClassName:j.string,imagesOnly:j.bool,inputClassname:j.string,linkClassName:j.string,threadID:j.string,focusInput:j.func,onSubmit:j.func,onAllUploadsComplete:j.func,onLastUploadFail:j.func,onLastUploadCancel:j.func,onMount:j.func,onUploadError:j.func},getDefaultProps:function l(){return{actionURI:c("MercuryConfig").upload_url,allowCrossPage:true,costomUI:false,disabled:false,imageClassName:"_509w",imagesOnly:true,linkClassName:"",onSubmit:c("emptyFunction"),onAllUploadsComplete:c("emptyFunction"),onLastUploadFail:c("emptyFunction"),onLastUploadCancel:c("emptyFunction")}},shouldComponentUpdate:function l(m){return m.actionURI!=this.props.actionURI||m.disabled!==this.props.disabled},componentDidMount:function l(){if(this.props.onMount)this.props.onMount(this);if(c("gkx")("AT5V6GuV7OE1f4CNmq1NUhZOeDrgnZF-AQ7WoOvZA8jFMJsYzyghwU79Bm31vgH-mi9DAlUGSFnfYvhwjhMfTolYEEzHhgUrhLD2UxTqbooHHw"))c("MessengerEnvironment").messengerui?c("Bootloader").loadModules(["MessengerActions"],c("emptyFunction"),"ChatPhotoUploader.react"):c("Bootloader").loadModules(["FantaMessageActions"],c("emptyFunction"),"ChatPhotoUploader.react")},componentDidUpdate:function l(m){if(this._uploader)this._uploader.setAllowCrossPage(this.props.allowCrossPage)},componentWillUnmount:function l(){if(!this.isUploading()||!this.props.allowCrossPage)this._cleanup()},render:function l(){var m=this.props.imagesOnly?i._("Add Photos"):i._("Add Files"),n=c("joinClasses")("_4q61"+(!this.props.customUI?" _5f0v":"")+(!this.props.customUI?" _509v":""),this.props.linkClassName),o=c("gkx")("AT5V6GuV7OE1f4CNmq1NUhZOeDrgnZF-AQ7WoOvZA8jFMJsYzyghwU79Bm31vgH-mi9DAlUGSFnfYvhwjhMfTolYEEzHhgUrhLD2UxTqbooHHw");return c("React").createElement("form",{action:this.props.actionURI,className:"_vzk",title:m,method:"post",onClick:function(p){p.stopPropagation();if(this.props.disabled)p.preventDefault()}.bind(this),ref:"form"},c("React").createElement("input",{type:"hidden",name:"attach_id",ref:"attachID"}),c("React").createElement("input",{type:"hidden",name:"images_only",value:this.props.imagesOnly}),c("React").createElement(c("InlineBlock.react"),{onClick:o?c("emptyFunction"):this._bootloadChatAutoSendPhotoUploader,className:c("joinClasses")(this.props.className,"_m _4q60 _3rzn")},c("React").createElement("input",{disabled:this.props.disabled,type:"file",className:c("joinClasses")(this.props.inputClassname,"_n _2__f"),name:"attachment[]",multiple:"true",accept:this.props.imagesOnly?"image/*":"*",ref:"input",title:m,onChange:o?function(event){this._handleInputOnChange(event,this.props.threadID)}.bind(this):c("emptyFunction")}),c("React").createElement(c("Link.react"),{className:n,tabIndex:-1},c("React").createElement("i",{className:this.props.imageClassName,alt:i._("Camera")}))))},_handleInputOnChange:function l(event,m){c("MessengerEnvironment").messengerui?c("ifRequired")("MessengerActions",function(n){return n.prepareFilesForSend(m,event.target.files)},function(){c("Bootloader").loadModules(["MessengerActions"],function(n){n.prepareFilesForSend(m,event.target.files)},"ChatPhotoUploader.react")}):c("ifRequired")("FantaMessageActions",function(n){return n.prepareFilesForSend(this.props.threadID,event.target.files)}.bind(this),function(){c("Bootloader").loadModules(["FantaMessageActions"],function(n){n.prepareFilesForSend(this.props.threadID,event.target.files)}.bind(this),"ChatPhotoUploader.react")}.bind(this));this.props.focusInput&&this.props.focusInput()},_handleSubmit:function l(m,n){this.props.onSubmit&&this.props.onSubmit(m,n)},_handleAllUploadsCompleted:function l(m,n){this.props.onAllUploadsComplete&&this.props.onAllUploadsComplete(m,n);if(!this.isMounted())this._cleanup()},_handleLastUploadFailed:function l(m,n){this.props.onLastUploadFail&&this.props.onLastUploadFail(m,n);if(!this.isMounted())this._cleanup()},_handleLastUploadCanceled:function l(m,n){this.props.onLastUploadCancel&&this.props.onLastUploadCancel(m,n);if(!this.isMounted())this._cleanup()},_handleUploadError:function l(m,n){this.props.onUploadError&&this.props.onUploadError(n);if(!this.isMounted())this._cleanup()},isUploading:function l(){return this._uploader&&this._uploader.isUploading()||this._uploaderPromiseIsResolving},_bootloadChatAutoSendPhotoUploader:function l(){__p&&__p();if(!this._uploaderPromise){this._uploaderPromiseIsResolving=true;this._uploaderPromise=new(c("Promise"))(function(m){c("Bootloader").loadModules(["ChatAutoSendPhotoUploader"],function(n){this._uploaderPromiseIsResolving=false;var o=new n(c("ReactDOM").findDOMNode(this.refs.form),c("ReactDOM").findDOMNode(this.refs.input),c("ReactDOM").findDOMNode(this.refs.attachID),c("MercuryConfig").msgr_region);o.setAllowCrossPage(this.props.allowCrossPage);var p=new(c("SubscriptionsHandler"))();p.addSubscriptions(o.subscribe("submit",this._handleSubmit),o.subscribe("all-uploads-completed",this._handleAllUploadsCompleted),o.subscribe("last-upload-failed",this._handleLastUploadFailed),o.subscribe("last-upload-canceled",this._handleLastUploadCanceled),o.subscribe("file-upload-error",this._handleUploadError));this._subscriptions=p;this._uploader=o;m(this._uploader)}.bind(this),"ChatPhotoUploader.react")}.bind(this))}return this._uploaderPromise},uploadFiles:function l(m){this._bootloadChatAutoSendPhotoUploader().then(function(n){n.uploadFiles(m)}).done()},uploadURL:function l(m){this._bootloadChatAutoSendPhotoUploader().then(function(n){n.uploadURL(m)}).done()},_cleanup:function l(){this._subscriptions&&this._subscriptions.release();this._uploader&&this._uploader.destroy()}});f.exports=k}),null);