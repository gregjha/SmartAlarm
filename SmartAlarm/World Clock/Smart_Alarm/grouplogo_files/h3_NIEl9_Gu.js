if (self.CavalryLogger) { CavalryLogger.start_js(["kjzh\/"]); }

__d("FBRTCCallConstants",[],(function a(b,c,d,e,f,g){f.exports={FBRTCCallConnectionType:{MISSED_CALL:4,CONNECTED_CALL:5},FBRTCCallType:{VOICE_CALL:1,VIDEO_CALL:2,COLLAB_VIDEO_CALL:3,COLLAB_SCREEN_SHARE_CALL:4}}}),null);
__d("FBRTCCapability",[],(function a(b,c,d,e,f,g){f.exports={SUPPORT_AUDIO_DEPRECATED:0,SUPPORT_VIDEO_DEPRECATED:1,SUPPORT_EXPERIMENTS_IN_JOIN_RESPONSE:2,SUPPORT_NEW_PARTICIPANT_STATES:3,SUPPORT_SDP_RENEGOTIATION:4}}),null);
__d("FBRTCDeviceStatus",[],(function a(b,c,d,e,f,g){f.exports={OK:0,NOT_SUPPORTED:1,IN_ANOTHER_CALL:10}}),null);
__d("FBRTCMediaType",[],(function a(b,c,d,e,f,g){f.exports={AUDIO:0,VIDEO:1,DATA:2}}),null);
__d("FBRTCMessageType",[],(function a(b,c,d,e,f,g){f.exports={JOIN:0,SERVER_MEDIA_UPDATE:1,HANGUP:2,ICE_CANDIDATE:3,RING:4,DISMISS:5,CONFERENCE_STATE:6,ADD_PARTICIPANTS:7,SUBSCRIPTION:8,CLIENT_MEDIA_UPDATE:9,DATA_MESSAGE:10,REMOVE_PARTICIPANTS:11,EXPERIMENT:12,CONNECT:16,APPROVAL:17}}),null);
__d("FBRTCRingType",[],(function a(b,c,d,e,f,g){f.exports={GROUP_AUDIO_CALL:0,PEER_VIDEO_CALL:1,PEER_AUDIO_CALL:2,GROUP_VIDEO_CALL:3,LIVE_STREAM:4,PEER_ESCALATED_VIDEO_CALL:5,PEER_ESCALATED_AUDIO_CALL:6}}),null);
__d("FBRTCVideoQuality",[],(function a(b,c,d,e,f,g){f.exports={LOW:0,MEDIUM:1,HIGH:2,HD:3}}),null);
__d("BonfireLoggingPage",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({BONFIRE_PAGE_LOGIN:"bonfire_page_login",BONFIRE_PAGE_BONFIRE:"bonfire_page_bonfire"})}),null);
__d("BonfireLocalStorage",["BonfireLoggingPage","immutable","WebStorage","uuid"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=1e3*60*5,i="bonfire_session_id",j="bonfire_session_activity_time",k="bonfire_device_id",l="bonfire_page",m=c("immutable").Set(Object.values(c("BonfireLoggingPage")));function n(){this.$BonfireLocalStorage1=this.$BonfireLocalStorage4()||this.$BonfireLocalStorage5();this.$BonfireLocalStorage2=this.$BonfireLocalStorage6();this.$BonfireLocalStorage3=this.$BonfireLocalStorage7()}n.prototype.$BonfireLocalStorage5=function(){var o={sessionID:c("uuid")(),lastSessionActivityTime:Date.now()},p=c("WebStorage").getSessionStorage();if(p){p.setItem(i,o.sessionID);p.setItem(j,String(o.lastSessionActivityTime))}return o};n.prototype.$BonfireLocalStorage6=function(){var o=c("WebStorage").getLocalStorage(),p=o&&o.getItem(k);if(typeof p==="string")return p;else{var q=c("uuid")();o&&o.setItem(k,q);return q}};n.prototype.$BonfireLocalStorage4=function(){var o=c("WebStorage").getSessionStorageForRead(),p=o&&o.getItem(i),q=o&&Number(o.getItem(j));return typeof p==="string"&&q?{sessionID:p,lastSessionActivityTime:q}:null};n.prototype.$BonfireLocalStorage8=function(){var o=Date.now(),p=c("WebStorage").getSessionStorage(),q=o-h;if(this.$BonfireLocalStorage1.lastSessionActivityTime<q)return this.$BonfireLocalStorage5().sessionID;else{this.$BonfireLocalStorage1.lastSessionActivityTime=o;p&&p.setItem(j,String(o));return this.$BonfireLocalStorage1.sessionID}};n.prototype.getSessionID=function(){return this.$BonfireLocalStorage8()};n.prototype.getDeviceID=function(){return this.$BonfireLocalStorage2};n.prototype.$BonfireLocalStorage7=function(){var o=c("WebStorage").getSessionStorageForRead(),p=o&&o.getItem(l);return m.contains(p)?p:null};n.prototype.getPage=function(){return this.$BonfireLocalStorage3};n.prototype.setPage=function(o){this.$BonfireLocalStorage3=o;var p=c("WebStorage").getSessionStorage();if(p)if(o)p.setItem(l,o);else p.removeItem(l)};f.exports=new n()}),null);
__d("BonfireUserActionsTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(){this.clear()}h.prototype.log=function(){c("GeneratedLoggerUtils").log("logger:BonfireUserActionsLoggerConfig",this.$BonfireUserActionsTypedLogger1,c("Banzai").BASIC)};h.prototype.logVital=function(){c("GeneratedLoggerUtils").log("logger:BonfireUserActionsLoggerConfig",this.$BonfireUserActionsTypedLogger1,c("Banzai").VITAL)};h.prototype.clear=function(){this.$BonfireUserActionsTypedLogger1={};return this};h.prototype.updateData=function(j){this.$BonfireUserActionsTypedLogger1=babelHelpers["extends"]({},this.$BonfireUserActionsTypedLogger1,j);return this};h.prototype.setBonfireID=function(j){this.$BonfireUserActionsTypedLogger1.bonfire_id=j;return this};h.prototype.setClientTime=function(j){this.$BonfireUserActionsTypedLogger1.client_time=j;return this};h.prototype.setComponent=function(j){this.$BonfireUserActionsTypedLogger1.component=j;return this};h.prototype.setDeviceID=function(j){this.$BonfireUserActionsTypedLogger1.device_id=j;return this};h.prototype.setDuration=function(j){this.$BonfireUserActionsTypedLogger1.duration=j;return this};h.prototype.setErrorDomain=function(j){this.$BonfireUserActionsTypedLogger1.error_domain=j;return this};h.prototype.setErrorType=function(j){this.$BonfireUserActionsTypedLogger1.error_type=j;return this};h.prototype.setEvent=function(j){this.$BonfireUserActionsTypedLogger1.event=j;return this};h.prototype.setExpectedParticipantCount=function(j){this.$BonfireUserActionsTypedLogger1.expected_participant_count=j;return this};h.prototype.setPage=function(j){this.$BonfireUserActionsTypedLogger1.page=j;return this};h.prototype.setParticipantCount=function(j){this.$BonfireUserActionsTypedLogger1.participant_count=j;return this};h.prototype.setSessionID=function(j){this.$BonfireUserActionsTypedLogger1.session_id=j;return this};h.prototype.setSurface=function(j){this.$BonfireUserActionsTypedLogger1.surface=j;return this};h.prototype.setVC=function(j){this.$BonfireUserActionsTypedLogger1.vc=j;return this};h.prototype.updateExtraData=function(j){j=c("nullthrows")(c("GeneratedLoggerUtils").serializeMap(j));c("GeneratedLoggerUtils").checkExtraDataFieldNames(j,i);this.$BonfireUserActionsTypedLogger1=babelHelpers["extends"]({},this.$BonfireUserActionsTypedLogger1,j);return this};h.prototype.addToExtraData=function(j,k){var l={};l[j]=k;return this.updateExtraData(l)};var i={bonfire_id:true,client_time:true,component:true,device_id:true,duration:true,error_domain:true,error_type:true,event:true,expected_participant_count:true,page:true,participant_count:true,session_id:true,surface:true,vc:true};f.exports=h}),null);
__d("BonfireLogger",["BonfireLocalStorage","BonfireUserActionsTypedLogger","Run","immutable"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("immutable").Map;function i(){this.$BonfireLogger1=h();c("Run").onBeforeUnload(function(){this.logPageChange(null)}.bind(this))}i.prototype.logPageChange=function(j){__p&&__p();var k=c("BonfireLocalStorage").getPage();if(j!==k){if(k)this.logStopTimer("bonfire_timer_page",{eventName:"page_exit"});c("BonfireLocalStorage").setPage(j);if(j)this.logStartTimer("bonfire_timer_page",{eventName:"page_enter"})}else if(!this.$BonfireLogger2("bonfire_timer_page"))this.$BonfireLogger3("bonfire_timer_page")};i.prototype.logImpression=function(j){this.logEvent({eventName:"impression",surface:j})};i.prototype.logClick=function(j,k){this.logEvent({eventName:"tap",surface:j,component:k})};i.prototype.logEdit=function(j,k){this.logEvent({eventName:"edit",surface:j,component:k})};i.prototype.logError=function(j,k,l){this.logEvent({eventName:"error",surface:j,errorDomain:k,errorType:l})};i.prototype.logStartTimer=function(j,event){this.logEvent(event);this.$BonfireLogger3(j)};i.prototype.logStopTimer=function(j,event){event.duration=this.$BonfireLogger4(j);this.logEvent(event)};i.prototype.logEvent=function(event){var j={client_time:Date.now(),error_domain:event.errorDomain,error_type:event.errorType,expected_participant_count:event.expectedParticipantCount,component:event.component,device_id:c("BonfireLocalStorage").getDeviceID(),duration:event.duration,event:event.eventName,page:c("BonfireLocalStorage").getPage(),participant_count:event.participantCount,session_id:c("BonfireLocalStorage").getSessionID(),surface:event.surface};new(c("BonfireUserActionsTypedLogger"))().updateData(j).log()};i.prototype.$BonfireLogger3=function(j){this.$BonfireLogger1=this.$BonfireLogger1.set(j,Date.now())};i.prototype.$BonfireLogger4=function(j){var k=this.$BonfireLogger1.get(j);if(k){this.$BonfireLogger1=this.$BonfireLogger1.remove(j);return Date.now()-k}return null};i.prototype.$BonfireLogger2=function(j){return this.$BonfireLogger1.has(j)};f.exports=new i()}),null);
__d("RTCConferenceState",[],(function a(b,c,d,e,f,g){"use strict";var h=Object.freeze({NEW:"NEW",AWAITING_USER_START:"AWAITING_USER_START",CONNECTING:"CONNECTING",CONNECTED:"CONNECTED",TERMINATING:"TERMINATING",TERMINATED:"TERMINATED"});f.exports=h}),null);
__d("RTCCallStoreState",["CurrentUser","immutable","RTCConferenceState","RTCUser"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j,k,l={debugID:0,conferenceState:c("RTCConferenceState").NEW,conferenceName:"",protocol:"",serverInfoData:""};h=babelHelpers.inherits(m,c("immutable").Record(l));i=h&&h.prototype;function m(){h.apply(this,arguments)}var n={connections:c("immutable").Set(),localUser:new(c("RTCUser"))({FBID:c("CurrentUser").getID()}),remoteUsers:c("immutable").Set(),callInfo:new m(),callSummary:null};j=babelHelpers.inherits(o,c("immutable").Record(n));k=j&&j.prototype;function o(){j.apply(this,arguments)}f.exports=o}),null);
__d("BonfireCallLogger",["BonfireLogger","FBRTCParticipantCallState","RTCGroupCallActionTypes","RTCCallStoreState","immutable","idx"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("immutable").Map,i=h();function j(w,x){__p&&__p();var y,z=q(((y=w)!=null?(y=y.callInfo)!=null?y.conferenceName:y:y)||"");if(!z)return w;var A=n(w.callInfo.conferenceName),B=x.type;switch(B){case c("RTCGroupCallActionTypes").CALL:r(w,x,z,A);break;case c("RTCGroupCallActionTypes").CALL_ERROR:s(w,x,z,A);break;case c("RTCGroupCallActionTypes").ON_CONFERENCE_STATE:t(w,x,z,A);break;case c("RTCGroupCallActionTypes").HANGUP:case c("RTCGroupCallActionTypes").END_CALL:u(w,x,z,A)}return w}function k(w,x){var y=n(w);y.expectedParticipantCount=x}function l(){i=i.clear()}function m(w){var x=arguments.length<=1||arguments[1]===undefined?0:arguments[1],y={expectedParticipantCount:x,callState:"init",lastStateChange:Date.now()};i=i.set(w,y);return y}function n(w){return i.has(w)?i.get(w):m(w)}function o(w,x){w.callState=x}function p(w){if(!w)return 0;return h(w.participantStates||{}).filter(function(x){return x.state===c("FBRTCParticipantCallState").CONNECTED}).size}function q(w){var x=w.match(/BONFIRE:(\d+)/);return x&&x.length>1?x[1]:null}function r(w,x,y,z){o(z,"connecting");c("BonfireLogger").logStartTimer("bonfire_timer_join",{eventName:"bonfire_join_start",bonfireID:y,expectedParticipantCount:z.expectedParticipantCount});i=i.withMutations(function(A){A.forEach(function(B,C){if(B!==z){A.remove(C);if(B.callState!=="terminated")c("BonfireLogger").logEvent({eventName:"error",errorDomain:"BonfireCallLogger",errorType:"UnterminatedCall",bonfireID:q(C)})}})})}function s(w,x,y,z){o(z,"terminated");c("BonfireLogger").logStopTimer("bonfire_timer_join",{eventName:"bonfire_join_error",bonfireID:y,expectedParticipantCount:z.expectedParticipantCount,errorDomain:"BonfireJoinCallError",errorType:x.endCallReason+": "+x.endCallSubreason})}function t(w,x,y,z){var A=p(x.request.conferenceStateRequest());if(z.callState==="connecting")c("BonfireLogger").logStopTimer("bonfire_timer_join",{eventName:"bonfire_join_success",bonfireID:y,participantCount:A,expectedParticipantCount:z.expectedParticipantCount});if(A>1&&z.callState!=="partying")c("BonfireLogger").logStartTimer("bonfire_timer_party",{eventName:"bonfire_party_start",bonfireID:y,participantCount:A});else if(A<2&&z.callState==="partying")c("BonfireLogger").logStopTimer("bonfire_timer_party",{eventName:"bonfire_party_end",bonfireID:y});o(z,A>1?"partying":"connected")}function u(w,x,y,z){if(z.callState==="partying")c("BonfireLogger").logStopTimer("bonfire_timer_party",{eventName:"bonfire_party_end",bonfireID:y});else if(z.callState==="connecting")c("BonfireLogger").logStopTimer("bonfire_timer_join",{eventName:"bonfire_join_cancel",bonfireID:y,expectedParticipantCount:z.expectedParticipantCount});o(z,"terminated")}var v={logRTCCallAction:j,setExpectedParticipantCount:k,clearCallLogs:l};f.exports=v}),null);
__d("RTISubscriptionGate",["RTISubscriptionGateLoader"],(function a(b,c,d,e,f,g){var h=c("RTISubscriptionGateLoader").module;if(c("RTISubscriptionGateLoader").gkUseIcebreaker)h=new h(c("RTISubscriptionGateLoader").icebreakerWhitelist);f.exports=h}),null);
__d("intlSummarizeNumber",["fbt","FbtNumberType","IntlCompactDecimalNumberFormatConfig","IntlVariations","gkx","idx","intlNumUtils"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=14,j={ROUND:"ROUND",TRUNCATE:"TRUNCATE"},k={SHORT:"SHORT",LONG:"LONG"};function l(p,q){if(c("gkx")("AT4Gk1s76OPy7ZVyUV8EWClFDdJ3HVS1lJcW-w23mc-iNMD_hLAC_rAt0_qU-jFNhRVLPEBpGuJ4RBeblPY8ovas"))return m(p,q);else return o(p,q)}function m(p,q){__p&&__p();var r=arguments.length<=2||arguments[2]===undefined?k.SHORT:arguments[2],s,t=arguments.length<=3||arguments[3]===undefined?j.ROUND:arguments[3],u=c("IntlCompactDecimalNumberFormatConfig")[r==k.SHORT?"short_patterns":"long_patterns"],v=p===0?0:Math.floor(Math.log10(Math.abs(p)));if(v>i)v=i;var w=n(p,v,q,t,u),x=w[0],y=w[1],z=w[2];if(z){v+=1;var A=n(p,v,q,t,u);x=A[0];y=A[1];z=A[2]}var B=c("FbtNumberType").getNumberVariationType(x)||c("IntlVariations").NUMBER_OTHER,C=v.toString(),D=(s=u)!=null?(s=s[C])!=null?s[B.toString()]:s:s;return(D&&D.positive_prefix_pattern||"")+c("intlNumUtils").formatNumberWithThousandDelimiters(x,y)+(D&&D.positive_suffix_pattern||"")}function n(p,q,r,s,t){var u,v=q.toString(),w=(u=t)!=null?(u=u[v])!=null?u[c("IntlVariations").NUMBER_OTHER.toString()]:u:u,x=w&&w.min_integer_digits||q+1,y=q-x+1,z=Math.abs(p)/Math.pow(10,y),A=r!=null,B=A?r:w&&w.min_fraction_digits;if(B==null)B=q>2?1:0;var C=s==j.TRUNCATE?c("intlNumUtils").truncateLongNumber(z.toString(),B):z.toFixed(B),D=parseFloat(C)*(p<0?-1:1);if(D%1===0&&!A)B=0;return[D,B,C.length>x+(B>0?B+1:0)+(z>=0?0:1)&&q<i]}function o(p,q){__p&&__p();var r=q===undefined?0:q,s=q===undefined?1:q;p=parseFloat(p.toFixed(r));if(Math.abs(p)<1e3)return c("intlNumUtils").formatNumberWithThousandDelimiters(p,r);p=parseFloat((p/1e3).toFixed(s));if(Math.abs(p)<1e3)return String(h._("{number}K",[h.param("number",c("intlNumUtils").formatNumberWithThousandDelimiters(p,q===undefined?p%1&&1:q))]));p=parseFloat((p/1e3).toFixed(s));if(Math.abs(p)<1e3)return String(h._("{number}M",[h.param("number",c("intlNumUtils").formatNumberWithThousandDelimiters(p,q===undefined?p%1&&1:q))]));p=parseFloat((p/1e3).toFixed(s));return String(h._("{number}B",[h.param("number",c("intlNumUtils").formatNumberWithThousandDelimiters(p,q===undefined?p%1&&1:q))]))}f.exports=l}),null);
__d("Facepile.react",["cx","fbt","ix","intlSummarizeNumber","joinClasses","HovercardLink","Image.react","Link.react","List.react","React"],(function a(b,c,d,e,f,g,h,i,j){__p&&__p();var k=c("React").PropTypes,l={small:24,medium:32,large:50},m=c("React").createClass({displayName:"Facepile",defaultProps:{moreColor:"blue",moreCount:0,showHovercard:false,tooltipPosition:"above",showToolTip:true,spacing:"none"},propTypes:{className:k.string,moreColor:k.oneOf(["blue","gray"]),moreCount:k.number,moreDialogLink:k.string,morePageLink:k.string,numFaces:k.number,onFaceClick:k.func,onComponentDidMount:k.func,profiles:k.arrayOf(k.shape({URL:k.any,name:k.node.isRequired,uniqueID:k.any.isRequired,profilePicURI:k.any.isRequired})).isRequired,showHovercard:k.bool,size:k.oneOf([28,"small","medium","large"]).isRequired,spacing:k.oneOf(["none","small","medium","large"]),showToolTip:k.bool,tooltipPosition:k.oneOf(["above","below","left","right"])},_onFaceClick:function n(o,p){if(this.props.onFaceClick)this.props.onFaceClick(o,p)},componentDidMount:function n(){if(this.props.onComponentDidMount)this.props.onComponentDidMount()},getPicSize:function n(){return l[this.props.size]||this.props.size},renderFace:function n(o,p){var q=this.getPicSize(),r=c("HovercardLink").constructEndpoint({id:o.uniqueID}).toString();return c("React").createElement("li",{className:"_43q7",key:o.uniqueID,onClick:this._onFaceClick.bind(this,o,p)},c("React").createElement(c("Link.react"),{"aria-label":o.name,className:"_2rt_ link","data-hover":!this.props.showHovercard?"tooltip":null,"data-hovercard":this.props.showHovercard?r:null,"data-ignoreclass":"_2rt_","data-tooltip-alignh":"left","data-tooltip-content":o.name,"data-tooltip-position":this.props.tooltipPosition,href:o.URL},c("React").createElement(c("Image.react"),{src:o.profilePicURI,width:q,height:q,className:"img"})))},renderMore:function n(){__p&&__p();if(!this.props.moreCount)return null;var o=this.props.numFaces!=null&&this.props.numFaces<=this.props.profiles.length?this.props.moreCount+1:this.props.moreCount,p=c("intlSummarizeNumber")(o,0),q=p.length,r;if(o===0||this.props.size==="small"&&q>2||this.props.size===28&&q>2||this.props.size==="medium"&&q>3||this.props.size==="large"&&q>6)r=c("React").createElement(c("Image.react"),{src:j("97502")});else r="+"+p;var s;if(this.props.showToolTip===undefined||this.props.showToolTip===true)if(o===1)s=i._("1 other person");else s=i._("{num} other people",[i.param("num",o)]);var t=c("joinClasses")("_43q8 _43q7"+(q<2?" _43qa":"")+(q===2?" _43qb":"")+(q===3?" _43qd":"")+(q>3?" _43qe":"")+(this.props.moreColor==="blue"?" _49c8":"")+(this.props.moreColor==="gray"?" _49cb":""));return c("React").createElement("li",{className:t},c("React").createElement("a",{"data-hover":s?"tooltip":null,"data-tooltip-position":s?"right":null,"data-tooltip-content":s,ajaxify:this.props.moreDialogLink||this.props.morePageLink,href:this.props.morePageLink,role:"button",rel:this.props.moreDialogLink?"dialog":null},r))},render:function n(){var o=this.props.spacing||this.defaultProps.spacing,p=c("joinClasses")(this.props.className,"_43qm"+(this.props.size==28?" _3cxu":"")+(this.props.size=="small"?" _43q9":"")+(this.props.size=="medium"?" _43qc":"")+(this.props.size=="large"?" _43qf":"")+(o!=this.defaultProps.spacing?" _4nab":"")),q=this.props.numFaces==undefined?this.props.profiles:this.props.profiles.slice(0,this.props.moreCount?this.props.numFaces-1:this.props.numFaces);return c("React").createElement("div",{className:p,style:this.props.style},c("React").createElement(c("List.react"),{className:"_4cg3",direction:"horizontal",spacing:this.props.spacing||"none",border:"none"},q.map(this.renderFace),this.renderMore()))}});f.exports=m}),null);
__d("BonfireUserFetcherQuery.graphql",[],(function a(b,c,d,e,f,g){"use strict";var h=function(){var i=[{kind:"LocalArgument",name:"userId",type:"ID!",defaultValue:null}],j=[{kind:"Variable",name:"id",variableName:"userId",type:"ID!"}],k={kind:"ScalarField",alias:null,name:"id",args:null,storageKey:null},l={kind:"ScalarField",alias:null,name:"display_name",args:null,storageKey:null},m={kind:"ScalarField",alias:null,name:"username",args:null,storageKey:null},n={kind:"ScalarField",alias:null,name:"profile_picture_uri",args:null,storageKey:null};return{kind:"Request",operationKind:"query",name:"BonfireUserFetcherQuery",id:"1607073732685127",text:null,metadata:{},fragment:{kind:"Fragment",name:"BonfireUserFetcherQuery",type:"Query",metadata:null,argumentDefinitions:i,selections:[{kind:"LinkedField",alias:null,name:"node",storageKey:null,args:j,concreteType:null,plural:false,selections:[{kind:"InlineFragment",type:"User",selections:[k,{kind:"LinkedField",alias:null,name:"bonfire_user",storageKey:null,args:null,concreteType:"BonfireUser",plural:false,selections:[k,l,m,n,{kind:"FragmentSpread",name:"BonfireParticipantRow_participant",args:null}]}]}]}]},operation:{kind:"Operation",name:"BonfireUserFetcherQuery",argumentDefinitions:i,selections:[{kind:"LinkedField",alias:null,name:"node",storageKey:null,args:j,concreteType:null,plural:false,selections:[{kind:"ScalarField",alias:null,name:"__typename",args:null,storageKey:null},k,{kind:"InlineFragment",type:"User",selections:[{kind:"LinkedField",alias:null,name:"bonfire_user",storageKey:null,args:null,concreteType:"BonfireUser",plural:false,selections:[k,l,m,n,{kind:"ScalarField",alias:null,name:"account_id",args:null,storageKey:null},{kind:"ScalarField",alias:null,name:"is_viewer_friend",args:null,storageKey:null},{kind:"LinkedField",alias:null,name:"active_friend_request_with_viewer",storageKey:null,args:null,concreteType:"BonfireFriendRequest",plural:false,selections:[k]}]}]}]}]}}}();f.exports=h}),null);
__d("BaseGraphQLSubscription",["Banzai","BanzaiLogger","ChannelClientID","CurrentLocale","CurrentUser","GraphQLSubscriptionsConfig","RTISubscriptionGate","URI"],(function a(b,c,d,e,f,g){__p&&__p();var h=1e4,i={subscribe:function j(k,l){var m={transformContext:JSON.stringify(this._getTransformContext(k))},n=this._getQueryParameters(k);this._logEvent("client_subscribe",n);return c("RTISubscriptionGate").subscribe(this._getTopic(k),function(o){this._logEvent("receivepayload",n);l(JSON.parse(o.payload))}.bind(this),m,null,function(){this._logEvent("client_unsubscribe",n)}.bind(this))},subscribeWithIcebreaker_EXPERIMENTAL:function j(k,l,m){__p&&__p();var n=new(c("URI"))("https://streaming-graph.facebook.com/gqls_bore");n.setQueryData({access_token:m});var o=this._getTopic(k),p={topic:o,locale:c("CurrentLocale").get(),queryID:this._getQueryID(),serializedQueryParameters:JSON.stringify(this._getQueryParameters(k))};n.addQueryData(p);var q=new EventSource(n.toString(),{withCredentials:true});q.addEventListener("message",function(r){l(JSON.parse(JSON.parse(r.data).payload))},false);return{getContext:function r(){return p},unsubscribe:function r(){return q.close()}}},_getTransformContext:function j(k){var l=155160167952447;return{viewerID:this._getViewerID(k),appID:l,locale:c("CurrentLocale").get(),queryID:this._getQueryID(),serializedQueryParameters:JSON.stringify(this._getQueryParameters(k))}},_getViewerID:function j(k){return c("CurrentUser").getID()},_logEvent:function j(k,l){if(c("Banzai").isEnabled("gqls_web_logging")){var m=c("GraphQLSubscriptionsConfig").shouldAlwaysLog?1:h;if(Math.random()*m<1)c("BanzaiLogger").log("GraphQLSubscriptionsLoggerConfig",{clienttime:Date.now()/1e3,client_sample_weight:m,event:k,mechanism:"skywalker",query_id:parseInt(this._getQueryID(),10),query_params:l,session_id:c("ChannelClientID").getID(),subscription_call:this._getSubscriptionCallName()})}}};f.exports=i}),null);
__d("WebGraphQLSubscriptionHelper",[],(function a(b,c,d,e,f,g){"use strict";f.exports={getExports:function h(i){var j=i.docID,k=i.queryID;return{getDocID:function l(){return j},getLegacyQueryID:function l(){return k}}}}}),null);
__d("RungParticipantsAddedWebGraphQLSubscription",["WebGraphQLSubscriptionHelper"],(function a(b,c,d,e,f,g){"use strict";f.exports=c("WebGraphQLSubscriptionHelper").getExports({docID:"1882501755112912",queryID:"167653647155864"})}),null);
__d("RungParticipantsAddedSubscription",["BaseGraphQLSubscription","RungParticipantsAddedWebGraphQLSubscription","uuid"],(function a(b,c,d,e,f,g){var h=babelHelpers["extends"]({},c("BaseGraphQLSubscription"),{_getTopic:function i(j){return"gqls/rung_participants_added_subscribe/call_id_"+j},_getQueryID:function i(){return c("RungParticipantsAddedWebGraphQLSubscription").getDocID()},_getQueryParameters:function i(j){return{input:JSON.stringify({client_subscription_id:c("uuid")(),call_id:j})}},_getSubscriptionCallName:function i(){return"rung_participants_added_subscribe"}});f.exports=h}),null);
__d("MessengerRTCGroupCallIncomingDialog.react",["cx","fbt","Facepile.react","ImageBlock.react","immutable","MercuryIDs","MercuryParticipants","messengerDialogsRe","messengerContactImageReact","MessengerDialog.react","messengerDialogBodyReact","MessengerDialogButton.react","MessengerDialogFooter.react","MessengerDialogHeader.react","React","RungParticipantsAddedSubscription"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j,k,l=c("messengerContactImageReact").jsComponent,m=c("messengerDialogBodyReact").jsComponent,n=400,o=5,p=50,q=function q(y,z){var A=void 0;if(y)A=z?i._("Incoming Group Video Chat"):i._("Incoming Group Call");else A=z?i._("Incoming Video Chat"):i._("Incoming Call");return A},r=function r(y,z,A){var B;if(y)B=z?i._("{caller name} started a group video chat in a group you're a member of.",[i.param("caller name",A.name)]):i._("{caller name} started a group call in a group you're a member of.",[i.param("caller name",A.name)]);else B=z?i._("{caller name} invited you to a group video chat.",[i.param("caller name",A.name)]):i._("{caller name} invited you to a group call.",[i.param("caller name",A.name)]);return B},s=function s(y){var z=y.isGroupCall,A=y.hasVideo;return c("React").createElement(c("MessengerDialogHeader.react"),null,q(z,A))},t=function t(y){var z=y.isGroupCall,A=y.hasVideo,B=y.caller,C=y.callees;return c("React").createElement(m,null,c("React").createElement(c("ImageBlock.react"),null,c("React").createElement(l,{isMessengerUser:B.is_messenger_user,size:p,src:B.big_image_src||B.image_src}),c("React").createElement("div",{className:"_2n1r"},c("React").createElement("div",{className:"_2n1s"},r(z,A,B)),c("React").createElement(c("Facepile.react"),{moreCount:Math.max(0,C.length-o),profiles:C.map(function(D){var E=D.name,F=D.fbid,G=D.big_image_src;return{name:E,uniqueID:F,profilePicURI:G}}).slice(0,o),size:"medium"}),c("React").createElement("div",{className:"_2n1t"},A?i._("Video will start as soon as you answer."):i._("The call will start as soon as you answer.")))))},u=function u(y){c("messengerDialogsRe").removeAllDialogs();y()},v=function v(y){c("messengerDialogsRe").removeAllDialogs();y()},w=function w(y,z){if(!y){c("messengerDialogsRe").removeAllDialogs();z()}};j=babelHelpers.inherits(x,c("React").Component);k=j&&j.prototype;function x(y){k.constructor.call(this,y);this.$MessengerRTCGroupCallIncomingDialog2=null;this.$MessengerRTCGroupCallIncomingDialog3()}x.prototype.componentDidMount=function(){c("MercuryParticipants").getMulti(this.props.participantIDs.map(c("MercuryIDs").getParticipantIDFromUserID),function(y){var z=c("immutable").Map(y).filter(function(A){return A.id!=this.props.callerID}.bind(this));this.$MessengerRTCGroupCallIncomingDialog1=y[this.props.callerID];this.setState({rungParticipants:z})}.bind(this))};x.prototype.$MessengerRTCGroupCallIncomingDialog3=function(){__p&&__p();var y=this.props.conferenceName.split(":")[1];this.$MessengerRTCGroupCallIncomingDialog2=c("RungParticipantsAddedSubscription").subscribe(y,function(z){__p&&__p();var A=z.rung_participants_added_subscribe.call.rung_participants.edges;if(A.length>this.state.rungParticipants.size){var B=A.map(function(C){var D=C.node.facebook_personal_user.id;return c("MercuryIDs").getParticipantIDFromUserID(D)}).filter(function(C){return!this.state.rungParticipants.has(C)}.bind(this));c("MercuryParticipants").getMulti(B,function(C){var D=this.state.rungParticipants.concat(C);this.setState({rungParticipants:D})}.bind(this))}}.bind(this))};x.prototype.componentWillUnmount=function(){if(!this.$MessengerRTCGroupCallIncomingDialog2)return;this.$MessengerRTCGroupCallIncomingDialog2.unsubscribe();this.$MessengerRTCGroupCallIncomingDialog2=null};x.prototype.render=function(){if(!this.$MessengerRTCGroupCallIncomingDialog1)return null;return c("React").createElement(c("MessengerDialog.react"),{layerHideOnBlur:false,shown:true,onToggle:function(y){return w(y,this.props.onIgnore)}.bind(this),width:n},c("React").createElement(s,{hasVideo:this.props.hasVideo,isGroupCall:this.props.isGroupCall}),c("React").createElement(t,{isGroupCall:this.props.isGroupCall,hasVideo:this.props.hasVideo,caller:this.$MessengerRTCGroupCallIncomingDialog1,callees:this.state.rungParticipants.valueSeq().toArray()}),c("React").createElement(c("MessengerDialogFooter.react"),null,c("React").createElement(c("MessengerDialogButton.react"),{label:i._("Ignore"),onClick:function(){return u(this.props.onIgnore)}.bind(this),type:"secondary"}),c("React").createElement(c("MessengerDialogButton.react"),{label:i._("Answer Call"),onClick:function(){return v(this.props.onAnswer)}.bind(this),type:"primary"})))};f.exports=x}),null);
__d("MessengerRTCGroupCallIncomingDialogController",["EventEmitter","FBRTCSoundController","MercuryIDs","MercuryParticipants","MessengerBrowserAlerts","messengerDialogsRe","MessengerRTCGroupCallIncomingDialog.react","MessengerRTCIncomingDialog.react","React","RTCConfig","RTCUtils","XGroupCallController","randomInt","setTimeoutAcrossTransitions"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=7e4;h=babelHelpers.inherits(k,c("EventEmitter"));i=h&&h.prototype;function k(l,m,n,o,p,q){__p&&__p();i.constructor.call(this);this.$MessengerRTCGroupCallIncomingDialogController1=l;this.$MessengerRTCGroupCallIncomingDialogController2=m;this.$MessengerRTCGroupCallIncomingDialogController3=n;this.$MessengerRTCGroupCallIncomingDialogController4=o;this.$MessengerRTCGroupCallIncomingDialogController5=p;this.$MessengerRTCGroupCallIncomingDialogController6=q;this.$MessengerRTCGroupCallIncomingDialogController7=null;this.$MessengerRTCGroupCallIncomingDialogController8=null;this.$MessengerRTCGroupCallIncomingDialogController9=false}k.prototype.serverInfoData=function(){return this.$MessengerRTCGroupCallIncomingDialogController6};k.prototype.showIncomingDialog=function(){__p&&__p();var l,m=this;this.$MessengerRTCGroupCallIncomingDialogController7=c("setTimeoutAcrossTransitions")(this.$MessengerRTCGroupCallIncomingDialogController10.bind(this),j);var n=this.$MessengerRTCGroupCallIncomingDialogController1+c("randomInt")(0,4294967295).toString();c("FBRTCSoundController").playIncomingRingtone(n,this.$MessengerRTCGroupCallIncomingDialogController1,true);if(!c("RTCUtils").isGroupCall(this.$MessengerRTCGroupCallIncomingDialogController1)&&!c("RTCUtils").isMessengerCall(this.$MessengerRTCGroupCallIncomingDialogController1))c("messengerDialogsRe").showDialog(function(){return c("React").createElement(c("MessengerRTCIncomingDialog.react"),{callerID:this.$MessengerRTCGroupCallIncomingDialogController3,isVideoCall:this.$MessengerRTCGroupCallIncomingDialogController5,onAccept:function(){return this.$MessengerRTCGroupCallIncomingDialogController11()}.bind(this),onDecline:function(){return this.$MessengerRTCGroupCallIncomingDialogController12()}.bind(this)})}.bind(this));else(function(){var o=[m.$MessengerRTCGroupCallIncomingDialogController3].concat(m.$MessengerRTCGroupCallIncomingDialogController4);c("messengerDialogsRe").showDialog(function(){return c("React").createElement(c("MessengerRTCGroupCallIncomingDialog.react"),{callerID:c("MercuryIDs").getParticipantIDFromUserID(this.$MessengerRTCGroupCallIncomingDialogController3),conferenceName:this.$MessengerRTCGroupCallIncomingDialogController1,isGroupCall:c("RTCUtils").isGroupCall(this.$MessengerRTCGroupCallIncomingDialogController1),hasVideo:this.$MessengerRTCGroupCallIncomingDialogController5,onAnswer:function(){return this.$MessengerRTCGroupCallIncomingDialogController11()}.bind(this),onIgnore:function(){return this.$MessengerRTCGroupCallIncomingDialogController12()}.bind(this),participantIDs:o})}.bind(m))})();if(c("RTCConfig").BrowserNotificationGK)this.$MessengerRTCGroupCallIncomingDialogController13(this.$MessengerRTCGroupCallIncomingDialogController5)};k.prototype.$MessengerRTCGroupCallIncomingDialogController13=function(l){var m={peerID:this.$MessengerRTCGroupCallIncomingDialogController3,onNotificationClicked:this.$MessengerRTCGroupCallIncomingDialogController11.bind(this),isVideoCall:l,isGroupCall:c("RTCUtils").isGroupCall(this.$MessengerRTCGroupCallIncomingDialogController1)};c("MessengerBrowserAlerts").showRTCNotification(m,function(n){this.$MessengerRTCGroupCallIncomingDialogController8=n;if(this.$MessengerRTCGroupCallIncomingDialogController9)this.$MessengerRTCGroupCallIncomingDialogController14()}.bind(this))};k.prototype.cancel=function(){if(this.$MessengerRTCGroupCallIncomingDialogController7)clearTimeout(this.$MessengerRTCGroupCallIncomingDialogController7);c("messengerDialogsRe").removeAllDialogs();c("FBRTCSoundController").stopIncomingRingtone();if(this.$MessengerRTCGroupCallIncomingDialogController8)this.$MessengerRTCGroupCallIncomingDialogController14();this.$MessengerRTCGroupCallIncomingDialogController9=true};k.prototype.$MessengerRTCGroupCallIncomingDialogController11=function(){this.cancel();var l=c("XGroupCallController").getURIBuilder().setString("conference_name",this.$MessengerRTCGroupCallIncomingDialogController1).setInt("call_id",this.$MessengerRTCGroupCallIncomingDialogController2).setBool("has_video",this.$MessengerRTCGroupCallIncomingDialogController5).setString("server_info_data",this.$MessengerRTCGroupCallIncomingDialogController6).getURI();this.emit("answerCall",this.$MessengerRTCGroupCallIncomingDialogController1,l)};k.prototype.$MessengerRTCGroupCallIncomingDialogController12=function(){this.cancel();this.emit("ignoreCall")};k.prototype.$MessengerRTCGroupCallIncomingDialogController10=function(){this.cancel();this.emit("timeout")};k.prototype.$MessengerRTCGroupCallIncomingDialogController14=function(){if(this.$MessengerRTCGroupCallIncomingDialogController8){this.$MessengerRTCGroupCallIncomingDialogController8.close();this.$MessengerRTCGroupCallIncomingDialogController8=null}};f.exports=k}),null);
__d("MercuryParticipantListRenderer",["fbt","MercuryIDs"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();function i(){__p&&__p();this.$MercuryParticipantListRenderer6=function(s){var t=this.$MercuryParticipantListRenderer5;if(t){var u=c("MercuryIDs").getUserIDFromParticipantID(s.id);if(u&&t[u])return t[u]}return this.$MercuryParticipantListRenderer2?s.short_name:s.name}.bind(this);this.$MercuryParticipantListRenderer1=false;this.$MercuryParticipantListRenderer2=false;this.$MercuryParticipantListRenderer3=false;this.$MercuryParticipantListRenderer4=0;this.$MercuryParticipantListRenderer5=null}i.prototype.renderParticipantList=function(s){var t=s.map(this.$MercuryParticipantListRenderer6);switch(t.length){case 0:return j(this.$MercuryParticipantListRenderer1);case 1:return k(t);case 2:return this.$MercuryParticipantListRenderer3?m(t):l(t);case 3:return this.$MercuryParticipantListRenderer3?o(t):n(t);default:return this.$MercuryParticipantListRenderer3?q(t,this.$MercuryParticipantListRenderer4):p(t,this.$MercuryParticipantListRenderer4)}};i.prototype.setIsNewThread=function(s){this.$MercuryParticipantListRenderer1=s;return this};i.prototype.setNameRenderer=function(s){this.$MercuryParticipantListRenderer6=s;return this};i.prototype.setUseShortName=function(s){this.$MercuryParticipantListRenderer2=s;return this};i.prototype.setNickname=function(s){this.$MercuryParticipantListRenderer5=s;return this};i.prototype.setUseAndSeparator=function(s){this.$MercuryParticipantListRenderer3=s;return this};i.prototype.setTotalParticipantCount=function(s){this.$MercuryParticipantListRenderer4=s;return this};function j(s){if(s)return h._("New Message");else return h._("No Participants")}function k(s){return s[0]}function l(s){return h._("{participant1}, {participant2}",[h.param("participant1",s[0]),h.param("participant2",s[1])])}function m(s){return h._("{participant1} and {participant2}",[h.param("participant1",s[0]),h.param("participant2",s[1])])}function n(s){return h._("{participant1}, {participant2}, {participant3}",[h.param("participant1",s[0]),h.param("participant2",s[1]),h.param("participant3",s[2])])}function o(s){return h._("{participant1}, {participant2} and {participant3}",[h.param("participant1",s[0]),h.param("participant2",s[1]),h.param("participant3",s[2])])}function p(s,t){return h._("{participant1}, {participant2}, {participant3}, {others_link}",[h.param("participant1",s[0]),h.param("participant2",s[1]),h.param("participant3",s[2]),h.param("others_link",r((t||s.length)-3))])}function q(s,t){return h._("{participant1}, {participant2} and {others_link}",[h.param("participant1",s[0]),h.param("participant2",s[1]),h.param("others_link",r((t||s.length)-2))])}function r(s){if(s>1)return h._({"*":"{others_count} others"},[h.param("others_count",s,[0])]);else return h._("1 other")}f.exports=i}),null);
__d("MercuryThreadTitle.react",["fbt","MercuryIDs","MessengerTextWithEmoticons.react","MercuryParticipantListRenderer","MercuryParticipants","React","TextWithEmoticons.react"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=c("React").PropTypes,j=c("React").createClass({displayName:"MercuryThreadTitle",propTypes:{isNewThread:i.bool,thread:i.object.isRequired,viewer:i.string.isRequired,showUnreadCount:i.bool,useShortName:i.bool,useAndSeparator:i.bool},getDefaultProps:function k(){return{isNewThread:false,showUnreadCount:false,useShortName:false,useAndSeparator:false}},getInitialState:function k(){return{participantNames:""}},componentDidMount:function k(){this._renderParticipantsList(this.props)},componentWillReceiveProps:function k(l){this._renderParticipantsList(l)},render:function k(){return c("React").createElement("span",{className:this.props.className},this.props.thread.name?this._renderThreadTitle():this.state.participantNames,this.props.children)},getTitle:function k(){return this.state.participantNames},_renderThreadTitle:function k(){var l=this.props.thread,m=c("React").createElement(c("MessengerTextWithEmoticons.react"),{renderEmoticons:true,renderEmoji:true,text:l.name});if(!l.unread_count||!this.props.showUnreadCount)return m;return this._renderTitleWithUnreadCount(m,l.unread_count)},_renderParticipantsList:function k(l){__p&&__p();if(l.thread.name)return;this.setState({participantNames:""});var m=c("MercuryIDs").getParticipantIDFromUserID(l.viewer),n=l.thread.participants||[];if(n.length>1)n=n.filter(function(o){return o!=m});c("MercuryParticipants").getMulti(n,function(o){if(!this.isMounted())return;var p=n.map(function(s){return o[s]}),q=l.thread.custom_nickname?{}:null,r=c("MessengerTextWithEmoticons.react");if(q)for(var s in l.thread.custom_nickname)q[s]=c("React").createElement(r,{renderEmoticons:true,renderEmoji:true,text:l.thread.custom_nickname[s]});var t=new(c("MercuryParticipantListRenderer"))().setUseShortName(l.useShortName).setUseAndSeparator(l.useAndSeparator).setIsNewThread(l.isNewThread).setNickname(q).renderParticipantList(p),u=l.showUnreadCount&&l.thread.unread_count?this._renderTitleWithUnreadCount(t,l.thread.unread_count):t;this.setState({participantNames:u})}.bind(this))},_renderTitleWithUnreadCount:function k(l,m){return h._("{conversation-title} ({unread-count})",[h.param("conversation-title",l),h.param("unread-count",m)])}});f.exports=j}),null);
__d("RTCCallTitle.react",["immutable","MercuryIDs","MercuryParticipantListRenderer","React"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=function h(i){var j=i.viewer,k=i.participants,l=i.className,m=c("MercuryIDs").getParticipantIDFromUserID(j),n=Object.keys(k.toJS());if(n.length>1)n=n.filter(function(q){return q!=m});var o=n.map(function(q){return k.get(q)}),p=new(c("MercuryParticipantListRenderer"))().setUseShortName(false).setUseAndSeparator(false).renderParticipantList(o);return c("React").createElement("span",{className:l},p)};f.exports=h}),null);
__d("MessengerRTCGroupCallThreadRow.react",["cx","fbt","MercuryParticipantsImage.react","MercuryThreadTitle.react","messengerProfileImageWrapperReact","messengerThreadImageReact","React","RTCCallTitle.react"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j=c("messengerProfileImageWrapperReact").jsComponent,k=c("messengerThreadImageReact").jsComponent,l=function l(p){var q=p.displayAddMemberWarning,r=p.participants,s=p.thread,t=p.viewerID;return c("React").createElement("div",{className:"_5y31"},c("React").createElement(k,{className:"_5y32",participants:r,thread:s,viewer:t}),c("React").createElement("div",{className:"_5y34"},c("React").createElement(c("MercuryThreadTitle.react"),{className:"_5y37",thread:s,viewer:t}),c("React").createElement(n,{displayAddMemberWarning:q})))},m=function m(p){var q=p.displayAddMemberWarning,r=p.participants,s=p.thread,t=p.viewerID;return c("React").createElement("div",{className:"_5y31"},c("React").createElement(j,{className:"_5y32",showBadge:false},c("React").createElement(c("MercuryParticipantsImage.react"),{participants:Object.keys(r.toJS()),size:50})),c("React").createElement("div",{className:"_5y34"},c("React").createElement(c("RTCCallTitle.react"),{className:"_5y37",participants:r,viewer:t}),c("React").createElement(n,{displayAddMemberWarning:q})))},n=function n(p){var q=p.displayAddMemberWarning;return q?c("React").createElement("div",{className:"_1apf"},i._("People you add to this group video will see previous messages in this conversation.")):null},o=function o(p){var q=p.thread,r=babelHelpers.objectWithoutProperties(p,["thread"]);return q?c("React").createElement(l,babelHelpers["extends"]({thread:q},r)):c("React").createElement(m,babelHelpers["extends"]({thread:q},r))};f.exports=o}),null);
__d("MessengerRTCGroupCallUnsupportedBrowserDialog.react",["fbt","Link.react","MessengerDialog.react","messengerDialogBodyReact","MessengerDialogButton.react","MessengerDialogFooter.react","MessengerDialogHeader.react","React","UserAgent"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=c("messengerDialogBodyReact").jsComponent,j=function j(n){var o=n.hasVideo,p=n.onUnmount;return c("React").createElement(c("MessengerDialog.react"),{onToggle:p},c("React").createElement(c("MessengerDialogHeader.react"),null,k(o)),c("React").createElement(i,null,l(o)),c("React").createElement(c("MessengerDialogFooter.react"),null,c("React").createElement(c("MessengerDialogButton.react"),{label:h._("OK"),onClick:p,type:"primary"})))};function k(n){return n?h._("Switch Browsers to Make Group Video Chats"):h._("Switch Browsers to Make Group Calls")}function l(n){return n?h._("Unfortunately, our group calling feature doesn't support {browser name, i.e. Internet Explorer or Safari} yet. To make a group video chat, open in {link to install chrome}.",[h.param("browser name, i.e. Internet Explorer or Safari",m()),h.param("link to install chrome",c("React").createElement(c("Link.react"),{href:"https://www.google.com/chrome/index.html",target:"_blank"},"Google Chrome"))]):h._("Unfortunately, our group calling feature doesn't support {browser name, i.e. Internet Explorer or Safari} yet. To make a group call, open in {link to install chrome}.",[h.param("browser name, i.e. Internet Explorer or Safari",m()),h.param("link to install chrome",c("React").createElement(c("Link.react"),{href:"https://www.google.com/chrome/index.html",target:"_blank"},"Google Chrome"))])}function m(){if(c("UserAgent").isBrowser("Firefox"))return h._("Firefox");else if(c("UserAgent").isBrowser("IE"))return h._("Internet Explorer");else if(c("UserAgent").isBrowser("Safari"))return h._("Safari");else return h._("your browser")}f.exports=j}),null);
__d("MessengerRTCGroupCallUnsupportedBrowserDialogController",["DOM","MessengerRTCGroupCallUnsupportedBrowserDialog.react","React","ReactDOM"],(function a(b,c,d,e,f,g){"use strict";var h={_container:c("DOM").create("div"),render:function i(j){var k=j.hasVideo;c("ReactDOM").render(c("React").createElement(c("MessengerRTCGroupCallUnsupportedBrowserDialog.react"),{hasVideo:k,onUnmount:function(){return this.unmount()}.bind(this)}),this._container)},unmount:function i(){c("ReactDOM").unmountComponentAtNode(this._container)}};f.exports=h}),null);
__d("XVideoCallAdminMessageController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/videocall/admin_msg/",{})}),null);
__d("FBRTCAdminMessage",["FBRTCCallConstants","FBRTCConstants","FBRTCLogger","FBRTCUtils","XVideoCallAdminMessageController","emptyFunction","performanceNow"],(function a(b,c,d,e,f,g){__p&&__p();function h(i,j){"use strict";this.$FBRTCAdminMessage1=i;this.$FBRTCAdminMessage2=j;this.$FBRTCAdminMessage3=Date.now();this.$FBRTCAdminMessage4=null;this.$FBRTCAdminMessage5=null}h.prototype.onCallConnected=function(){"use strict";if(!this.$FBRTCAdminMessage4)this.$FBRTCAdminMessage4=c("performanceNow")()};h.prototype.onCallEnded=function(){"use strict";if(!this.$FBRTCAdminMessage5)this.$FBRTCAdminMessage5=c("performanceNow")()};h.prototype.submit=function(i,j){"use strict";__p&&__p();if(!this.$FBRTCAdminMessage5)this.onCallEnded();var k=0,l=c("FBRTCCallConstants").FBRTCCallConnectionType.MISSED_CALL;if(this.$FBRTCAdminMessage4&&this.$FBRTCAdminMessage5){k=Math.ceil(this.$FBRTCAdminMessage5-this.$FBRTCAdminMessage4);l=c("FBRTCCallConstants").FBRTCCallConnectionType.CONNECTED_CALL}var m=l===c("FBRTCCallConstants").FBRTCCallConnectionType.CONNECTED_CALL||j===c("FBRTCConstants").CallEndReason.IGNORE_CALL;this.$FBRTCAdminMessage6({peer_id:this.$FBRTCAdminMessage1,call_id:this.$FBRTCAdminMessage2,start_time:this.$FBRTCAdminMessage3,call_duration:k,message_type:l,call_category:i,call_acknowledged:m})};h.prototype.$FBRTCAdminMessage6=function(i){"use strict";var j=c("XVideoCallAdminMessageController").getURIBuilder().getURI();c("FBRTCUtils").sendServerRequest(j,c("emptyFunction"),this.$FBRTCAdminMessage7.bind(this,i.peer_id,i.call_id),false,undefined,i)};h.prototype.$FBRTCAdminMessage7=function(i,j,k){"use strict";var l;if(k)l="Fail to log admin message, error "+k.error;else l="Server timed out on logging admin message";c("FBRTCLogger").getInstance().logError(i,j,l)};f.exports=h}),null);
__d("FBRTCIceCache",[],(function a(b,c,d,e,f,g){__p&&__p();function h(){"use strict";this.$FBRTCIceCache1={}}h.prototype.reset=function(i,j){"use strict";if(!this.$FBRTCIceCache1[i])this.$FBRTCIceCache1[i]={};this.$FBRTCIceCache1[i][j]=[]};h.prototype.cacheCandidate=function(i,j,k){"use strict";if(!this.$FBRTCIceCache1[i])this.$FBRTCIceCache1[i]={};if(!this.$FBRTCIceCache1[i][j])this.$FBRTCIceCache1[i][j]=[];this.$FBRTCIceCache1[i][j].unshift(k)};h.prototype.drainCandidates=function(i,j,k){"use strict";if(this.$FBRTCIceCache1[i]&&this.$FBRTCIceCache1[i][j]){var l;while(this.$FBRTCIceCache1[i][j].length>0){l=this.$FBRTCIceCache1[i][j].pop();k(l)}}};f.exports=h}),null);
__d("FBRTCPCConfig",["FBRTCConfig","FBRTCVersionDetection","RTCConfig"],(function a(b,c,d,e,f,g){__p&&__p();var h="stun:stun.fbsbx.com:3478",i=function i(k,l,m){__p&&__p();if(c("FBRTCVersionDetection").isChrome()&&c("FBRTCVersionDetection").webrtcVersion()>=34){var n={urls:k};if(l&&m){n.username=l;n.credential=m}return[n]}var o=[];for(var p=0;p<k.length;p++)if(l&&m)o.push({url:k[p],username:l,credential:m});else o.push({url:k[p]});return o},j={setTurnCredentials:function k(l){this.turnIP=l.ip;this.udpPort=l.udp_port;this.tcpPort=l.tcp_port;this.sslPort=l.ssl_tcp_port;this.turnUsername=l.username;this.turnPassword=l.password},getConfig:function k(){if(c("FBRTCConfig").isVCEndpointCall()&&c("RTCConfig").CollabDisableBrowserTurnDiscoveryGK)return{iceServers:[]};var l=i([h]).concat(i(this._turnUrls(),this.turnUsername,this.turnPassword));return{iceServers:l}},getConstraints:function k(){return{mandatory:{},optional:[{DtlsSrtpKeyAgreement:true},{googHighBitrate:true},{googVeryHighBitrate:true}]}},_turnUrls:function k(){if(c("FBRTCVersionDetection").isFirefox()&&c("FBRTCVersionDetection").webrtcVersion()<27)return["turn:"+this.turnIP+":"+this.udpPort];else return["turn:"+this.turnIP+":"+this.udpPort+"?transport=udp","turn:"+this.turnIP+":"+this.tcpPort+"?transport=tcp","turn:"+this.turnIP+":"+this.sslPort+"?transport=tcp"]}};f.exports=j}),null);
__d("FBRTCRetriableMessage",["mixInEventEmitter","FBRTCConstants"],(function a(b,c,d,e,f,g){__p&&__p();var h=1e4,i=7e3,j=1;function k(l){"use strict";this.$FBRTCRetriableMessage1=l;this.$FBRTCRetriableMessage2=h;this.$FBRTCRetriableMessage3=j;this.$FBRTCRetriableMessage4=null;this.$FBRTCRetriableMessage5=null;this.$FBRTCRetriableMessage6=null}k.prototype.sendMessage=function(l,m,n,o,p,q,r){"use strict";__p&&__p();this.$FBRTCRetriableMessage4=m;switch(l){case c("FBRTCConstants").PayloadType.PCRESTART_OFFER:this.$FBRTCRetriableMessage5=this.$FBRTCRetriableMessage1.sendPCRestartOffer(m,n,o,p,q);break;case c("FBRTCConstants").PayloadType.OFFER:this.$FBRTCRetriableMessage5=this.$FBRTCRetriableMessage1.sendOffer(m,n,o,p,q);break;case c("FBRTCConstants").PayloadType.ANSWER:this.$FBRTCRetriableMessage2=i;this.$FBRTCRetriableMessage5=this.$FBRTCRetriableMessage1.sendAnswer(m,n,o,p,q,r);break}this.$FBRTCRetriableMessage7()};k.prototype.isAckMsg=function(l){"use strict";return this.$FBRTCRetriableMessage5&&this.$FBRTCRetriableMessage5.msg_id===l.ack_id};k.prototype.stopRetrying=function(){"use strict";if(this.$FBRTCRetriableMessage6){clearTimeout(this.$FBRTCRetriableMessage6);this.$FBRTCRetriableMessage4=null;this.$FBRTCRetriableMessage5=null;this.$FBRTCRetriableMessage6=null}};k.prototype.$FBRTCRetriableMessage7=function(){"use strict";this.$FBRTCRetriableMessage6=setTimeout(this.$FBRTCRetriableMessage8.bind(this),this.$FBRTCRetriableMessage2)};k.prototype.$FBRTCRetriableMessage8=function(){"use strict";if(this.$FBRTCRetriableMessage3<1)this.emit("timeoutFailure");else{this.emit("sendingRetry");this.$FBRTCRetriableMessage1.resendSdpMessage(this.$FBRTCRetriableMessage4,this.$FBRTCRetriableMessage5);this.$FBRTCRetriableMessage7();this.$FBRTCRetriableMessage3-=1}};c("mixInEventEmitter")(k,{sendingRetry:true,timeoutFailure:true});f.exports=k}),null);
__d("XVideoCallTurnDiscoveryController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/videocall/turndiscovery/",{version:{type:"Int",required:true}})}),null);
__d("FBRTCTurnDiscovery",["Promise","FBRTCLogger","FBRTCUtils","XVideoCallTurnDiscoveryController"],(function a(b,c,d,e,f,g){__p&&__p();var h=3,i=null,j={requestTurnCreds:function k(l,m){__p&&__p();var n=arguments.length<=2||arguments[2]===undefined?h:arguments[2];if(i)return i;var o=1,p=c("XVideoCallTurnDiscoveryController").getURIBuilder().setInt("version",o).getURI();i=new(c("Promise"))(function(q,r){__p&&__p();s(n);function s(t){c("FBRTCUtils").sendServerRequest(p,function(u){var v=u.payload;return q(v)},function(){if(t>0){c("FBRTCLogger").getInstance().logError(m,l,"Failed turn; going to retry");s(t-1)}else r(new Error("failed"))})}});return i}};f.exports=j}),null);
__d("RTCMediaDevices",["invariant","Promise","RTCOnDeviceChangePoller"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=navigator.mediaDevices&&typeof navigator.mediaDevices.enumerateDevices==="function",j=window.MediaStreamTrack&&window.MediaStreamTrack.getSources==="function",k=1e3,l=void 0,m={addEventListener:function o(p,q){if(p==="devicechange"&&c("RTCOnDeviceChangePoller").isNeeded()){if(!l)l=new(c("RTCOnDeviceChangePoller"))(k);l.add(q);return}var r=navigator,s=r.mediaDevices;if(s&&"addEventListener"in s)s.addEventListener(p,q)},removeEventListener:function o(p,q){if(p==="devicechange"&&c("RTCOnDeviceChangePoller").isNeeded()){if(l)l.remove(q);return}var r=navigator,s=r.mediaDevices;if(s&&"removeEventListener"in s)s.removeEventListener(p,q)},isSupported:function o(p){switch(p){case"enumerateDevices":return i||j;default:return Boolean(navigator.mediaDevices)}},enumerateDevices:function o(){if(i){navigator.mediaDevices||h(0);return c("Promise").resolve(navigator.mediaDevices.enumerateDevices())}else if(j)return new(c("Promise"))(function(p){return window.MediaStreamTrack.getSources(p)}).then(n);return c("Promise").reject(new Error("enumerateDevices() not supported"))},filterDevicesOfKind:function o(p,q){return p.filter(function(r){return r.kind===q})}};function n(o){return o.map(function(p){var q=p.id,r=p.kind,s=p.label;return{deviceId:q,groupId:"",kind:r==="video"?"videoinput":"audioinput",label:s}})}f.exports=m}),null);
__d("RTCOnDeviceChangePoller",["Promise","RTCMediaDevices"],(function a(b,c,d,e,f,g){__p&&__p();h.isNeeded=function(){"use strict";var i=navigator,j=i.mediaDevices;if(!c("RTCMediaDevices").isSupported("enumerateDevices")||j&&"ondevicechange"in j)return false;return true};function h(i){"use strict";__p&&__p();this.$RTCOnDeviceChangePoller1=[];this.$RTCOnDeviceChangePoller2="";this.$RTCOnDeviceChangePoller3=0;this.$RTCOnDeviceChangePoller4=0;this.$RTCOnDeviceChangePoller7=function(){__p&&__p();c("RTCMediaDevices").enumerateDevices().then(function(j){__p&&__p();var k=j.map(function(r){return r.deviceId+":"+r.label+":"+r.groupId}).sort().join("~");if(k===this.$RTCOnDeviceChangePoller2)return;this.$RTCOnDeviceChangePoller2=k;for(var l=this.$RTCOnDeviceChangePoller1,m=Array.isArray(l),n=0,l=m?l:l[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var o;if(m){if(n>=l.length)break;o=l[n++]}else{n=l.next();if(n.done)break;o=n.value}var p=o;try{p()}catch(q){}}}.bind(this))["catch"](function(j){return c("Promise").resolve()}).then(function(){this.$RTCOnDeviceChangePoller4=setTimeout(this.$RTCOnDeviceChangePoller7,this.$RTCOnDeviceChangePoller3)}.bind(this))["catch"](function(j){})}.bind(this);this.$RTCOnDeviceChangePoller3=i}h.prototype.add=function(i){"use strict";this.$RTCOnDeviceChangePoller1.push(i);this.$RTCOnDeviceChangePoller5()};h.prototype.remove=function(i){"use strict";this.$RTCOnDeviceChangePoller1=this.$RTCOnDeviceChangePoller1.filter(function(j){return j!==i});this.$RTCOnDeviceChangePoller6()};h.prototype.$RTCOnDeviceChangePoller5=function(){"use strict";if(this.$RTCOnDeviceChangePoller4!==0)return;this.$RTCOnDeviceChangePoller4=setTimeout(this.$RTCOnDeviceChangePoller7,0)};h.prototype.$RTCOnDeviceChangePoller6=function(){"use strict";if(this.$RTCOnDeviceChangePoller1.length>0)return;if(this.$RTCOnDeviceChangePoller4!==0){clearTimeout(this.$RTCOnDeviceChangePoller4);this.$RTCOnDeviceChangePoller4=0}};f.exports=h}),null);
__d("FBRTCUserSettings",["Promise","FBRTCConfig","RTCMediaDevices","mixInEventEmitter"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h={audioInput:"",audioOutput:"default",videoInput:"",remoteStream:null,_audioInputLabel:null,_videoInputLabel:null,isEnabled:function i(){return Boolean(c("RTCMediaDevices").isSupported("enumerateDevices")&&c("FBRTCConfig").settingsEnabled())},selectAudioInputByLabel:function i(j){if(!this.audioInput)this.audioInput=this._selectByLabel(j,this._audioInputLabel);return this.audioInput},selectVideoInputByLabel:function i(j){if(!this.videoInput)this.videoInput=this._selectByLabel(j,this._videoInputLabel);return this.videoInput},_selectByLabel:function i(j,k){__p&&__p();for(var l=j,m=Array.isArray(l),n=0,l=m?l:l[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var o;if(m){if(n>=l.length)break;o=l[n++]}else{n=l.next();if(n.done)break;o=n.value}var p=o;if(k&&k===p.label)return p.deviceId}return null},previewStart:function i(){this.emit("previewStarted")},previewEnd:function i(){this.emit("previewEnded")},save:function i(j){var k=j.audioInput,l=j.audioOutput,m=j.videoInput;return new(c("Promise"))(function(n){var o=!!(k&&this.audioInput!==k||m&&this.videoInput!==m);this.audioInput=k;this.audioOutput=l;this.videoInput=m;this.emit("saved",o);n(o)}.bind(this))},updateForLocalStream:function i(j){__p&&__p();if(j.videoMediaSourceId)this.videoInput=j.videoMediaSourceId;else{var k=j.getVideoTracks(),l=k[0];if(l)this._videoInputLabel=l.label}if(j.audioMediaSourceId)this.audioInput=j.audioMediaSourceId;else{var m=j.getAudioTracks(),n=m[0];if(n)this._audioInputLabel=n.label}},updateForRemoteStream:function i(j){this.remoteStream=j;this.emit("remoteStreamChanged")},addListener:function i(){},emit:function i(){}};c("mixInEventEmitter")(h,{previewStarted:true,previewEnded:true,remoteStreamChanged:true,saved:true});f.exports=h}),null);
__d("RTCAppDispatcher",["ExplicitRegistrationDispatcher"],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c("ExplicitRegistrationDispatcher"));i=h&&h.prototype;function j(k){"use strict";i.constructor.call(this,k);this.dispatch=this.dispatch.bind(this)}f.exports=new j({strict:true})}),null);
__d("BonfireUserFetcher",["regeneratorRuntime","Promise","immutable","LogHistory","RelayFBEnvironment","RelayModern","RTCUser","idx","nullthrows","BonfireUserFetcherQuery.graphql"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i=c("immutable").Set,j=c("immutable").List,k=c("immutable").Map,l=c("RelayModern").graphql,m=c("RelayModern").fetchQuery;function n(u){__p&&__p();return c("regeneratorRuntime").async(function v(w){__p&&__p();while(1)switch(w.prev=w.next){case 0:w.prev=0;w.next=3;return c("regeneratorRuntime").awrap(m(c("RelayFBEnvironment"),h||(h=function h(){return c("BonfireUserFetcherQuery.graphql")}),{userId:u}));case 3:return w.abrupt("return",w.sent);case 6:w.prev=6;w.t0=w["catch"](0);c("LogHistory").getInstance("bonfire_fetcher").error("fetch_error",JSON.stringify(w.t0));throw w.t0;case 10:case"end":return w.stop()}},null,this,[[0,6]])}function o(u){var v,w,x,y,z,A=u.node,B=(v=A)!=null?(v=v.bonfire_user)!=null?v.id:v:v,C=(w=A)!=null?w.id:w;if(!B||!C)return null;var D=c("nullthrows")((x=A)!=null?(x=x.bonfire_user)!=null?x.display_name:x:x),E=c("nullthrows")((y=A)!=null?(y=y.bonfire_user)!=null?y.username:y:y),F=c("nullthrows")((z=A)!=null?(z=z.bonfire_user)!=null?z.profile_picture_uri:z:z);return new(c("RTCUser"))({FBID:C,profileUrl:null,profilePictureUrl:F,isMessengerUser:false,userName:D,userShortName:E})}function p(u){var v,w,x,y,z,A=u.node,B=(v=A)!=null?(v=v.bonfire_user)!=null?v.id:v:v,C=(w=A)!=null?w.id:w;if(!B||!C)return null;var D=c("nullthrows")((x=A)!=null?(x=x.bonfire_user)!=null?x.display_name:x:x),E=c("nullthrows")((y=A)!=null?(y=y.bonfire_user)!=null?y.username:y:y),F=c("nullthrows")((z=A)!=null?(z=z.bonfire_user)!=null?z.profile_picture_uri:z:z);return{accepts_messenger_user_feedback:false,big_image_src:F,employee:false,fbid:C,gender:0,href:null,id:"fbid:"+C,image_src:F,is_business_enabled:null,is_employee_away:null,is_friend:null,is_messenger_user:null,is_messenger_platform_bot:null,is_parties_user:true,is_verified:null,name:D,short_name:D,type:null,vanity:E,timezone:null,personal_id:null,work_id:null}}function q(u){var v;return c("regeneratorRuntime").async(function w(x){while(1)switch(x.prev=x.next){case 0:x.next=2;return c("regeneratorRuntime").awrap(n(u));case 2:v=x.sent;return x.abrupt("return",p(v));case 4:case"end":return x.stop()}},null,this)}function r(u){__p&&__p();var v,w,x,y;return c("regeneratorRuntime").async(function z(A){__p&&__p();while(1)switch(A.prev=A.next){case 0:v=j(u);w=v.map(function(B){return q(B)}).toArray();A.next=4;return c("regeneratorRuntime").awrap(c("Promise").all(w));case 4:x=A.sent;y=k(v.zip(x));return A.abrupt("return",y);case 7:case"end":return A.stop()}},null,this)}function s(u){var v;return c("regeneratorRuntime").async(function w(x){while(1)switch(x.prev=x.next){case 0:x.next=2;return c("regeneratorRuntime").awrap(q(u));case 2:v=x.sent;return x.abrupt("return",c("nullthrows")(v));case 4:case"end":return x.stop()}},null,this)}function t(u){var v;return c("regeneratorRuntime").async(function w(x){while(1)switch(x.prev=x.next){case 0:x.next=2;return c("regeneratorRuntime").awrap(n(u));case 2:v=x.sent;return x.abrupt("return",o(v));case 4:case"end":return x.stop()}},null,this)}f.exports={fetchAllParticipants:r,fetchParticipant:s,fetchUser:t}}),null);
__d("FBRTCMultiwayMessage",["ChannelManager","CurrentUser","FBRTCMessageType","RTCUtils"],(function a(b,c,d,e,f,g){__p&&__p();c("ChannelManager").startChannelManager();function h(i){"use strict";this.$FBRTCMultiwayMessage1=i}h.prototype.isRequest=function(){"use strict";return this.$FBRTCMultiwayMessage1.jsonPayload.header.responseStatusCode==null};h.prototype.isType=function(i){"use strict";return this.header().type==i};h.prototype.transactionId=function(){"use strict";return this.$FBRTCMultiwayMessage1.jsonPayload.header.transactionId};h.prototype.conferenceName=function(){"use strict";return this.$FBRTCMultiwayMessage1.jsonPayload.header.conferenceName};h.prototype.serverInfoData=function(){"use strict";return this.$FBRTCMultiwayMessage1.jsonPayload.header.serverInfoData};h.prototype.message=function(){"use strict";return this.$FBRTCMultiwayMessage1};h.prototype.endpoint=function(){"use strict";return this.$FBRTCMultiwayMessage1.endpoint};h.prototype.header=function(){"use strict";return this.$FBRTCMultiwayMessage1.jsonPayload.header};h.prototype.body=function(){"use strict";return this.$FBRTCMultiwayMessage1.jsonPayload.body};h.prototype.incrementRetryCount=function(){"use strict";this.$FBRTCMultiwayMessage1.jsonPayload.header.retryCount++};h.prototype.ringRequest=function(){"use strict";return this.isRequest()&&this.isType(c("FBRTCMessageType").RING)?this.body().ringRequest:null};h.prototype.dismissRequest=function(){"use strict";return this.isRequest()&&this.isType(c("FBRTCMessageType").DISMISS)?this.body().dismissRequest:null};h.prototype.serverMediaUpdateRequest=function(){"use strict";return this.isRequest()&&this.isType(c("FBRTCMessageType").SERVER_MEDIA_UPDATE)?this.body().serverMediaUpdateRequest:null};h.prototype.conferenceStateRequest=function(){"use strict";return this.isRequest()&&this.isType(c("FBRTCMessageType").CONFERENCE_STATE)?this.body().conferenceStateRequest:null};h.prototype.createResponse=function(i,j){"use strict";var k={endpoint:{appId:"229895473858072",deviceId:c("ChannelManager").getCompleteConfig().sessionID,userId:c("CurrentUser").getID()},jsonPayload:{header:c("RTCUtils").createResponseHeader(this.header(),i),body:j||{}}};return new h(k)};f.exports=h}),null);
__d("XGroupCallSendMessageController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/groupcall/sendmessage/",{webrtc_fbtrace:{type:"Int"}})}),null);
__d("RTCMessageSender",["Promise","CurrentUser","XGroupCallSendMessageController","SiteData","Fbtrace","AsyncRequest"],(function a(b,c,d,e,f,g){__p&&__p();var h=6e3;function i(){"use strict"}i.prototype.send=function(j){"use strict";__p&&__p();return new(c("Promise"))(function(k,l){var m=j.jsonPayload.header.conferenceName,n={conference_name:m,user_id:c("CurrentUser").getID(),message:j,app_id:256281040558,app_version:String(c("SiteData").client_revision||"dev"),op:"RTCMessageSender.send",policy:"WebRTC"},o=c("Fbtrace").requestReceive("browser",String(c("SiteData").client_revision||"dev"),n),p=c("XGroupCallSendMessageController").getURIBuilder().setInt("webrtc_fbtrace",o.isOn()?1:0).getURI();c("Fbtrace").withDefaultNode(o,function(){var q=new(c("AsyncRequest"))(p).setMethod("POST").setData({message:JSON.stringify(j)}).setAllowCrossPageTransition(true).setHandler(function(r){k(r)}).setErrorHandler(function(r){var s=r.getErrorDescription(),t=Error(s!=null?s.toString():"AsyncRequest error");l(t)}).setTimeoutHandler(h,function(){l("Timeout")});q.send()})})};f.exports=i}),null);
__d("FBRTCTransactions",["Promise","Map","RTCMessageSender"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=6e4,i=Object.freeze({INIT:0,PROCESSING:1,COMPLETED:2,TERMINATED:3});function j(){this.$FBRTCTransactionOwner1=new(c("Map"))()}j.prototype.findTransaction=function(l){return this.$FBRTCTransactionOwner1.get(l)};j.prototype.addTransaction=function(l){this.$FBRTCTransactionOwner1.set(l.id,l)};j.prototype.removeTransaction=function(l){this.$FBRTCTransactionOwner1["delete"](l.id)};j.prototype.getTransaction=function(l){return this.findTransaction(l.transactionId())||new k(this,l)};function k(l,m){__p&&__p();this.id=m.transactionId();this.$FBRTCServerTransaction1=i.INIT;this.$FBRTCServerTransaction2=m;this.$FBRTCServerTransaction3=null;this.$FBRTCServerTransaction4=l;this.$FBRTCServerTransaction5=new Error("Unknown");this.$FBRTCServerTransaction6=null;this.$FBRTCServerTransaction7=new(c("RTCMessageSender"))();this.$FBRTCServerTransaction8();this.$FBRTCServerTransaction4.addTransaction(this)}k.prototype.start=function(){__p&&__p();if(this.$FBRTCServerTransaction1==i.INIT){this.$FBRTCServerTransaction9(i.PROCESSING);return c("Promise").resolve(this.$FBRTCServerTransaction2)}else if(this.$FBRTCServerTransaction1==i.PROCESSING)return c("Promise").resolve(null);else if(this.$FBRTCServerTransaction1==i.COMPLETED){this.$FBRTCServerTransaction10();return c("Promise").resolve(null)}return c("Promise").reject(this.$FBRTCServerTransaction5)};k.prototype.sendResponse=function(l){this.$FBRTCServerTransaction3=l;this.$FBRTCServerTransaction9(i.COMPLETED);return this.$FBRTCServerTransaction7.send(l.message()).then(function(m){},function(m){this.$FBRTCServerTransaction5=m;this.$FBRTCServerTransaction9(i.TERMINATED)}.bind(this))};k.prototype.$FBRTCServerTransaction10=function(){if(this.$FBRTCServerTransaction3!=null){var l=this.$FBRTCServerTransaction3;l.incrementRetryCount();this.sendResponse(l)}};k.prototype.$FBRTCServerTransaction9=function(l){if(l!=this.$FBRTCServerTransaction1){this.$FBRTCServerTransaction1=l;if(this.$FBRTCServerTransaction1!=i.TERMINATED)this.$FBRTCServerTransaction8();if(this.$FBRTCServerTransaction1==i.TERMINATED){this.$FBRTCServerTransaction5=new Error("Terminated");this.$FBRTCServerTransaction4.removeTransaction(this)}}};k.prototype.$FBRTCServerTransaction8=function(){if(this.$FBRTCServerTransaction6){clearTimeout(this.$FBRTCServerTransaction6);this.$FBRTCServerTransaction6=null}this.$FBRTCServerTransaction6=setTimeout(function(){this.$FBRTCServerTransaction9(i.TERMINATED)}.bind(this),h)};f.exports={FBRTCTransactionOwner:j,FBRTCServerTransaction:k}}),null);
__d("RTCGroupCallDialogController",["DOM","FBRTCGroupCallVideoEscalationDialog.react","React","ReactDOM","RTCGroupCallAddMembersDialog.react"],(function a(b,c,d,e,f,g){"use strict";var h={_container:c("DOM").create("div"),showAddGroupMembersDialog:function i(j,k,l,m,n){c("ReactDOM").render(c("React").createElement(c("RTCGroupCallAddMembersDialog.react"),{isEscalatedCall:n,participants:j,participantStates:k,thread:l,viewerID:m,onUnmount:function(){return this._onUnmount()}.bind(this)}),this._container)},showVideoEscalationDialog:function i(j,k){c("ReactDOM").render(c("React").createElement(c("FBRTCGroupCallVideoEscalationDialog.react"),{userName:j,onToggle:function(){this._onUnmount();k()}.bind(this)}),this._container)},_onUnmount:function i(){c("ReactDOM").unmountComponentAtNode(this._container)}};f.exports=h}),null);
__d("RTCCallActionTypes",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({INCOMING_CALL_SUCCESS:"INCOMING_CALL_SUCCESS",RESET:"RESET",REMOTE_VIDEO_MUTED:"REMOTE_VIDEO_MUTED",REMOTE_VIDEO_UNMUTED:"REMOTE_VIDEO_UNMUTED"})}),null);
__d("FBRTCCallSummaryReducer",["FBRTCCallSummaryStore","FBRTCParticipantCallState","FBRTCLogger","RTCCallActionTypes","RTCCallStore","RTCConferenceState","RTCGroupCallActionTypes","RTCUtils"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("FBRTCLogger").Key,i={setCallSummary:function j(k,l){switch(l.type){case c("RTCGroupCallActionTypes").SET_CALL_SUMMARY:return k.set("callSummary",l.callSummary)}return k},setMWCallType:function j(k,l){switch(l.type){case c("RTCGroupCallActionTypes").SET_MW_CALL_TYPE:k.callSummary.setCallType(l.callType);k.callSummary.save(c("FBRTCCallSummaryStore").getInstance());return k}return k},onCallStarted:function j(k,l){__p&&__p();switch(l.type){case c("RTCCallActionTypes").INCOMING_CALL_SUCCESS:case c("RTCGroupCallActionTypes").CALL_SUCCESS:var m=function m(){var n=c("RTCCallStore").getState().callInfo.conferenceState;if(n!==c("RTCConferenceState").TERMINATED){k.callSummary.save(c("FBRTCCallSummaryStore").getInstance());setTimeout(m,1e4)}};m();return k}return k},onMessageSignaling:function j(k,l){__p&&__p();switch(l.type){case c("RTCGroupCallActionTypes").ON_JOIN_REQUEST_SENT:if(k.callSummary.isCaller())k.callSummary.setOfferSentTime();else k.callSummary.setAnswerSentTime();k.callSummary.save(c("FBRTCCallSummaryStore").getInstance());return k;case c("RTCGroupCallActionTypes").ON_JOIN_RESPONSE:if(!k.callSummary.isCaller()){k.callSummary.onCallConnected();k.callSummary.onNetworkReady();k.callSummary.save(c("FBRTCCallSummaryStore").getInstance())}k.callSummary.setServerInfoData(l.serverInfoData);k.callSummary.save(c("FBRTCCallSummaryStore").getInstance());return k;case c("RTCGroupCallActionTypes").ON_SERVER_MEDIA_UPDATE_SUCCESS:if(k.callSummary.isCaller()){k.callSummary.setAnswerReceivedTime();if(k.callSummary.isNetworkReady())k.callSummary.onCallConnected();k.callSummary.save(c("FBRTCCallSummaryStore").getInstance())}return k;case c("RTCGroupCallActionTypes").ON_CONFERENCE_STATE:var m=c("RTCCallStore").getState().callInfo.conferenceName;if(c("RTCUtils").isGroupCall(m)){k.callSummary.onNetworkReady();k.callSummary.save(c("FBRTCCallSummaryStore").getInstance())}var n=l.request.conferenceStateRequest(),o=n.participantStates;Object.keys(o).forEach(function(p){if(p!==c("RTCCallStore").getState().localUser.FBID)switch(o[p].state){case c("FBRTCParticipantCallState").UNKNOWN:case c("FBRTCParticipantCallState").CONTACTING:case c("FBRTCParticipantCallState").UNREACHABLE:return;case c("FBRTCParticipantCallState").CONNECTED:k.callSummary.onNetworkReady();if(k.callSummary.isAnswerReceived())k.callSummary.onCallConnected();default:if(k.callSummary.isCaller())k.callSummary.setOfferAckReceivedTime();k.callSummary.save(c("FBRTCCallSummaryStore").getInstance())}});return k}return k},onCallEnded:function j(k,l){switch(l.type){case c("RTCGroupCallActionTypes").CALL_ERROR:case c("RTCGroupCallActionTypes").HANGUP:case c("RTCGroupCallActionTypes").END_CALL:k.callSummary.onCallEnded(l.endCallReason,false,false,l.endCallSubreason);k.callSummary.save(c("FBRTCCallSummaryStore").getInstance());return k;case c("RTCGroupCallActionTypes").DISMISS:k.callSummary.onCallEnded(l.endCallReason,true,false,l.endCallSubreason);k.callSummary.save(c("FBRTCCallSummaryStore").getInstance());return k}return k},onSurveyResult:function j(k,l){__p&&__p();switch(l.type){case c("RTCGroupCallActionTypes").RATING_SHOWN:k.callSummary.addExtraInfo(h.RATING_SHOWN,"1");k.callSummary.save(c("FBRTCCallSummaryStore").getInstance());return k;case c("RTCGroupCallActionTypes").FEEDBACK_SHOWN:k.callSummary.addExtraInfo(h.SURVEY_SHOWN,"1");k.callSummary.save(c("FBRTCCallSummaryStore").getInstance());return k;case c("RTCGroupCallActionTypes").SUBMIT_RATING:k.callSummary.addExtraInfo(h.RATING,l.rating);k.callSummary.save(c("FBRTCCallSummaryStore").getInstance());return k;case c("RTCGroupCallActionTypes").SUBMIT_FEEDBACK:k.callSummary.addExtraInfo(h.SURVEY_DETAILS,l.feedback);k.callSummary.save(c("FBRTCCallSummaryStore").getInstance());return k}return k}};f.exports=i}),null);
__d("RTCGroupCallEscalationActionTypes",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({GROUP_ESCALATION_START:"GROUP_ESCALATION_START",GROUP_ESCALATION_SUCCESS:"GROUP_ESCALATION_SUCCESS",GROUP_ESCALATION_CANCEL:"GROUP_ESCALATION_CANCEL",GROUP_ESCALATION_SET_USERS_TO_RING:"GROUP_ESCALATION_SET_USERS_TO_RING",GROUP_ESCALATION_CLEAR_P2P_CONNECTION:"GROUP_ESCALATION_CLEAR_P2P_CONNECTION"})}),null);
__d("RTCCallReducer",["invariant","FBRTCConstants","FBRTCParticipantCallState","FBRTCRtcResponseStatusCode","immutable","RTCCallActionTypes","RTCCallStore","RTCConferenceState","RTCGroupCallActionTypes","RTCGroupCallEscalationActionTypes","RTCUser","RTCUtils","URI"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=c("FBRTCConstants").SignalingProtocol;function j(B,C){switch(C.type){case c("RTCGroupCallActionTypes").INIT:return B.set("callInfo",B.callInfo.set("conferenceName",C.conferenceName).set("serverInfoData",C.serverInfoData).set("protocol",C.protocol));case c("RTCCallActionTypes").RESET:return B.set("callInfo",B.callInfo.set("conferenceState",c("RTCConferenceState").NEW).set("conferenceName",C.conferenceName)).set("callSummary",null).set("connections",c("immutable").Set()).set("remoteUsers",B.remoteUsers.map(function(D){return D.removeAllStreams()}))}return B}function k(B,C){switch(C.type){case c("RTCGroupCallActionTypes").CALL:return B.setIn(["callInfo","conferenceState"],c("RTCConferenceState").CONNECTING).set("connections",B.connections.add(C.peerConnection));case c("RTCGroupCallActionTypes").CALL_ERROR:return B.setIn(["callInfo","conferenceState"],c("RTCConferenceState").TERMINATED);case c("RTCGroupCallActionTypes").CALL_SUCCESS:if(C.connected)return B.setIn(["callInfo","conferenceState"],c("RTCConferenceState").CONNECTED);return B}return B}function l(B,C){switch(C.type){case c("RTCCallActionTypes").INCOMING_CALL_SUCCESS:return B.setIn(["callInfo","conferenceState"],c("RTCConferenceState").CONNECTED)}return B}function m(B,C){__p&&__p();switch(C.type){case c("RTCGroupCallActionTypes").HANGUP:B.connections.forEach(function(D){return D.close()});return B.setIn(["callInfo","conferenceState"],c("RTCConferenceState").TERMINATING).set("connections",c("immutable").Set()).set("remoteUsers",B.remoteUsers.map(function(D){return D.removeAllStreams()}));case c("RTCGroupCallActionTypes").DISMISS:C.transaction.sendResponse(C.request.createResponse(c("FBRTCRtcResponseStatusCode").OK,{}));case c("RTCGroupCallActionTypes").END_CALL:B.connections.forEach(function(D){return D.close()});return B.setIn(["callInfo","conferenceState"],c("RTCConferenceState").TERMINATED).set("connections",c("immutable").Set()).set("remoteUsers",B.remoteUsers.map(function(D){return D.removeAllStreams()}));case c("RTCGroupCallActionTypes").HANGUP_ERROR:case c("RTCGroupCallActionTypes").HANGUP_SUCCESS:return B.setIn(["callInfo","conferenceState"],c("RTCConferenceState").TERMINATED)}return B}function n(B,C){__p&&__p();var D;switch(C.type){case c("RTCGroupCallEscalationActionTypes").GROUP_ESCALATION_CLEAR_P2P_CONNECTION:var E=c("RTCCallStore").getConnection(i.P2P);if(E){var D=function(){var F=E.getLocalStreams(),G=F[0],H=E.getRemoteStreams(),I=H[0];E.close();return{v:B.withMutations(function(B){B.set("connections",B.connections.remove(E)).set("localUser",B.localUser.removeStream(G)).set("remoteUsers",B.remoteUsers.map(function(J){return J.removeStream(I)}))})}}();if(typeof D==="object")return D.v}}return B}function o(B,C){__p&&__p();var D;switch(C.type){case c("RTCGroupCallEscalationActionTypes").GROUP_ESCALATION_CANCEL:var E=c("RTCCallStore").getConnection(i.MULTIWAY);if(E){var D=function(){var F=E.getLocalStreams(),G=F[0],H=E.getRemoteStreams(),I=H[0];E.close();return{v:B.withMutations(function(B){B.set("connections",B.connections.remove(E)).set("localUser",B.localUser.removeStream(G)).set("remoteUsers",B.remoteUsers.map(function(J){return J.removeStream(I)}))})}}();if(typeof D==="object")return D.v}}return B}function p(B,C){__p&&__p();switch(C.type){case c("RTCGroupCallActionTypes").ON_PARTICIPANTS_ADDED:var D=B.remoteUsers.map(function(E){return E.FBID});return B.set("remoteUsers",B.remoteUsers.union(Object.keys(C.participants).filter(function(E){return!D.has(C.participants[E].fbid)}).map(function(E){var F=C.participants[E],G=F.big_image_src||F.image_src;if(C.images&&C.images[E])G=C.images[E];F.fbid||h(0);return new(c("RTCUser"))({FBID:F.fbid,profileUrl:new(c("URI"))(F.href),profilePictureUrl:G,isMessengerUser:!!F.is_messenger_user,isPartiesUser:!!F.is_parties_user,userName:F.name,userShortName:F.short_name,vanity:F.vanity})})))}return B}function q(B,C){__p&&__p();switch(C.type){case c("RTCGroupCallActionTypes").ON_CONFERENCE_STATE:var D=C.transaction,E=C.request,F=C.request.conferenceStateRequest();if(C.conferenceStateVersion>=F.version){D.sendResponse(E.createResponse(c("FBRTCRtcResponseStatusCode").OK,{ConferenceStateResponse:{currentVerison:C.conferenceStateVersion}}));return B}C.resolve(F.version);var G=B.remoteUsers.map(function(J){var K=F.participantStates[J.FBID];return K?J.setParticipantState(K):J}),H=G.some(function(J){var K=J.participantState;return K&&K.state===c("FBRTCParticipantCallState").CONNECTED}),I=H?c("RTCConferenceState").CONNECTED:B.callInfo.conferenceState;D.sendResponse(E.createResponse(c("FBRTCRtcResponseStatusCode").OK,{ConferenceStateResponse:{currentVerison:C.conferenceStateVersion}}));return B.setIn(["remoteUsers"],G).setIn(["callInfo","conferenceState"],I)}return B}function r(B,C){switch(C.type){case c("RTCGroupCallActionTypes").ON_JOIN_RESPONSE:return B.setIn(["callInfo","serverInfoData"],C.serverInfoData)}return B}function s(B,C){switch(C.type){case c("RTCGroupCallActionTypes").INIT_LOCAL_USER:return B.set("localUser",C.localUser);case c("RTCGroupCallActionTypes").INIT_REMOTE_USERS:return B.set("remoteUsers",C.remoteUsers)}return B}function t(B,C){__p&&__p();switch(C.type){case c("RTCGroupCallActionTypes").ADD_LOCAL_STREAM:return B.set("localUser",B.localUser.addStream(C.stream));case c("RTCGroupCallActionTypes").SET_PREFERRED_LOCAL_STREAM:return B.set("localUser",B.localUser.setPreferredStream(C.stream));case c("RTCGroupCallActionTypes").REMOVE_LOCAL_STREAM:return B.set("localUser",B.localUser.removeStream(C.stream));case c("RTCGroupCallActionTypes").REPLACE_LOCAL_STREAM:var D=C.oldStream.getAudioTracks(),E=D[0];if(E!=null)for(var F=C.newStream.getAudioTracks(),G=Array.isArray(F),H=0,F=G?F:F[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var I;if(G){if(H>=F.length)break;I=F[H++]}else{H=F.next();if(H.done)break;I=H.value}var J=I;J.enabled=E.enabled}return B.set("localUser",B.localUser.replaceStream(C.oldStream,C.newStream));case c("RTCGroupCallActionTypes").REMOVE_ALL_LOCAL_STREAMS:if(C.stopStreams)for(var K=B.localUser.streams,L=Array.isArray(K),M=0,K=L?K:K[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var N;if(L){if(M>=K.length)break;N=K[M++]}else{M=K.next();if(M.done)break;N=M.value}var O=N;c("RTCUtils").stopMediaStream(O)}return B.set("localUser",B.localUser.removeAllStreams())}return B}function u(B,C){__p&&__p();switch(C.type){case c("RTCGroupCallActionTypes").ADD_LOCAL_SCREEN_STREAM:return B.set("localUser",B.localUser.addScreenStream(C.stream));case c("RTCGroupCallActionTypes").REMOVE_LOCAL_SCREEN_STREAM:return B.set("localUser",B.localUser.removeScreenStream(C.stream));case c("RTCGroupCallActionTypes").REMOVE_ALL_LOCAL_SCREEN_STREAMS:if(C.stopStreams)for(var D=B.localUser.screenStreams,E=Array.isArray(D),F=0,D=E?D:D[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var G;if(E){if(F>=D.length)break;G=D[F++]}else{F=D.next();if(F.done)break;G=F.value}var H=G;c("RTCUtils").stopMediaStream(H)}return B.set("localUser",B.localUser.removeAllScreenStreams())}return B}function v(B,C){__p&&__p();var D=void 0;switch(C.type){case c("RTCGroupCallActionTypes").ADD_REMOTE_STREAM:D=z(B,C);if(!D)return B;return B.setIn(["remoteUsers"],B.remoteUsers["delete"](D).add(D.addStream(C.stream)));case c("RTCGroupCallActionTypes").SET_PREFERRED_REMOTE_STREAM:D=z(B,C);if(!D)return B;return B.setIn(["remoteUsers"],B.remoteUsers["delete"](D).add(D.setPreferredStream(C.stream)));case c("RTCGroupCallActionTypes").REMOVE_REMOTE_STREAM:D=z(B,C);if(!D)return B;return B.setIn(["remoteUsers"],B.remoteUsers["delete"](D).add(D.removeStream(C.stream)));case c("RTCGroupCallActionTypes").REMOVE_ALL_REMOTE_STREAMS:D=z(B,C);if(!D)return B;return B.setIn(["remoteUsers"],B.remoteUsers["delete"](D).add(D.removeAllStreams().removeAllScreenStreams()))}return B}function w(B,C){__p&&__p();var D=void 0;switch(C.type){case c("RTCGroupCallActionTypes").ADD_REMOTE_TRACK:D=z(B,C);if(!D)return B;return B.setIn(["remoteUsers"],B.remoteUsers["delete"](D).add(D.clone()));case c("RTCGroupCallActionTypes").REMOVE_REMOTE_TRACK:D=z(B,C);if(!D)return B;return B.setIn(["remoteUsers"],B.remoteUsers["delete"](D).add(D.clone()))}return B}function x(B,C){__p&&__p();var D=void 0;switch(C.type){case c("RTCGroupCallActionTypes").ADD_REMOTE_SCREEN_STREAM:D=z(B,C);if(!D)return B;return B.setIn(["remoteUsers"],B.remoteUsers["delete"](D).add(D.addScreenStream(C.stream)));case c("RTCGroupCallActionTypes").REMOVE_REMOTE_SCREEN_STREAM:D=z(B,C);if(!D)return B;return B.setIn(["remoteUsers"],B.remoteUsers["delete"](D).add(D.removeScreenStream(C.stream)))}return B}function y(B,C){__p&&__p();var D=void 0;switch(C.type){case c("RTCGroupCallActionTypes").TOGGLE_REMOTE_STREAM:return B.set("remoteUsers",Object.entries(C.mediaStatus).reduce(function(E,F){__p&&__p();var G=F[0],H=F[1],I=E.reduce(function(K,D){var J=D.streams.map(function(L){return L.getTracks().find(function(J){return J.id===G})}).find(Boolean);return J?{user:D,track:J}:K},{}),D=I.user,J=I.track;if(D&&J){if(J.kind==="audio"&&D.isAudioMuted()===H)return E["delete"](D).add(D.toggleMuteAudio());if(J.kind==="video"&&D.isVideoMuted()===H)return E["delete"](D).add(D.toggleMuteVideo())}return E},B.remoteUsers));case c("RTCCallActionTypes").REMOTE_VIDEO_MUTED:D=z(B,C);if(!D)return B;return B.setIn(["remoteUsers"],B.remoteUsers["delete"](D).add(D.toggleMuteVideo(true)));case c("RTCCallActionTypes").REMOTE_VIDEO_UNMUTED:D=z(B,C);if(!D)return B;return B.setIn(["remoteUsers"],B.remoteUsers["delete"](D).add(D.toggleMuteVideo(false)))}return B}function z(B,C){return B.remoteUsers.find(function(D){if(C.userID)return D.FBID==C.userID;return D.FBID===C.stream.id.split(":")[0]})}function A(B,C){switch(C.type){case c("RTCGroupCallActionTypes").WAIT_FOR_USER_INPUT:if(B.callInfo.conferenceState===c("RTCConferenceState").NEW)return B.setIn(["callInfo","conferenceState"],c("RTCConferenceState").AWAITING_USER_START);return B}return B}f.exports={abortMultiwayEscalationProcess:o,callInit:j,callStart:k,callEnd:m,completeTransitionToMultiway:n,onParticipantsChanged:p,incomingCallStart:l,initUsers:s,processLocalStream:t,processLocalScreenStream:u,processRemoteStream:v,processRemoteScreenStream:x,processRemoteTrack:w,toggleRemoteStream:y,processConferenceState:q,processJoinResponse:r,waitForUserInput:A}}),null);
__d("RTCCallControlReducer",["RTCGroupCallActionTypes"],(function a(b,c,d,e,f,g){"use strict";function h(i,j){switch(j.type){case c("RTCGroupCallActionTypes").AUDIO_MUTED:case c("RTCGroupCallActionTypes").AUDIO_UNMUTED:return i.set("localUser",i.localUser.toggleMuteAudio());case c("RTCGroupCallActionTypes").VIDEO_MUTED:case c("RTCGroupCallActionTypes").VIDEO_UNMUTED:return i.set("localUser",i.localUser.toggleMuteVideo())}return i}f.exports={toggleLocalStream:h}}),null);
__d("RTCCallStore",["BonfireCallLogger","FBRTCCallSummaryReducer","FluxReduceStore","MessengerRTCFunnelLogger","RTCAppDispatcher","RTCCallControlReducer","RTCCallReducer","RTCCallStoreState"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=[c("FBRTCCallSummaryReducer").onCallEnded,c("FBRTCCallSummaryReducer").onCallStarted,c("FBRTCCallSummaryReducer").onMessageSignaling,c("FBRTCCallSummaryReducer").onSurveyResult,c("FBRTCCallSummaryReducer").setCallSummary,c("FBRTCCallSummaryReducer").setMWCallType,c("RTCCallControlReducer").toggleLocalStream,c("RTCCallReducer").abortMultiwayEscalationProcess,c("RTCCallReducer").callEnd,c("RTCCallReducer").callInit,c("RTCCallReducer").callStart,c("RTCCallReducer").completeTransitionToMultiway,c("RTCCallReducer").incomingCallStart,c("RTCCallReducer").initUsers,c("RTCCallReducer").onParticipantsChanged,c("RTCCallReducer").processConferenceState,c("RTCCallReducer").processJoinResponse,c("RTCCallReducer").processLocalScreenStream,c("RTCCallReducer").processLocalStream,c("RTCCallReducer").processRemoteScreenStream,c("RTCCallReducer").processRemoteStream,c("RTCCallReducer").processRemoteTrack,c("RTCCallReducer").toggleRemoteStream,c("RTCCallReducer").waitForUserInput,c("MessengerRTCFunnelLogger").logRTCCallAction,c("BonfireCallLogger").logRTCCallAction];h=babelHelpers.inherits(k,c("FluxReduceStore"));i=h&&h.prototype;k.prototype.getInitialState=function(){return new(c("RTCCallStoreState"))()};k.prototype.reduce=function(l,m){return j.reduce(function(l,n){return n(l,m)},l)};k.prototype.getConnection=function(l){var m=this.getState(),n=m.connections;if(l)n=n.filter(function(o){return o.getSignalingProtocol()===l});return n.first()};function k(){h.apply(this,arguments)}f.exports=new k(c("RTCAppDispatcher"))}),null);
__d("RTCGroupCallActions",["RTCAppDispatcher","RTCGroupCallActionTypes","RTCUtils"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h={setMWCallType:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").SET_MW_CALL_TYPE,callType:j})},setLayout:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").SET_LAYOUT,layout:j})},setDominantSpeaker:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").SET_DOMINANT_SPEAKER,dominantSpeakerFBID:j})},setPinnedSpeaker:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").SET_PINNED_SPEAKER,pinnedSpeakerFBID:j})},setUseDominantSpeakeView:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").SET_USE_DOMINANT_SPEAKE_VIEW,useDominantSpeakeView:j})},setUseGridView:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").SET_GRID_VIEW,useGridView:j})},setUseStripView:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").SET_STRIP_VIEW,useStripView:j})},initThread:function i(j,k){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").INIT_THREAD,thread:j,participants:k})},onParticipantLeft:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").ON_PARTICIPANT_LEFT,participantFBID:j})},onParticipantsAdded:function i(j,k){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").ON_PARTICIPANTS_ADDED,participants:j,images:k})},addParticipantsToRing:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").ADD_PARTICIPANTS_TO_RING,participantFBIDs:j})},toggleRemoteStream:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").TOGGLE_REMOTE_STREAM,mediaStatus:j})},handleDismissRequest:function i(j,k){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").DISMISS,transaction:j,request:k,endCallReason:c("RTCUtils").endCallReasonFromDismissRequest(k.dismissRequest())})},handleConferenceStateRequest:function i(j,k,l,m){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").ON_CONFERENCE_STATE,transaction:j,request:k,conferenceStateVersion:l,resolve:m})},onJoinRequestSent:function i(){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").ON_JOIN_REQUEST_SENT})},onJoinResponse:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").ON_JOIN_RESPONSE,serverInfoData:j})},onServerMediaUpdateSuccess:function i(){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").ON_SERVER_MEDIA_UPDATE_SUCCESS})},onClientMediaUpdateResponse:function i(j,k){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").ON_CLIENT_MEDIA_UPDATE_RESPONSE,responseStatusCode:j,currentVersion:k})}};f.exports=h}),null);
__d("RTCMWSessionDescription",["Promise","FBRTCConstants","FBRTCMediaType","RTCCallStore","RTCConfig","RTCGroupCallActions","RTCGroupCallDialogController"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("FBRTCConstants").SignalingProtocol,i={_videoEnabled:{},serverMediaUpdate:function j(k,l){__p&&__p();var m,n=k.fromVersion,o=k.toVersion,p=k.mediaUpdates,q=c("RTCCallStore").getConnection(h.MULTIWAY);if(!q)return;var r=q.getLocalDescription(),s=q.getRemoteDescription(),t=s.sessionDescription.getVersion();if(t!==n){l(t);return}var u=function(){__p&&__p();p.forEach(function(v){s.processServerMediaUpdate(v);v.media.forEach(function(w){var x=w.type,y=w.enabled;if(x===c("FBRTCMediaType").VIDEO)this._videoEnabled[v.sourceKey]=y}.bind(this))}.bind(this));s.sessionDescription.setVersion(o);c("Promise").all([q.setLocalDescription(r),q.setRemoteDescription(s)]).then(function(){var w;c("RTCGroupCallActions").toggleRemoteStream((w=[]).concat.apply(w,p.map(function(x){var y=x.media;return y})).reduce(function(x,y){var z=y.id,A=y.enabled;x[z]=A;return x},{}));l(o)},function(){return l(t)})["catch"](function(w){})}.bind(this),v=p.find(function(w){var x=w.sourceKey,y=w.media;return!this._videoEnabled[x]&&y.some(function(z){var A=z.type,B=z.enabled;return A===c("FBRTCMediaType").VIDEO&&B})}.bind(this));if(c("RTCConfig").RtcConferencingVideoGK&&!c("RTCCallStore").getState().localUser.hasVideo()&&v)(function(){var w=v.sourceKey.split(":"),x=w[0],y=c("RTCCallStore").getState().remoteUsers.find(function(y){return y.FBID===x});c("RTCGroupCallDialogController").showVideoEscalationDialog(y.userName,u)})();else u()}};f.exports=i}),null);
__d("MultiwayParticipantFetcher",["Promise","regeneratorRuntime","BonfireUserFetcher","ImmutableObject","MercuryIDs","MercuryParticipants","immutable","RTCUtils"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("immutable").Set,i=c("immutable").Map;function j(o){var p=c("MercuryIDs").getParticipantIDFromUserID(o);return new(c("Promise"))(function(q,r){try{c("MercuryParticipants").get(p,function(t){q(t)})}catch(s){r(s)}})}function k(o,p){var q=o.map(function(r){return c("MercuryIDs").getParticipantIDFromUserID(r)});return new(c("Promise"))(function(r,s){try{c("MercuryParticipants").getBigImageMulti(q.toArray(),function(u){r(c("immutable").fromJS(u))},p)}catch(t){s(t)}})}function l(o){var p=o.map(function(q){return c("MercuryIDs").getParticipantIDFromUserID(q)});return new(c("Promise"))(function(q,r){try{c("MercuryParticipants").getMulti(p.toArray(),function(t){q(c("immutable").fromJS(t))})}catch(s){r(s)}})}function m(o,p){__p&&__p();var q,r=this,s,q;return c("regeneratorRuntime").async(function t(u){__p&&__p();while(1)switch(u.prev=u.next){case 0:u.next=2;return c("regeneratorRuntime").awrap(l(o));case 2:s=u.sent;if(!p.profileImageSize){u.next=9;break}u.next=6;return c("regeneratorRuntime").awrap(function v(){__p&&__p();var w;return c("regeneratorRuntime").async(function x(y){__p&&__p();while(1)switch(y.prev=y.next){case 0:y.next=2;return c("regeneratorRuntime").awrap(k(o,p.profileImageSize));case 2:w=y.sent;return y.abrupt("return",{v:s.withMutations(function(z){w.forEach(function(A,B){var C=z.get(B);if(C){var D=c("ImmutableObject").setProperty(C,"big_image_src",A);z.set(B,D)}})})});case 4:case"end":return y.stop()}},null,r)}());case 6:q=u.sent;if(!(typeof q==="object")){u.next=9;break}return u.abrupt("return",q.v);case 9:return u.abrupt("return",s);case 10:case"end":return u.stop()}},null,this)}var n={fetchParticipant:function o(p,q){__p&&__p();return c("regeneratorRuntime").async(function r(s){__p&&__p();while(1)switch(s.prev=s.next){case 0:if(!c("RTCUtils").isPartiesCall(p)){s.next=6;break}s.next=3;return c("regeneratorRuntime").awrap(c("BonfireUserFetcher").fetchParticipant(q));case 3:return s.abrupt("return",s.sent);case 6:s.next=8;return c("regeneratorRuntime").awrap(j(q));case 8:return s.abrupt("return",s.sent);case 9:case"end":return s.stop()}},null,this)},fetchAllParticipants:function o(p,q){__p&&__p();var r=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];return c("regeneratorRuntime").async(function s(t){__p&&__p();while(1)switch(t.prev=t.next){case 0:if(!c("RTCUtils").isPartiesCall(p)){t.next=6;break}t.next=3;return c("regeneratorRuntime").awrap(c("BonfireUserFetcher").fetchAllParticipants(q));case 3:return t.abrupt("return",t.sent);case 6:t.next=8;return c("regeneratorRuntime").awrap(m(q,r));case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}},null,this)}};f.exports=n}),null);
__d("RTCCallActions",["RTCAppDispatcher","RTCCallActionTypes","RTCGroupCallActionTypes","RTCGroupCallEscalationActionTypes","RTCUtils","emptyFunction","mixInEventEmitter"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h={addListener:c("emptyFunction"),emit:c("emptyFunction"),initialize:function i(j,k,l,m,n){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").INIT,conferenceName:k,callID:m,serverInfoData:l,protocol:j,callTrigger:n})},reset:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCCallActionTypes").RESET,conferenceName:j})},setCallSummary:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").SET_CALL_SUMMARY,callSummary:j})},call:function i(j,k){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").CALL,usersToRing:j,peerConnection:k})},callSuccess:function i(){var j=arguments.length<=0||arguments[0]===undefined?false:arguments[0];c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").CALL_SUCCESS,connected:j})},incomingCallSuccess:function i(){c("RTCAppDispatcher").dispatch({type:c("RTCCallActionTypes").INCOMING_CALL_SUCCESS})},callError:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").CALL_ERROR,endCallReason:c("RTCUtils").endCallReasonFromResponseStatusCode(j),endCallSubreason:"Call error: "+(j||0)})},completeTransitionToMultiway:function i(){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallEscalationActionTypes").GROUP_ESCALATION_CLEAR_P2P_CONNECTION})},hangupSuccess:function i(){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").HANGUP_SUCCESS})},hangupError:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").HANGUP_ERROR,error:j})},join:function i(j){h.call([],j)},hangup:function i(j,k){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").HANGUP,hangupReason:j,detailedReasonString:k,endCallReason:c("RTCUtils").endCallReasonFromHangupReason(j)})},initLocalUser:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").INIT_LOCAL_USER,localUser:j})},initRemoteUsers:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").INIT_REMOTE_USERS,remoteUsers:j})},addLocalStream:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").ADD_LOCAL_STREAM,stream:j})},setPreferredLocalStream:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").SET_PREFERRED_LOCAL_STREAM,stream:j})},removeLocalStream:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").REMOVE_LOCAL_STREAM,stream:j})},replaceLocalStream:function i(j,k){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").REPLACE_LOCAL_STREAM,oldStream:j,newStream:k})},removeAllLocalStreams:function i(){var j=arguments.length<=0||arguments[0]===undefined?false:arguments[0];c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").REMOVE_ALL_LOCAL_STREAMS,stopStreams:j})},removeAllLocalScreenStreams:function i(){var j=arguments.length<=0||arguments[0]===undefined?false:arguments[0];c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").REMOVE_ALL_LOCAL_SCREEN_STREAMS,stopStreams:j})},addRemoteStream:function i(j,k){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").ADD_REMOTE_STREAM,stream:j,userID:k})},setPreferredRemoteStream:function i(j,k){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").SET_PREFERRED_REMOTE_STREAM,stream:j,userID:k})},removeRemoteStream:function i(j,k){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").REMOVE_REMOTE_STREAM,stream:j,userID:k})},removeAllRemoteStreams:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").REMOVE_ALL_REMOTE_STREAMS,userID:j})},addRemoteTrack:function i(j,k){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").ADD_REMOTE_TRACK,stream:j,track:k})},removeRemoteTrack:function i(j,k){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").REMOVE_REMOTE_TRACK,stream:j,track:k})},addLocalScreenStream:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").ADD_LOCAL_SCREEN_STREAM,stream:j})},removeLocalScreenStream:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").REMOVE_LOCAL_SCREEN_STREAM,stream:j})},addRemoteScreenStream:function i(j,k){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").ADD_REMOTE_SCREEN_STREAM,stream:j,userID:k})},removeRemoteScreenStream:function i(j,k){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").REMOVE_REMOTE_SCREEN_STREAM,stream:j,userID:k})},endCall:function i(j,k){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").END_CALL,endCallReason:j,endCallSubreason:k})},waitForUserInput:function i(){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").WAIT_FOR_USER_INPUT})},toggleMuteAudio:function i(j){c("RTCAppDispatcher").dispatch({type:j?c("RTCGroupCallActionTypes").AUDIO_UNMUTED:c("RTCGroupCallActionTypes").AUDIO_MUTED})},toggleMuteVideo:function i(j){c("RTCAppDispatcher").dispatch({type:j?c("RTCGroupCallActionTypes").VIDEO_UNMUTED:c("RTCGroupCallActionTypes").VIDEO_MUTED})},toggleMuteRemoteVideo:function i(j,k){c("RTCAppDispatcher").dispatch({type:j?c("RTCCallActionTypes").REMOTE_VIDEO_MUTED:c("RTCCallActionTypes").REMOTE_VIDEO_UNMUTED,userID:k})},toggleSelfView:function i(j){c("RTCAppDispatcher").dispatch({type:j?c("RTCGroupCallActionTypes").SELF_VIEW_COLLAPSED:c("RTCGroupCallActionTypes").SELF_VIEW_UNCOLLAPSED})},submitRating:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").SUBMIT_RATING,rating:j})},submitFeedback:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").SUBMIT_FEEDBACK,feedback:j})},ratingShown:function i(){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").RATING_SHOWN})},feedbackShown:function i(){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallActionTypes").FEEDBACK_SHOWN})}};c("mixInEventEmitter")(h,{onIceConnectionStateChange:true});f.exports=h}),null);
__d("RTCMultiwayMessageHandler",["Arbiter","ChannelConstants","CurrentUser","FBRTCCallSummary","FBRTCCapability","FBRTCDeviceStatus","FBRTCHangupReason","FBRTCMultiwayMessage","FBRTCRtcResponseStatusCode","FBRTCTransactions","immutable","MultiwayParticipantFetcher","RTCCallActions","RTCCallStore","RTCGroupCallActions","RTCMWProtocolHandler","RTCMWSessionDescription","RTCUtils"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("FBRTCTransactions").FBRTCServerTransaction,i=c("FBRTCTransactions").FBRTCTransactionOwner;function j(){this.$RTCMultiwayMessageHandler3=-1;this.$RTCMultiwayMessageHandler5()}j.prototype.initialize=function(k,l){this.$RTCMultiwayMessageHandler1=k;this.$RTCMultiwayMessageHandler2=l};j.initHandler=function(k,l){new j().initialize(k,l)};j.close=function(){if(j.$RTCMultiwayMessageHandler4){c("Arbiter").unsubscribe(j.$RTCMultiwayMessageHandler4);j.$RTCMultiwayMessageHandler4=null}};j.prototype.$RTCMultiwayMessageHandler5=function(){j.$RTCMultiwayMessageHandler4=c("Arbiter").subscribe([c("ChannelConstants").getArbiterType("rtc_live_json"),c("ChannelConstants").getArbiterType("rtc_multi_json")],function(k,l){this.$RTCMultiwayMessageHandler6(l.obj)}.bind(this))};j.prototype.$RTCMultiwayMessageHandler6=function(k){__p&&__p();var l,m=this,n=new(c("FBRTCMultiwayMessage"))(k);if(!n.isRequest())return;if(this.$RTCMultiwayMessageHandler1===n.conferenceName())this.$RTCMultiwayMessageHandler7(n);else if(n.ringRequest())(function(){var o=new h(new i(),n);o.start().done(function(p){var q=c("RTCUtils").generateRandomInt(),r=new(c("FBRTCCallSummary"))({peerID:c("RTCUtils").isGroupCall(p.conferenceName())?-1:c("RTCUtils").getPeerID(p.conferenceName()),callID:q,isCaller:false});o.sendResponse(this.$RTCMultiwayMessageHandler8(p,q,r)).done(function(){return c("RTCMWProtocolHandler").otherUserInAnotherCall(n.conferenceName(),n.serverInfoData(),c("FBRTCHangupReason").IN_ANOTHER_CALL,"InAnotherCall")})}.bind(m))})()};j.prototype.$RTCMultiwayMessageHandler8=function(k,l,m){var n=k.ringRequest(),o=k.serverInfoData();if(n==null||o==null)return k.createResponse(c("FBRTCRtcResponseStatusCode").BAD_REQUEST);var p={deviceCapabilities:[c("FBRTCCapability").SUPPORT_AUDIO_DEPRECATED,c("FBRTCCapability").SUPPORT_VIDEO_DEPRECATED],deviceStatus:c("FBRTCDeviceStatus").OK};return k.createResponse(c("FBRTCRtcResponseStatusCode").OK,{ringResponse:p})};j.prototype.$RTCMultiwayMessageHandler7=function(k){__p&&__p();var l=new h(new i(),k);l.start().then(function(m){__p&&__p();var n,o=this;if(m!=null)if(m.dismissRequest()!=null){var p=c("RTCCallStore").getState(),q=p.callInfo,r=p.connections;if(m.serverInfoData()===q.serverInfoData){c("RTCGroupCallActions").handleDismissRequest(l,m);j.close();r.forEach(function(s){return s.close()});c("RTCCallActions").removeAllLocalStreams(true)}}else if(m.serverMediaUpdateRequest()!=null)c("RTCMWSessionDescription").serverMediaUpdate(m.serverMediaUpdateRequest(),function(s){c("RTCGroupCallActions").onServerMediaUpdateSuccess();l.sendResponse(m.createResponse(c("FBRTCRtcResponseStatusCode").OK,{serverMediaUpdateResponse:{currentVersion:s}}))});else if(m.conferenceStateRequest()!=null)(function(){__p&&__p();var s=c("RTCCallStore").getState(),t=s.remoteUsers,u=t.map(function(x){return x.FBID}),v=Object.keys(m.conferenceStateRequest().participantStates),w=v.filter(function(x){return x!==c("CurrentUser").getID()&&!u.has(x)});if(w.length>0)c("MultiwayParticipantFetcher").fetchAllParticipants(o.$RTCMultiwayMessageHandler1,c("immutable").Set(w),{profileImageSize:100}).done(function(x){c("RTCGroupCallActions").onParticipantsAdded(x.toJS());c("RTCGroupCallActions").handleConferenceStateRequest(l,m,this.$RTCMultiwayMessageHandler3,function(y){this.$RTCMultiwayMessageHandler3=y}.bind(this))}.bind(o));else c("RTCGroupCallActions").handleConferenceStateRequest(l,m,o.$RTCMultiwayMessageHandler3,function(x){this.$RTCMultiwayMessageHandler3=x}.bind(o))})()}.bind(this)).done()};f.exports=j}),null);
__d("RTCP2PCallWindowHandler",["RTCCallStore","RTCP2PCallStore","RTCP2PConstants"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("RTCP2PConstants").ConnectionStatus,i=void 0,j={init:function k(l){if(this._isWindowOpened())this.close();i=l;this.updateCallInProgressIndicator();this._monitorOpenerForChanges()},updateCallInProgressIndicator:function k(l){if(!this._isWindowOpened())return;var m=c("RTCCallStore").getState(),n=m.remoteUsers,o=l?l:c("RTCP2PCallStore").getState().connectionStatus;if(!n.count()||o===h.DISCONNECTED)i.rtcCallInProgessWith=null;else i.rtcCallInProgessWith=n.first().FBID.toString()},reload:function k(){if(this._isWindowOpened())i.location.reload()},close:function k(){if(this._isWindowOpened())i.close()},_monitorOpenerForChanges:function k(){if(i.opener)try{i.opener.addEventListener("unload",function(event){this._passWindowToOpener()}.bind(this))}catch(l){}},_passWindowToOpener:function k(){var l=arguments.length<=0||arguments[0]===undefined?10:arguments[0];setTimeout(function(){if(!this._isWindowOpened()||l<=1)return;if(i.opener&&!i.opener.closed)i.opener.rtcCallChildWindow=i;else this._passWindowToOpener(l-1)}.bind(this),1e3)},_isWindowOpened:function k(){return!!(i&&!i.closed)}};f.exports=j}),null);
__d("XScreenSharingController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/videocall/screen_sharing/",{peer_id:{type:"FBID",required:true}})}),null);
__d("RTCScreenSharingWindowHandler",["RTCP2PCallActions","RTCUtils","XScreenSharingController"],(function a(b,c,d,e,f,g){__p&&__p();var h=960,i=540,j=void 0,k={open:function l(m,n){j=window.open("about:blank","Screen Sharing",this._getWindowFeatures());c("RTCUtils").getStreamVideoResolution(n)["catch"](function(o){this._setupScreenSharingWindow(m,n,null)}.bind(this)).done(function(o){this._setupScreenSharingWindow(m,n,o)}.bind(this))},_setupScreenSharingWindow:function l(m,n,o){__p&&__p();var p,q=this;window.getRemoteMediaStream=function(){return n};window.closeScreenSharingWindow=this._onUnload;if(o)(function(){var r=q._getConstrainedSize(o.width,o.height),s=r.width,t=r.height;j.resizeTo(s,t);setTimeout(function(){this._adjustScreenSize({width:s,height:t})}.bind(q),200)})();j.location=this._getUnsignedUri(m);if(window.focus&&this.isWindowOpened())j.focus()},_adjustScreenSize:function l(m){if(!j)return;j.resizeTo(m.width,m.height+(m.height-j.innerHeight))},close:function l(){if(j){var m=null;if(j.opener&&!j.opener.closed)m=j.opener;j.close();j=null;if(m)m.postMessage({recipient:"SC_CONTENT_SCRIPT",type:"SC_RESET_PORT",text:"reset comm port"},"*")}},isWindowOpened:function l(){return!!(j&&!j.closed)},_onUnload:function l(){c("RTCP2PCallActions").togglePopOutScreenContent()},_getWindowFeatures:function l(){var m=screen.availLeft,n=screen.availTop,o=this._getConstrainedSize(Math.min(h,screen.width-m),Math.min(i,screen.height-n)),p=o.width,q=o.height,r={height:"height="+q.toString(),width:"width="+p.toString(),top:"top="+n.toString(),left:"left="+m.toString()};return["menubar=no","location=no","scrollbars=no","status=no","personalbar=no",r.height,r.width,r.top,r.left].join(",")},_getConstrainedSize:function l(m,n){__p&&__p();var o=0;if(m>h){o=h/m;n*=o;m*=o}if(n>i){o=i/n;m*=o;n*=o}return{width:m,height:n}},_getUnsignedUri:function l(m){return c("XScreenSharingController").getURIBuilder().setFBID("peer_id",m).getURI()}};f.exports=k}),null);
__d("RTCP2PCallActions",["RTCAppDispatcher","RTCP2PCallActionTypes","RTCP2PCallWindowHandler"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h={reload:function i(){c("RTCP2PCallWindowHandler").reload()},setCallType:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallActionTypes").SET_CALL_TYPE,callType:j})},setConnectionStatus:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallActionTypes").SET_CONNECTION_STATUS,connectionStatus:j})},setEndCallReason:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallActionTypes").SET_END_CALL_REASON,endCallReason:j})},setMultiwayEscalationSupport:function i(j,k){c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallActionTypes").SET_MULTIWAY_ESCALATION_SUPPORT,offerEscalationSupport:j,escalationConferenceName:k})},setRemoteSignalingExperiments:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallActionTypes").SET_REMOTE_SIGNALING_EXPERIMENTS,remoteSignalingExperiments:j})},togglePopOutScreenContent:function i(j){c("RTCAppDispatcher").dispatch({type:j?c("RTCP2PCallActionTypes").POP_OUT_SCREEN_CONTENT:c("RTCP2PCallActionTypes").POP_IN_SCREEN_CONTENT,stream:j})},processMessage:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallActionTypes").P2P_PROCESS_MESSAGE,message:j})},setIsCaller:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallActionTypes").P2P_SET_IS_CALLER,isCaller:j})},starRatingDone:function i(){var j=arguments.length<=0||arguments[0]===undefined?true:arguments[0];c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallActionTypes").P2P_STAR_RATING_DONE,done:j})},setVideoQuality:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallActionTypes").SET_VIDEO_QUALITY,videoQuality:j})}};f.exports=h}),null);
__d("FBRTCClientMediaUpdateReducer",["FBRTCRtcResponseStatusCode","RTCCallStore","RTCGroupCallActionTypes","RTCMWProtocolHandler"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h={configureAudio:function k(l,m){switch(m.type){case c("RTCGroupCallActionTypes").AUDIO_MUTED:return i(l,"audio",false);case c("RTCGroupCallActionTypes").AUDIO_UNMUTED:return i(l,"audio",true)}return l},configureVideo:function k(l,m){switch(m.type){case c("RTCGroupCallActionTypes").VIDEO_MUTED:return i(l,"video",false);case c("RTCGroupCallActionTypes").VIDEO_UNMUTED:return i(l,"video",true)}return l},onClientMediaUpdateResponse:function k(l,m){__p&&__p();switch(m.type){case c("RTCGroupCallActionTypes").ON_CLIENT_MEDIA_UPDATE_RESPONSE:if(m.responseStatusCode!==c("FBRTCRtcResponseStatusCode").OK)return l;l=l.setIn(["clientMediaUpdateInfo","lastSyncedClientVersion"],m.currentVersion);if(l.clientMediaUpdateInfo.pendingResponse){l=l.setIn(["clientMediaUpdateInfo","pendingResponse"],false);if(l.clientMediaUpdateInfo.pendingUpdate)return j(l.setIn(["clientMediaUpdateInfo","pendingUpdate"],false))}return l}return l}};function i(k,l,m){var n=c("RTCCallStore").getState().connections.first().getLocalStreams()[0].getTracks().reduce(function(n,o){n[o.id]=o.kind===l?m:o.enabled;return n},{});return j(k.setIn(["clientMediaUpdateInfo","localMediaUpdates"],k.clientMediaUpdateInfo.localMediaUpdates.push({mediaStatus:n})))}function j(k){__p&&__p();if(k.clientMediaUpdateInfo.pendingResponse)return k.setIn(["clientMediaUpdateInfo","pendingUpdate"],true);var l=k.clientMediaUpdateInfo.localMediaUpdates.reduce(function(m,n,o){if(o>=k.clientMediaUpdateInfo.lastSyncedClientVersion)m.push(n);return m},[]);if(l.length===0)return k;c("RTCMWProtocolHandler").clientMediaUpdate(c("RTCCallStore").getState().callInfo.conferenceName,c("RTCCallStore").getState().callInfo.serverInfoData,k.clientMediaUpdateInfo.lastSyncedClientVersion,k.clientMediaUpdateInfo.localMediaUpdates.size,l);return k.setIn(["clientMediaUpdateInfo","pendingResponse"],true)}f.exports=h}),null);
__d("FBRTCGroupCallParticipantsReducer",["MercuryIDs","RTCCallStore","RTCGroupCallActionTypes","RTCMWProtocolHandler","Set"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h={_participantsToRing:new(c("Set"))(),initThread:function i(j,k){switch(k.type){case c("RTCGroupCallActionTypes").INIT_THREAD:return j.merge({participants:k.participants,thread:k.thread})}return j},onParticipantsChanged:function i(j,k){__p&&__p();switch(k.type){case c("RTCGroupCallActionTypes").ON_PARTICIPANT_LEFT:return j.set("participants",j.participants["delete"](c("MercuryIDs").getParticipantIDFromUserID(k.participantFBID)));case c("RTCGroupCallActionTypes").ON_PARTICIPANTS_ADDED:var l=Object.keys(k.participants).map(function(m){return k.participants[m].fbid}).filter(function(m){return h._participantsToRing.has(m)});if(l.length!==0){l.forEach(function(m){return h._participantsToRing["delete"](m)});c("RTCMWProtocolHandler").addParticipants(c("RTCCallStore").getState().callInfo.conferenceName,c("RTCCallStore").getState().callInfo.serverInfoData,l)}return j.set("participants",j.participants.merge(k.participants))}return j},addParticipantsToRing:function i(j,k){switch(k.type){case c("RTCGroupCallActionTypes").ADD_PARTICIPANTS_TO_RING:k.participantFBIDs.forEach(function(l){return h._participantsToRing.add(l)});return j}return j}};f.exports=h}),null);
__d("FBRTCGroupCallReducer",["FBRTCConstants","FBRTCParticipantCallState","RTCCallStore","RTCEndCallReason","RTCGroupCallActionTypes","RTCMWProtocolHandler"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("FBRTCConstants").SignalingProtocol,i={setDominantSpeaker:function j(k,l){__p&&__p();switch(l.type){case c("RTCGroupCallActionTypes").SET_DOMINANT_SPEAKER:return k.set("dominantSpeakerFBID",l.dominantSpeakerFBID);case c("RTCGroupCallActionTypes").SET_PINNED_SPEAKER:var m=c("RTCCallStore").getState(),n=m.callInfo,o=c("RTCCallStore").getConnection(h.MULTIWAY);if(!o)return k;c("RTCMWProtocolHandler").subscription(n.conferenceName,n.serverInfoData,o.getRemoteStreams(),k.layout,l.pinnedSpeakerFBID);return k.set("pinnedSpeakerFBID",l.pinnedSpeakerFBID);case c("RTCGroupCallActionTypes").ON_CONFERENCE_STATE:var p=l.request.conferenceStateRequest(),q=p.participantStates,r=q[k.pinnedSpeakerFBID];if(r&&r.state!==c("FBRTCParticipantCallState").CONNECTED)return k.set("pinnedSpeakerFBID",null);return k}return k},setLayout:function j(k,l){switch(l.type){case c("RTCGroupCallActionTypes").SET_LAYOUT:var m=c("RTCCallStore").getState(),n=m.callInfo,o=c("RTCCallStore").getConnection(h.MULTIWAY);if(o)c("RTCMWProtocolHandler").subscription(n.conferenceName,n.serverInfoData,o.getRemoteStreams(),l.layout,k.pinnedSpeakerFBID);return k.set("layout",l.layout)}return k},setGKSettings:function j(k,l){switch(l.type){case c("RTCGroupCallActionTypes").SET_USE_DOMINANT_SPEAKE_VIEW:return k.set("useDominantSpeakeView",l.useDominantSpeakeView);case c("RTCGroupCallActionTypes").SET_GRID_VIEW:return k.set("useGridView",l.useGridView);case c("RTCGroupCallActionTypes").SET_STRIP_VIEW:return k.set("useStripView",l.useStripView)}return k},processEndCallReason:function j(k,l){switch(l.type){case c("RTCGroupCallActionTypes").CALL_ERROR:case c("RTCGroupCallActionTypes").HANGUP:case c("RTCGroupCallActionTypes").END_CALL:case c("RTCGroupCallActionTypes").DISMISS:return k.set("endCallReason",k.endCallReason||new(c("RTCEndCallReason"))(l.endCallReason))}return k}};f.exports=i}),null);
__d("RTCGroupCallEscalationStoreReducer",["FBRTCParticipantCallState","immutable","RTCCallStore","RTCGroupCallActionTypes","RTCGroupCallEscalationActionTypes","RTCMWProtocolHandler","RTCP2PCallStore"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=new Set([c("FBRTCParticipantCallState").UNKNOWN,c("FBRTCParticipantCallState").DISCONNECTED,c("FBRTCParticipantCallState").NO_ANSWER,c("FBRTCParticipantCallState").REJECTED,c("FBRTCParticipantCallState").UNREACHABLE,c("FBRTCParticipantCallState").CONNECTION_DROPPED,c("FBRTCParticipantCallState").PARTICIPANT_LIMIT_REACHED,c("FBRTCParticipantCallState").IN_ANOTHER_CALL,c("FBRTCParticipantCallState").RING_TYPE_UNSUPPORTED]);function i(m,n){switch(n.type){case c("RTCGroupCallEscalationActionTypes").GROUP_ESCALATION_CANCEL:return m.withMutations(function(m){m.set("aborted",true).set("inProgress",false).set("toRing",false).set("readyToTransition",false).set("usersToRing",null)})}return m}function j(m,n){switch(n.type){case c("RTCGroupCallEscalationActionTypes").GROUP_ESCALATION_START:return m.set("inProgress",true)}return m}function k(m,n){__p&&__p();var o;if(!m.readyToTransition)switch(n.type){case c("RTCGroupCallActionTypes").ON_CONFERENCE_STATE:var p=n.request.conferenceStateRequest();if(p){var o=function(){__p&&__p();var q=p.participantStates,r=m.toRing,s=false,t=Object.keys(q).every(function(x){return q[x].state===c("FBRTCParticipantCallState").CONNECTED});if(t){var u=c("RTCP2PCallStore").getState(),v=u.protocolHandler;v.shutDownP2PListenersForMultiwayEscalation();if(m.usersToRing&&r){var w=m.usersToRing.toArray().map(function(x){return x.fbid}).filter(function(x){return!!x});c("RTCMWProtocolHandler").addParticipants(c("RTCCallStore").getState().callInfo.conferenceName,c("RTCCallStore").getState().callInfo.serverInfoData,w);r=false}}else s=Object.keys(q).some(function(x){return h.has(q[x].state)});return{v:m.set("aborted",s).set("readyToTransition",t).set("toRing",r)}}();if(typeof o==="object")return o.v}}return m}function l(m,n){switch(n.type){case c("RTCGroupCallEscalationActionTypes").GROUP_ESCALATION_SET_USERS_TO_RING:if(n.usersToRing)return m.set("usersToRing",n.usersToRing).set("toRing",true)}return m}f.exports={abortEscalation:i,callStart:j,callConnected:k,setUsersToRing:l}}),null);
__d("FBRTCVideoEscalationStore",["FBRTCCallControlActions","FBRTCConstants","FBRTCStore","keyMirror"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=25e3,k=1e4,l=c("keyMirror")({direct_video:null,escalated:null,escalation_declined:null,voip:null});h=babelHelpers.inherits(m,c("FBRTCStore"));i=h&&h.prototype;function m(n,o,p){i.constructor.call(this);this.$FBRTCVideoEscalationStore7=n;this.$FBRTCVideoEscalationStore2=o;this.$FBRTCVideoEscalationStore1=p;this.$FBRTCVideoEscalationStore4=p;this.$FBRTCVideoEscalationStore3=false;this.$FBRTCVideoEscalationStore5=null;this.$FBRTCVideoEscalationStore8=null}m.prototype.isPending=function(){return!!this.$FBRTCVideoEscalationStore5};m.prototype.callHasEscalated=function(){return this.$FBRTCVideoEscalationStore1};m.prototype.getCallType=function(){if(!this.$FBRTCVideoEscalationStore2.isRemoteVideoSupported)return l.voip;else if(this.$FBRTCVideoEscalationStore4)return l.direct_video;else if(this.$FBRTCVideoEscalationStore1)return l.escalated;else if(this.$FBRTCVideoEscalationStore3)return l.escalation_declined;return l.voip};m.prototype.__onDispatch=function(n){__p&&__p();switch(n.type){case c("FBRTCCallControlActions").Types.RECEIVED_SIGNALING_MESSAGE:var o=n.message;if(n.message_type===c("FBRTCConstants").PayloadType.VIDEO_REQUEST){this.$FBRTCVideoEscalationStore3=true;if(o.ackID)this.$FBRTCVideoEscalationStore10(o);else this.$FBRTCVideoEscalationStore11(o)}if(n.message_type===c("FBRTCConstants").PayloadType.ACK&&o.msg.ack_type===c("FBRTCConstants").PayloadType.VIDEO_REQUEST)this.$FBRTCVideoEscalationStore12(o);break;case c("FBRTCCallControlActions").Types.ACCEPT_ESCALATION:this.$FBRTCVideoEscalationStore13(true);break;case c("FBRTCCallControlActions").Types.DECLINE_ESCALATION:this.$FBRTCVideoEscalationStore13(false);break;case c("FBRTCCallControlActions").Types.TOGGLE_MUTE_VIDEO:this.$FBRTCVideoEscalationStore3=true;this.getDispatcher().waitFor([this.$FBRTCVideoEscalationStore2.getDispatchToken()]);this.$FBRTCVideoEscalationStore14();break}};m.prototype.$FBRTCVideoEscalationStore12=function(n){if(this.$FBRTCVideoEscalationStore8&&this.$FBRTCVideoEscalationStore8.msg_id===n.ackID)this.$FBRTCVideoEscalationStore15()};m.prototype.$FBRTCVideoEscalationStore15=function(){clearTimeout(this.$FBRTCVideoEscalationStore6)};m.prototype.$FBRTCVideoEscalationStore16=function(){this.$FBRTCVideoEscalationStore6=setTimeout(function(){if(!this.$FBRTCVideoEscalationStore8)return;this.$FBRTCVideoEscalationStore7.resendPayload(this.$FBRTCVideoEscalationStore2.peerID,this.$FBRTCVideoEscalationStore8)}.bind(this),k)};m.prototype.$FBRTCVideoEscalationStore10=function(n){__p&&__p();if(!this.$FBRTCVideoEscalationStore8||n.ackID!==this.$FBRTCVideoEscalationStore8.msg_id)return;clearTimeout(this.$FBRTCVideoEscalationStore9);this.$FBRTCVideoEscalationStore15();var o=n.msg,p=n.peerID,q=n.callID,r=this.$FBRTCVideoEscalationStore17(o);this.$FBRTCVideoEscalationStore7.sendAck(p,q,o);this.$FBRTCVideoEscalationStore8=null;this.$FBRTCVideoEscalationStore1=r;this.$FBRTCVideoEscalationStore18(r);if(!r&&this.$FBRTCVideoEscalationStore2.localStream.hasVideo())this.$FBRTCVideoEscalationStore2.localStream.toggleMuteVideo();this.__emitChange()};m.prototype.$FBRTCVideoEscalationStore11=function(n){__p&&__p();if(this.$FBRTCVideoEscalationStore1){if(this.$FBRTCVideoEscalationStore17(n.msg)){this.$FBRTCVideoEscalationStore5=n;this.$FBRTCVideoEscalationStore13(true)}else this.$FBRTCVideoEscalationStore2.remoteStream.setVideoEnabled(false);return}var o=n.msg,p=n.peerID,q=n.callID;this.$FBRTCVideoEscalationStore7.sendAck(p,q,o);if(this.$FBRTCVideoEscalationStore17(o)){this.$FBRTCVideoEscalationStore5=n;this.$FBRTCVideoEscalationStore9=setTimeout(function(){c("FBRTCCallControlActions").declineEscalation()},j)}else this.$FBRTCVideoEscalationStore5=null;this.__emitChange()};m.prototype.$FBRTCVideoEscalationStore13=function(n){clearTimeout(this.$FBRTCVideoEscalationStore9);if(this.$FBRTCVideoEscalationStore5){var o=this.$FBRTCVideoEscalationStore5,p=o.peerID,q=o.callID,r=o.msgID;this.$FBRTCVideoEscalationStore8=this.$FBRTCVideoEscalationStore7.sendVideoRequestResponse(p,q,r,n);this.$FBRTCVideoEscalationStore16();this.$FBRTCVideoEscalationStore1=n;this.$FBRTCVideoEscalationStore5=null;this.__emitChange()}};m.prototype.$FBRTCVideoEscalationStore14=function(){__p&&__p();if(this.$FBRTCVideoEscalationStore1){this.$FBRTCVideoEscalationStore19();return}this.$FBRTCVideoEscalationStore8=this.$FBRTCVideoEscalationStore7.sendVideoEscalationRequest(this.$FBRTCVideoEscalationStore2.peerID,this.$FBRTCVideoEscalationStore2.callID,this.$FBRTCVideoEscalationStore2.localStream.hasVideo());if(this.$FBRTCVideoEscalationStore2.localStream.hasVideo()){this.$FBRTCVideoEscalationStore16();this.$FBRTCVideoEscalationStore9=setTimeout(function(){if(this.$FBRTCVideoEscalationStore2.localStream.hasVideo())c("FBRTCCallControlActions").toggleMuteVideo()}.bind(this),j)}else{this.$FBRTCVideoEscalationStore15();clearTimeout(this.$FBRTCVideoEscalationStore9);this.$FBRTCVideoEscalationStore8=null}this.__emitChange()};m.prototype.$FBRTCVideoEscalationStore19=function(){if(!this.$FBRTCVideoEscalationStore2.isRemoteVideoSupported)return;this.$FBRTCVideoEscalationStore7.sendMuteStateUpdate(this.$FBRTCVideoEscalationStore2.peerID,this.$FBRTCVideoEscalationStore2.callID,this.$FBRTCVideoEscalationStore2.localStream.hasVideo())};m.prototype.$FBRTCVideoEscalationStore18=function(n){this.$FBRTCVideoEscalationStore2.remoteStream.setVideoEnabled(n)};m.prototype.$FBRTCVideoEscalationStore17=function(n){return!!(n.reqVideoOn||n.videoon)};m.CallType=l;f.exports=m}),null);
__d("RTCCallType",[],(function a(b,c,d,e,f,g){"use strict";var h=Object.freeze({AUDIO_ONLY:"AUDIO_ONLY",VIDEO_ONLY:"VIDEO_ONLY",AUDIO_VIDEO:"AUDIO_VIDEO",NO_AUDIO_VIDEO:"NO_AUDIO_VIDEO"});f.exports=h}),null);
__d("RTCP2PCallEscalationActionTypes",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({P2P_CALL_ESCALATION_ACK:"P2P_CALL_ESCALATION_ACK",P2P_CALL_ESCALATION_FAILURE:"P2P_CALL_ESCALATION_FAILURE",P2P_CALL_ESCALATION_SET_REQUEST:"P2P_CALL_ESCALATION_SET_REQUEST",P2P_CALL_ESCALATION_SET_RESPONSE:"P2P_CALL_ESCALATION_SET_RESPONSE",P2P_CALL_ESCALATION_START:"P2P_CALL_ESCALATION_START",P2P_CALL_ESCALATION_SUCCESS:"P2P_CALL_ESCALATION_SUCCESS"})}),null);
__d("RTCP2PCallEscalationStoreReducers",["FBRTCVideoEscalationStore","RTCCallType","RTCP2PCallActionTypes","RTCP2PCallEscalationActionTypes","RTCP2PCallStore"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("FBRTCVideoEscalationStore").CallType,i=function i(l,m){__p&&__p();switch(m.type){case c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_START:if(l.inProgress)return l;if(l.escalated||!c("RTCP2PCallStore").isAudioOnly())return l;return l.withMutations(function(l){l.set("awaitingACK",true).set("initiatedEscalation",true).set("failureReason",null).set("inProgress",true).set("token",c("RTCP2PCallStore").getState().protocolHandler.generateEscalationRequestToken())});case c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SUCCESS:if(!l.inProgress)return l;else if("token"in m&&m.token!==l.token)return l;return l.withMutations(function(l){l.set("awaitingACK",false).set("callType",h.escalated).set("escalated",true).set("inProgress",false).set("request",null).set("response",true).set("token",null)});case c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_FAILURE:if(!l.inProgress)return l;else if("token"in m&&m.token!==l.token)return l;return l.withMutations(function(l){l.set("awaitingACK",false).set("callType",h.escalation_declined).set("escalated",false).set("failureReason",m.reason||null).set("inProgress",false).set("request",null).set("response",m.response||null).set("token",null)});default:return l}},j=function j(l,m){__p&&__p();switch(m.type){case c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SET_REQUEST:if(m.request==null)return l;return l.withMutations(function(l){l.set("inProgress",true).set("request",m.request).set("response",null)});case c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SET_RESPONSE:if(m.response==null)return l;else if(l.request==null)return l;return l.withMutations(function(l){l.set("awaitingACK",true).set("callType",m.response?h.escalated:h.escalation_declined).set("response",m.response).set("token",c("RTCP2PCallStore").getState().protocolHandler.generateEscalationResponseToken(l.request,m.response))});case c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_ACK:if(m.token==null)return l;if(!l.awaitingACK)return l;else if(l.response==null||l.request==null)return l;else if(m.token!==l.token)return l;return l.withMutations(function(l){l.set("awaitingACK",false).set("callType",l.response?h.escalated:h.escalation_declined).set("escalated",l.response).set("inProgress",false).set("request",null).set("response",null).set("token",null)});default:return l}},k=function k(l,m){__p&&__p();switch(m.type){case c("RTCP2PCallActionTypes").SET_CALL_TYPE:switch(m.callType){case c("RTCCallType").AUDIO_VIDEO:case c("RTCCallType").VIDEO_ONLY:return l.set("callType",h.direct_video)}return l;case c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_ACK:if(m.token==null)return l;if(!l.awaitingACK)return l;else if(m.token!==l.token)return l;return l.set("awaitingACK",false);default:return l}};f.exports={Alice:i,Bob:j,common:k}}),null);
__d("RTCP2PCallReducer",["RTCAppDispatcher","RTCCallActionTypes","RTCCallStore","RTCCallType","RTCGroupCallActionTypes","RTCP2PCallActionTypes","RTCP2PCallEscalationActionTypes","RTCP2PCallEscalationStore","RTCP2PCallWindowHandler","RTCP2PConstants","RTCP2PProtocolHandler","RTCScreenSharingWindowHandler","RTCSignalingExperiments"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("RTCP2PConstants").ConnectionStatus;function i(v,w){__p&&__p();switch(w.type){case c("RTCCallActionTypes").RESET:c("RTCAppDispatcher").waitFor([c("RTCCallStore").getDispatchToken()]);var x=c("RTCCallStore").getState().remoteUsers.first();if(x==null)return v;v.protocolHandler.destroy();var y=new(c("RTCP2PProtocolHandler"))();y.init(x.FBID,Number(w.conferenceName));return v.set("connectionStatus",h.INIT).set("endCallReason",null).set("protocolHandler",y).set("signalingExperiments",new(c("RTCSignalingExperiments"))());default:return v}}function j(v,w){switch(w.type){case c("RTCGroupCallActionTypes").HANGUP:case c("RTCGroupCallActionTypes").DISMISS:case c("RTCGroupCallActionTypes").HANGUP_ERROR:case c("RTCGroupCallActionTypes").HANGUP_SUCCESS:case c("RTCGroupCallActionTypes").END_CALL:case c("RTCGroupCallActionTypes").REMOVE_REMOTE_SCREEN_STREAM:case c("RTCCallActionTypes").RESET:c("RTCScreenSharingWindowHandler").close();return v.set("isScreenContentPoppedOut",c("RTCScreenSharingWindowHandler").isWindowOpened());default:return v}}function k(v,w){switch(w.type){case c("RTCP2PCallActionTypes").SET_CALL_TYPE:return v.set("callType",w.callType);case c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SET_RESPONSE:c("RTCAppDispatcher").waitFor([c("RTCP2PCallEscalationStore").getDispatchToken()]);return v.set("callType",w.response?c("RTCCallType").AUDIO_VIDEO:c("RTCCallType").AUDIO_ONLY);case c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_FAILURE:return v.set("callType",c("RTCCallType").AUDIO_ONLY);case c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SUCCESS:return v.set("callType",c("RTCCallType").AUDIO_VIDEO);default:return v}}function l(v,w){switch(w.type){case c("RTCP2PCallActionTypes").SET_CONNECTION_STATUS:if(v.connectionStatus!==w.connectionStatus){c("RTCP2PCallWindowHandler").updateCallInProgressIndicator(w.connectionStatus);return v.set("connectionStatus",w.connectionStatus)}default:return v}}function m(v,w){switch(w.type){case c("RTCP2PCallActionTypes").SET_END_CALL_REASON:return v.set("endCallReason",w.endCallReason);default:return v}}function n(v,w){switch(w.type){case c("RTCP2PCallActionTypes").SET_MULTIWAY_ESCALATION_SUPPORT:v=v.set("offerEscalationSupport",w.offerEscalationSupport);if(w.escalationConferenceName)v=v.set("escalationConferenceName",w.escalationConferenceName);return v;default:return v}}function o(v,w){switch(w.type){case c("RTCP2PCallActionTypes").POP_IN_SCREEN_CONTENT:c("RTCScreenSharingWindowHandler").close();return v.set("isScreenContentPoppedOut",c("RTCScreenSharingWindowHandler").isWindowOpened());case c("RTCP2PCallActionTypes").POP_OUT_SCREEN_CONTENT:var x=c("RTCCallStore").getState().remoteUsers.first().FBID;c("RTCScreenSharingWindowHandler").open(x,w.stream);return v.set("isScreenContentPoppedOut",c("RTCScreenSharingWindowHandler").isWindowOpened());default:return v}}function p(v,w){switch(w.type){case c("RTCP2PCallActionTypes").SET_REMOTE_SIGNALING_EXPERIMENTS:return v.set("signalingExperiments",v.signalingExperiments.setRemote(w.remoteSignalingExperiments));default:return v}}function q(v,w){switch(w.type){case c("RTCP2PCallActionTypes").P2P_PROCESS_MESSAGE:return v.set("isRemoteVideoSupported",w.message.isRemoteVideoSupported()).set("isPeerOnMobile",w.message.isFromMobile());default:return v}}function r(v,w){switch(w.type){case c("RTCP2PCallActionTypes").P2P_SET_IS_CALLER:return v.set("isCaller",w.isCaller);default:return v}}function s(v,w){switch(w.type){case c("RTCP2PCallActionTypes").SET_CONNECTION_STATUS:if(w.connectionStatus===h.CONNECTED)return v.set("wasConnected",true);return v;case c("RTCCallActionTypes").RESET:return v.set("wasConnected",false);default:return v}}function t(v,w){switch(w.type){case c("RTCP2PCallActionTypes").P2P_STAR_RATING_DONE:return v.set("wasStarRatingDone",w.done);case c("RTCCallActionTypes").RESET:return v.set("wasStarRatingDone",false);default:return v}}function u(v,w){switch(w.type){case c("RTCP2PCallActionTypes").SET_VIDEO_QUALITY:return v.set("videoQuality",w.videoQuality);default:return v}}f.exports={callInit:i,callEnd:j,processCallType:k,processConnectionStatus:l,processEndCallReason:m,processIsCaller:r,processMessage:q,processMultiwayEscalationSupport:n,processPoppedOutScreenContent:o,processSignalingExperiments:p,processVideoQuality:u,processWasConnected:s,processWasStarRatingDone:t}}),null);
__d("RTCStreamDurationTracker",["performanceNow"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(){__p&&__p();var i=arguments.length<=0||arguments[0]===undefined?"mixed":arguments[0];this.$RTCStreamDurationTracker3=0;this.$RTCStreamDurationTracker4=0;this.$RTCStreamDurationTracker5=false;this.update=function(){if(!this.$RTCStreamDurationTracker5)return;if(this.$RTCStreamDurationTracker6()){if(this.$RTCStreamDurationTracker4===0)this.$RTCStreamDurationTracker4=c("performanceNow")()}else{this.$RTCStreamDurationTracker3=this.getDuration();this.$RTCStreamDurationTracker4=0}}.bind(this);this.$RTCStreamDurationTracker1=i}h.prototype.isStarted=function(){return this.$RTCStreamDurationTracker5};h.prototype.track=function(i){__p&&__p();if(i===this.$RTCStreamDurationTracker2){this.update();return}if(this.$RTCStreamDurationTracker2&&this.$RTCStreamDurationTracker5){var j=this.$RTCStreamDurationTracker2;j.removeEventListener("addtrack",this.update);j.removeEventListener("removetrack",this.update)}if(i){this.$RTCStreamDurationTracker2=i;if(this.$RTCStreamDurationTracker5)this.start()}else this.stop()};h.prototype.$RTCStreamDurationTracker6=function(){if(!this.$RTCStreamDurationTracker2)return false;return this.$RTCStreamDurationTracker7().some(function(i){return i.enabled})};h.prototype.$RTCStreamDurationTracker7=function(){if(!this.$RTCStreamDurationTracker2)return[];switch(this.$RTCStreamDurationTracker1){case"audio":return this.$RTCStreamDurationTracker2.getAudioTracks();case"video":return this.$RTCStreamDurationTracker2.getVideoTracks();default:return this.$RTCStreamDurationTracker2.getTracks()}};h.prototype.getDuration=function(){return this.$RTCStreamDurationTracker4===0?this.$RTCStreamDurationTracker3:this.$RTCStreamDurationTracker3+c("performanceNow")()-this.$RTCStreamDurationTracker4};h.prototype.start=function(){this.$RTCStreamDurationTracker5=true;if(this.$RTCStreamDurationTracker6())this.$RTCStreamDurationTracker4=c("performanceNow")();if(this.$RTCStreamDurationTracker2){var i=this.$RTCStreamDurationTracker2;i.addEventListener("addtrack",this.update);i.addEventListener("removetrack",this.update)}};h.prototype.stop=function(){__p&&__p();if(!this.$RTCStreamDurationTracker5)return;this.$RTCStreamDurationTracker3=this.getDuration();this.$RTCStreamDurationTracker5=false;this.$RTCStreamDurationTracker4=0;if(this.$RTCStreamDurationTracker2){var i=this.$RTCStreamDurationTracker2;i.removeEventListener("addtrack",this.update);i.removeEventListener("removetrack",this.update)}};f.exports=h}),null);
__d("FBRTCGroupCallStoreState",["immutable","RTCStreamDurationTracker"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j,k,l,m,n={pendingResponse:false,pendingUpdate:false,lastSyncedClientVersion:2,localMediaUpdates:c("immutable").List([{mediaStatus:{}},{mediaStatus:{}}])};h=babelHelpers.inherits(o,c("immutable").Record(n));i=h&&h.prototype;function o(){h.apply(this,arguments)}var p={localVideoDurationTracker:new(c("RTCStreamDurationTracker"))("video"),remoteVideoDurationTracker:new(c("RTCStreamDurationTracker"))("video")};j=babelHelpers.inherits(q,c("immutable").Record(p));k=j&&j.prototype;function q(){j.apply(this,arguments)}var r={dominantSpeakerFBID:null,endCallReason:null,layout:null,participants:null,pinnedSpeakerFBID:null,thread:null,clientMediaUpdateInfo:new o(),useDominantSpeakeView:false,useGridView:false,useStripView:false,videoDurationTrackerInfo:new q()};l=babelHelpers.inherits(s,c("immutable").Record(r));m=l&&l.prototype;function s(){l.apply(this,arguments)}f.exports=s}),null);
__d("FBRTCVideoDurationTrackerReducer",["FBRTCCallSummaryStore","RTCCallStore","RTCGroupCallActionTypes"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h={track:function i(j,k){__p&&__p();var l=j.videoDurationTrackerInfo,m=l.localVideoDurationTracker,n=l.remoteVideoDurationTracker;switch(k.type){case c("RTCGroupCallActionTypes").ADD_LOCAL_STREAM:m.start();m.track(k.stream);return j;case c("RTCGroupCallActionTypes").ADD_REMOTE_STREAM:case c("RTCGroupCallActionTypes").TOGGLE_REMOTE_STREAM:var o=c("RTCCallStore").getState(),p=o.remoteUsers,q=p.find(function(q){return!q.isVideoMuted()});n.stop();n.start();n.track(q&&q.streams.first());return j}return j},update:function i(j,k){switch(k.type){case c("RTCGroupCallActionTypes").VIDEO_MUTED:case c("RTCGroupCallActionTypes").VIDEO_UNMUTED:j.videoDurationTrackerInfo.localVideoDurationTracker.update()}return j},stop:function i(j,k){switch(k.type){case c("RTCGroupCallActionTypes").DISMISS:case c("RTCGroupCallActionTypes").END_CALL:case c("RTCGroupCallActionTypes").HANGUP:var l=j.videoDurationTrackerInfo,m=c("RTCCallStore").getState(),n=m.callSummary;n.setVideoDurations(l.localVideoDurationTracker.getDuration(),l.remoteVideoDurationTracker.getDuration());n.save(c("FBRTCCallSummaryStore").getInstance());return j}return j}};f.exports=h}),null);
__d("FBRTCGroupCallStore",["FBRTCClientMediaUpdateReducer","FBRTCGroupCallParticipantsReducer","FBRTCGroupCallReducer","FBRTCGroupCallStoreState","FBRTCVideoDurationTrackerReducer","FluxReduceStore","RTCAppDispatcher"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=[c("FBRTCClientMediaUpdateReducer").configureAudio,c("FBRTCClientMediaUpdateReducer").configureVideo,c("FBRTCClientMediaUpdateReducer").onClientMediaUpdateResponse,c("FBRTCGroupCallParticipantsReducer").addParticipantsToRing,c("FBRTCGroupCallParticipantsReducer").initThread,c("FBRTCGroupCallParticipantsReducer").onParticipantsChanged,c("FBRTCGroupCallReducer").processEndCallReason,c("FBRTCGroupCallReducer").setDominantSpeaker,c("FBRTCGroupCallReducer").setGKSettings,c("FBRTCGroupCallReducer").setLayout,c("FBRTCVideoDurationTrackerReducer").track,c("FBRTCVideoDurationTrackerReducer").update,c("FBRTCVideoDurationTrackerReducer").stop];h=babelHelpers.inherits(k,c("FluxReduceStore"));i=h&&h.prototype;k.prototype.getInitialState=function(){return new(c("FBRTCGroupCallStoreState"))()};k.prototype.reduce=function(l,m){return j.reduce(function(l,n){return n(l,m)},l)};function k(){h.apply(this,arguments)}f.exports=new k(c("RTCAppDispatcher"))}),null);
__d("RTCGroupCallEscalationStoreState",["immutable"],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c("immutable").Record({aborted:false,inProgress:false,toRing:false,readyToTransition:false,usersToRing:null}));i=h&&h.prototype;function j(){"use strict";h.apply(this,arguments)}f.exports=j}),null);
__d("RTCGroupCallEscalationStore",["FluxReduceStore","RTCAppDispatcher","RTCGroupCallEscalationStoreReducer","RTCGroupCallEscalationStoreState"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=[c("RTCGroupCallEscalationStoreReducer").abortEscalation,c("RTCGroupCallEscalationStoreReducer").callStart,c("RTCGroupCallEscalationStoreReducer").callConnected,c("RTCGroupCallEscalationStoreReducer").setUsersToRing];h=babelHelpers.inherits(k,c("FluxReduceStore"));i=h&&h.prototype;k.prototype.getInitialState=function(){return new(c("RTCGroupCallEscalationStoreState"))()};k.prototype.reduce=function(l,m){return j.reduce(function(l,n){return n(l,m)},l)};k.prototype.isInProgress=function(){return this.getState().inProgress};k.prototype.isEscalated=function(){return this.getState().readyToTransition};function k(){h.apply(this,arguments)}f.exports=new k(c("RTCAppDispatcher"))}),null);
__d("RTCP2PCallEscalationStoreState",["FBRTCMessage","FBRTCVideoEscalationStore","immutable"],(function a(b,c,d,e,f,g){var h,i,j=c("FBRTCVideoEscalationStore").CallType;h=babelHelpers.inherits(k,c("immutable").Record({awaitingACK:false,callType:j.voip,escalated:false,failureReason:null,initiatedEscalation:false,inProgress:false,request:null,response:null,token:null}));i=h&&h.prototype;function k(){"use strict";h.apply(this,arguments)}f.exports=k}),null);
__d("RTCP2PCallEscalationStore",["FBRTCConfig","FluxReduceStore","RTCAppDispatcher","RTCP2PCallEscalationStoreReducers","RTCP2PCallEscalationStoreState","RTCP2PCallStore"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=[c("RTCP2PCallEscalationStoreReducers").Alice,c("RTCP2PCallEscalationStoreReducers").Bob,c("RTCP2PCallEscalationStoreReducers").common];h=babelHelpers.inherits(k,c("FluxReduceStore"));i=h&&h.prototype;k.prototype.getInitialState=function(){return new(c("RTCP2PCallEscalationStoreState"))()};k.prototype.reduce=function(l,m){return j.reduce(function(l,n){return n(l,m)},l)};k.prototype.didCurrentUserInitiate=function(){return this.getState().initiatedEscalation};k.prototype.isInProgress=function(){return this.getState().inProgress};k.prototype.isEscalated=function(){return this.getState().escalated};k.prototype.isNegotiationAllowed=function(){var l=this.getState();return c("RTCP2PCallStore").getState().isPeerOnMobile||!c("FBRTCConfig").canPeerUseV2()||!l.request};k.prototype.isStarted=function(){var l=this.getState();return l.inProgress&&l.token!==null};k.prototype.getToken=function(){return this.getState().token};function k(){h.apply(this,arguments)}f.exports=new k(c("RTCAppDispatcher"))}),null);
__d("RTCP2PCallAdminMessageReducers",["FBRTCAdminMessage","FBRTCCallConstants","RTCAppDispatcher","RTCCallStore","RTCCallType","RTCGroupCallActionTypes","RTCP2PCallActionTypes","RTCP2PConstants"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("FBRTCCallConstants").FBRTCCallType,i=c("RTCP2PConstants").ConnectionStatus;function j(m,n){switch(n.type){case c("RTCGroupCallActionTypes").SET_CALL_SUMMARY:c("RTCAppDispatcher").waitFor([c("RTCCallStore").getDispatchToken()]);var o=c("RTCCallStore").getState(),p=o.callSummary;return m.set("adminMessage",new(c("FBRTCAdminMessage"))(p.peerID,p.callID));default:return m}}function k(m,n){switch(n.type){case c("RTCP2PCallActionTypes").SET_CONNECTION_STATUS:var o=m.adminMessage;if(o&&n.connectionStatus===i.CONNECTED)o.onCallConnected();return m;default:return m}}function l(m,n){switch(n.type){case c("RTCP2PCallActionTypes").SET_END_CALL_REASON:var o=m.adminMessage;if(o){o.onCallEnded();if(m.isCaller)o.submit(m.callType===c("RTCCallType").AUDIO_ONLY?h.VOICE_CALL:h.VIDEO_CALL,n.endCallReason.getReasonID())}return m;default:return m}}f.exports={processCallInit:j,processCallStart:k,processCallEnd:l}}),null);
__d("RTCP2PCallStore",["FluxReduceStore","RTCAppDispatcher","RTCCallType","RTCP2PCallAdminMessageReducers","RTCP2PCallReducer","RTCP2PCallStoreState"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=[c("RTCP2PCallReducer").callEnd,c("RTCP2PCallReducer").callInit,c("RTCP2PCallReducer").processCallType,c("RTCP2PCallReducer").processConnectionStatus,c("RTCP2PCallReducer").processEndCallReason,c("RTCP2PCallReducer").processPoppedOutScreenContent,c("RTCP2PCallReducer").processMultiwayEscalationSupport,c("RTCP2PCallReducer").processSignalingExperiments,c("RTCP2PCallReducer").processMessage,c("RTCP2PCallReducer").processIsCaller,c("RTCP2PCallReducer").processVideoQuality,c("RTCP2PCallReducer").processWasConnected,c("RTCP2PCallReducer").processWasStarRatingDone,c("RTCP2PCallAdminMessageReducers").processCallInit,c("RTCP2PCallAdminMessageReducers").processCallStart,c("RTCP2PCallAdminMessageReducers").processCallEnd];h=babelHelpers.inherits(k,c("FluxReduceStore"));i=h&&h.prototype;k.prototype.getInitialState=function(){return new(c("RTCP2PCallStoreState"))()};k.prototype.reduce=function(l,m){return j.reduce(function(l,n){return n(l,m)},l)};k.prototype.isAudioOnly=function(){return this.getState().callType===c("RTCCallType").AUDIO_ONLY};k.prototype.isCaller=function(){return this.getState().isCaller};function k(){h.apply(this,arguments)}f.exports=new k(c("RTCAppDispatcher"))}),null);
__d("RTCP2PCallStoreState",["FBRTCConstants","immutable","RTCCallType","RTCP2PConstants","RTCP2PProtocolHandler","RTCSignalingExperiments"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=c("RTCP2PConstants").ConnectionStatus,k=c("FBRTCConstants").VideoQuality,l={adminMessage:null,callType:c("RTCCallType").AUDIO_ONLY,connectionStatus:j.INIT,endCallReason:null,escalationConferenceName:null,isCaller:false,isPeerOnMobile:false,isRemoteVideoSupported:true,isScreenContentPoppedOut:false,offerEscalationSupport:false,protocolHandler:new(c("RTCP2PProtocolHandler"))(),signalingExperiments:new(c("RTCSignalingExperiments"))(),videoQuality:k.HD_VIDEO,wasConnected:false,wasStarRatingDone:false};h=babelHelpers.inherits(m,c("immutable").Record(l));i=h&&h.prototype;function m(){h.apply(this,arguments)}f.exports=m}),null);
__d("RTCGroupCallEscalationActions",["immutable","RTCAppDispatcher","RTCGroupCallEscalationActionTypes"],(function a(b,c,d,e,f,g){"use strict";var h={start:function i(){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallEscalationActionTypes").GROUP_ESCALATION_START})},cancel:function i(){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallEscalationActionTypes").GROUP_ESCALATION_CANCEL,reason:"cancelled"})},approve:function i(){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallEscalationActionTypes").GROUP_ESCALATION_SUCCESS})},setUsersToRing:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCGroupCallEscalationActionTypes").GROUP_ESCALATION_SET_USERS_TO_RING,usersToRing:j})}};f.exports=h}),null);
__d("RTCUserMediaRequest",["immutable"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=c("immutable").Record({error:null,state:null});h=babelHelpers.inherits(k,j);i=h&&h.prototype;function k(){h.apply(this,arguments)}f.exports=k}),null);
__d("RTCUserMediaRequestState",["keyMirror"],(function a(b,c,d,e,f,g){"use strict";var h=c("keyMirror")({FULFILLED:null,PENDING:null,REJECTED:null});f.exports=h}),null);
__d("RTCGroupCallEscalator",["invariant","CurrentUser","FBRTCConstants","FBRTCGroupCallStore","FBRTCHangupReason","immutable","MercuryIDs","MercuryParticipants","MessengerRTCFunnelLogger","RTCAppDispatcher","RTCCallActions","RTCCallStore","RTCConferenceState","RTCGroupCallActions","RTCGroupCallEscalationActions","RTCGroupCallEscalationStore","RTCMWProtocolHandler","RTCUser","RTCUserMediaRequest","RTCUserMediaRequestState","RTCUtils","Run","URI"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=c("FBRTCConstants").GroupVideoViewLayout,j=45e3;function k(m,n,o){__p&&__p();this.$RTCGroupCallEscalator16=0;this.$RTCGroupCallEscalator5=m;this.$RTCGroupCallEscalator6=n;this.$RTCGroupCallEscalator13=o;this.$RTCGroupCallEscalator4=1;this.$RTCGroupCallEscalator7="naturals";this.$RTCGroupCallEscalator11=true;this.$RTCGroupCallEscalator12=true;this.$RTCGroupCallEscalator14=[o];this.$RTCGroupCallEscalator15=false;this.$RTCGroupCallEscalator18=new(c("RTCUserMediaRequest"))();this.$RTCGroupCallEscalator19=null;c("Run").onUnload(function(){c("MessengerRTCFunnelLogger").endFunnel("call_page_unloaded");var p=c("RTCCallStore").getState().callInfo.conferenceState;if(p===c("RTCConferenceState").TERMINATED)return;c("RTCMWProtocolHandler").endCall(this.$RTCGroupCallEscalator5,c("RTCCallStore").getState().callInfo.serverInfoData,c("FBRTCHangupReason").HANGUP_CALL,"BrowserClosed")}.bind(this))}k.prototype.getParticipants=function(){return this.$RTCGroupCallEscalator19};k.prototype.$RTCGroupCallEscalator20=function(){return setTimeout(function(){if(!c("RTCGroupCallEscalationStore").getState().readyToTransition){l("Group Escalation timed out");c("RTCGroupCallEscalationActions").cancel()}},j)};k.prototype.startEscalationToMultiway=function(){__p&&__p();l("Escalating P2P call to Multiway call %o",this.$RTCGroupCallEscalator5);var m=c("RTCGroupCallEscalationStore").getState().inProgress;if(m)return;c("RTCGroupCallEscalationActions").start();this.$RTCGroupCallEscalator3=this.$RTCGroupCallEscalator20();this.$RTCGroupCallEscalator17=new(c("RTCMWProtocolHandler"))();c("RTCAppDispatcher").explicitlyRegisterStores([c("FBRTCGroupCallStore")]);c("RTCGroupCallActions").setLayout(this.$RTCGroupCallEscalator15?i.STRIP:this.$RTCGroupCallEscalator12?i.GRID:this.$RTCGroupCallEscalator11?i.DOMINANT_SPEAKER:i.STRIP);c("RTCGroupCallActions").setUseDominantSpeakeView(this.$RTCGroupCallEscalator11);c("RTCGroupCallActions").setUseGridView(this.$RTCGroupCallEscalator12);c("RTCGroupCallActions").setUseStripView(this.$RTCGroupCallEscalator15);var n=c("MercuryIDs").getParticipantIDFromUserID(c("CurrentUser").getID());c("MercuryParticipants").get(n,function(o){var p={};p[n]=o;var q=c("immutable").Map(p);this.$RTCGroupCallEscalator19=q;c("RTCGroupCallActions").initThread(null,q);this.$RTCGroupCallEscalator21(this.$RTCGroupCallEscalator14)}.bind(this))};k.prototype.initializeParticipantsAndStartCall=function(m,n){__p&&__p();var o=m.keySeq().toArray();c("MercuryParticipants").getBigImageMulti(o,function(p){if(n)c("RTCCallActions").initRemoteUsers(m.filter(function(r){var s=r.fbid;return s!==c("CurrentUser").getID()}).map(function(r){return this.$RTCGroupCallEscalator22(r,p)}.bind(this)).toSet());var q=c("MercuryIDs").getParticipantIDFromUserID(c("CurrentUser").getID());c("RTCCallActions").initLocalUser(this.$RTCGroupCallEscalator22(m.get(q),p));this.$RTCGroupCallEscalator21(this.$RTCGroupCallEscalator14)}.bind(this),100)};k.prototype.$RTCGroupCallEscalator22=function(m,n){var o=m.big_image_src,p=m.fbid,q=m.href,r=m.image_src,s=m.is_messenger_user,t=m.name,u=m.short_name;p||h(0);if(n){var v=c("MercuryIDs").getParticipantIDFromUserID(p);o=n[v]}return new(c("RTCUser"))({FBID:p,profileUrl:new(c("URI"))(q),profilePictureUrl:o||r,isMessengerUser:!!s,userName:t,userShortName:u})};k.prototype.$RTCGroupCallEscalator21=function(m,n,o){this.$RTCGroupCallEscalator16=setTimeout(function(){this.$RTCGroupCallEscalator18=this.$RTCGroupCallEscalator18.set("state",this.$RTCGroupCallEscalator18.state||c("RTCUserMediaRequestState").PENDING)}.bind(this),200);c("MessengerRTCFunnelLogger").appendAction("user_media_requested");c("RTCUtils").initLocalStream(this.$RTCGroupCallEscalator6).then(function(p){clearTimeout(this.$RTCGroupCallEscalator16);this.$RTCGroupCallEscalator18=this.$RTCGroupCallEscalator18.set("state",c("RTCUserMediaRequestState").FULFILLED);c("MessengerRTCFunnelLogger").appendAction("user_media_succeeded");this.$RTCGroupCallEscalator23(p,m,n,o)}.bind(this))["catch"](function(p){c("MessengerRTCFunnelLogger").appendAction("user_media_rejected")})};k.prototype.$RTCGroupCallEscalator23=function(m,n,o,p){__p&&__p();var q=this.$RTCGroupCallEscalator5;p=p?p:null;c("RTCCallActions").addLocalStream(m);var r={};if(p)r.serverInfoData=p;if(o)r.callTrigger=o;if(this.$RTCGroupCallEscalator13)r.isEscalatedCall=true;this.$RTCGroupCallEscalator17.startCall(n,[m],q,r)};k.ESCALATION_TIMEOUT=j;function l(){}f.exports=k}),null);
__d("RTCP2PCallEscalationActions",["RTCAppDispatcher","RTCCallActionTypes","RTCP2PCallEscalationActionTypes"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h={start:function i(){c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_START})},setRequest:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SET_REQUEST,request:j})},cancel:function i(){c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_FAILURE,reason:"cancelled"})},timeout:function i(){c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_FAILURE,reason:"timeout"})},handleACK:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_ACK,token:j})},approve:function i(){c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SUCCESS})},decline:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_FAILURE,reason:"denied",token:j,response:false})},setResponse:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SET_RESPONSE,response:j})},parseResponse:function i(j,k){if(j)c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_SUCCESS,token:k});else c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallEscalationActionTypes").P2P_CALL_ESCALATION_FAILURE,reason:"denied",token:k,response:false})},muteRemoteVideo:function i(){c("RTCAppDispatcher").dispatch({type:c("RTCCallActionTypes").REMOTE_VIDEO_MUTED})}};f.exports=h}),null);
__d("RTCP2PCallEscalator",["FBRTCCallSummaryStore","FBRTCConstants","RTCCallStore","RTCP2PCallEscalationActions","RTCP2PCallEscalationStore","dangerouslyBypassDispatchError"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("FBRTCConstants").PayloadType,i=25e3;j.isEscalated=function(){return c("RTCP2PCallEscalationStore").isEscalated()};j.isNegotiationAllowed=function(){return c("RTCP2PCallEscalationStore").isNegotiationAllowed()};function j(m,n,o){this.$RTCP2PCallEscalator3=m;this.$RTCP2PCallEscalator1=n;this.$RTCP2PCallEscalator2=o;this.$RTCP2PCallEscalator6()}j.prototype.$RTCP2PCallEscalator6=function(){__p&&__p();var m=c("RTCP2PCallEscalationStore").getState();this.$RTCP2PCallEscalator4=c("RTCP2PCallEscalationStore").addListener(function(){__p&&__p();var n=c("RTCP2PCallEscalationStore").getState();if(n===m)return;if(!n.awaitingACK&&n.awaitingACK!==m.awaitingACK)clearTimeout(this.$RTCP2PCallEscalator5);if(n.callType!==m.callType){var o=c("RTCCallStore").getState(),p=o.callSummary;p.setCallType(n.callType);p.save(c("FBRTCCallSummaryStore").getInstance())}m=n}.bind(this))};j.prototype.destroy=function(){l("P2P Escalator %o","destroy");this.$RTCP2PCallEscalator4.remove();clearTimeout(this.$RTCP2PCallEscalator5)};j.prototype.generateRequestToken=function(){__p&&__p();var m=c("RTCP2PCallEscalationStore").getState(),n=m.token;if(n!=null){l("P2P Escalator %o","request token","reuse");return n}l("P2P Escalator %o","request token");var o=this.$RTCP2PCallEscalator2.sendVideoEscalationRequest(this.$RTCP2PCallEscalator3,this.$RTCP2PCallEscalator1,true);clearTimeout(this.$RTCP2PCallEscalator5);this.$RTCP2PCallEscalator5=this.$RTCP2PCallEscalator7();return o.msg_id.toString()};j.prototype.generateResponseToken=function(m,n){__p&&__p();var o=c("RTCP2PCallEscalationStore").getState(),p=o.token;if(p!=null){l("P2P Escalator %o","response token","reuse");return p}l("P2P Escalator %o %o %o","response token",n,m);var q=m.peerID,r=m.callID,s=m.msgID,t=this.$RTCP2PCallEscalator2.sendVideoRequestResponse(q,r,s,n);clearTimeout(this.$RTCP2PCallEscalator5);var u=t.msg_id.toString();if(!n)c("dangerouslyBypassDispatchError")(function(){return c("RTCP2PCallEscalationActions").decline(u)});else this.$RTCP2PCallEscalator5=this.$RTCP2PCallEscalator7();return u};j.prototype.$RTCP2PCallEscalator7=function(){return setTimeout(c("RTCP2PCallEscalationActions").timeout,i)};j.prototype.parseMessage=function(m){l("P2P Escalator %o","parse message",this.$RTCP2PCallEscalator3,m.msgType);switch(m.msgType){case h.VIDEO_REQUEST:if(m.ackID)this.$RTCP2PCallEscalator8(m);else this.$RTCP2PCallEscalator9(m);break;case h.ACK:if(m.msg.ack_type===h.VIDEO_REQUEST)c("RTCP2PCallEscalationActions").handleACK(m.ackID.toString());break}};j.prototype.$RTCP2PCallEscalator8=function(m){l("P2P Escalator %o","parse response",m);var n=m.ackID.toString();if(c("RTCP2PCallEscalationStore").getToken()===n)this.$RTCP2PCallEscalator10(m);c("RTCP2PCallEscalationActions").parseResponse(k(m.msg),n)};j.prototype.$RTCP2PCallEscalator9=function(m){__p&&__p();l("P2P Escalator %o","parse request",m);if(c("RTCP2PCallEscalationStore").isInProgress()&&c("RTCP2PCallEscalationStore").didCurrentUserInitiate()){l("P2P Escalator %o","auto-approve","mutual consent");c("RTCP2PCallEscalationActions").approve();this.$RTCP2PCallEscalator10(m);this.generateResponseToken(m,true);return}if(c("RTCP2PCallEscalationStore").isEscalated()){if(k(m.msg)){l("P2P Escalator %o","auto-approve");this.$RTCP2PCallEscalator10(m);this.generateResponseToken(m,true);clearTimeout(this.$RTCP2PCallEscalator5)}else{l("P2P Escalator %o","mute remote video");c("RTCP2PCallEscalationActions").muteRemoteVideo()}return}l("P2P Escalator %o %o","request",m);this.$RTCP2PCallEscalator10(m);c("RTCP2PCallEscalationActions").setRequest(m)};j.prototype.$RTCP2PCallEscalator10=function(m){var n=m.peerID,o=m.callID,p=m.msg;l("P2P Escalator %o","ACK","sent");this.$RTCP2PCallEscalator2.sendAck(n,o,p)};j.ACK_TIMEOUT=i;function k(m){var n=m.reqVideoOn,o=m.videoon;return Boolean(n||o)}function l(){}f.exports=j}),null);
__d("FBRTCGroupCallVideoEscalationDialog.react",["fbt","FBRTCConstants","MessengerDialog.react","MessengerDialogBody.react","MessengerDialogButton.react","MessengerDialogCancelButton.react","MessengerDialogFooter.react","React","RTCGroupCallActions","RTCMWProtocolHandler"],(function a(b,c,d,e,f,g,h){"use strict";var i=c("FBRTCConstants").CallType,j=function j(k){var l=k.userName,m=k.onToggle;return c("React").createElement(c("MessengerDialog.react"),{onToggle:m},c("React").createElement(c("MessengerDialogBody.react"),null,h._("{name} added video chat. Would you like to share your video?",[h.param("name",l)])),c("React").createElement(c("MessengerDialogFooter.react"),null,c("React").createElement(c("MessengerDialogCancelButton.react"),{onClick:function n(){return c("RTCGroupCallActions").setMWCallType(i.ESCALATION_DECLINED)}}),c("React").createElement(c("MessengerDialogButton.react"),{label:h._("Share Video"),onClick:function n(){c("RTCMWProtocolHandler").videoEscalation();m()},type:"primary"})))};f.exports=j}),null);
__d("RTCGroupCallAddMembersDialog.react",["cx","fbt","FluxContainer","immutable","MercuryIDs","MercuryLogMessageType","MercuryMessageActions","MercuryMessageObject","MercuryParticipants","MercuryTriodeSourceUtil","MessengerAdminGroupUtils","MessengerDialog.react","MessengerDialogButton.react","MessengerDialogCancelButton.react","MessengerDialogHeader.react","MessengerDialogTitle.react","MessengerGraphQLTokenizer.react","MessengerRTCGroupCallContactList.react","MessengerRTCGroupCallThreadRow.react","React","RTCAppDispatcher","RTCCallStore","RTCConferenceState","RTCGroupCallActions","RTCGroupCallEscalationActions","RTCMWProtocolHandler","RTCP2PCallStore"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j,k,l=c("React").PureComponent,m=460;j=babelHelpers.inherits(n,l);k=j&&j.prototype;n.getStores=function(){return[c("RTCCallStore")]};n.calculateState=function(){return{remoteUsers:c("RTCCallStore").getState().remoteUsers}};function n(o){__p&&__p();k.constructor.call(this,o);this.state={isParticipantSelected:this.props.participants.mapEntries(function(p){var q=p[0],r=p[1];return[this.$RTCGroupCallAddMembersDialog1(q),false]}.bind(this)),newParticipants:c("immutable").List(),remoteUsers:c("immutable").Set()};this.$RTCGroupCallAddMembersDialog2=function(p){this.setState({isParticipantSelected:this.state.isParticipantSelected.set(p,!this.state.isParticipantSelected.get(p))})}.bind(this);this.$RTCGroupCallAddMembersDialog3=function(){__p&&__p();var p=this.props,q=p.onUnmount,r=p.thread;q();var s=this.state.newParticipants.toArray().map(function(v){return v.getUniqueID()}),t=this.$RTCGroupCallAddMembersDialog4().map(function(v){var w=v.fbid;return w||""});if(this.props.isEscalatedCall){var u=[].concat(s,t).map(function(v){return c("MercuryIDs").getParticipantIDFromUserID(v)});c("MercuryParticipants").getMulti(u,function(v){c("RTCGroupCallEscalationActions").setUsersToRing(c("immutable").Map(v));var w=c("RTCP2PCallStore").getState(),x=w.protocolHandler;x.escalateToMultiway();return})}if(r){c("RTCGroupCallActions").addParticipantsToRing(s);this.$RTCGroupCallAddMembersDialog8(r);if(t.length>0)c("RTCMWProtocolHandler").addParticipants(c("RTCCallStore").getState().callInfo.conferenceName,c("RTCCallStore").getState().callInfo.serverInfoData,t)}else c("RTCMWProtocolHandler").addParticipants(c("RTCCallStore").getState().callInfo.conferenceName,c("RTCCallStore").getState().callInfo.serverInfoData,[].concat(s,t))}.bind(this);this.$RTCGroupCallAddMembersDialog5=function(p){this.setState({newParticipants:this.state.newParticipants.push(p)})}.bind(this);this.$RTCGroupCallAddMembersDialog7=function(p){var q=p.getUniqueID(),r=this.state.newParticipants,s=r.findIndex(function(t){return t.getUniqueID()===q});if(s!==-1)this.setState({newParticipants:r["delete"](s)})}.bind(this);this.$RTCGroupCallAddMembersDialog6=function(){this.setState({newParticipants:c("immutable").List()})}.bind(this);c("RTCAppDispatcher").explicitlyRegisterStores([c("RTCCallStore")])}n.prototype.render=function(){var o=this.props,p=o.participants,q=o.thread,r=o.viewerID,s=c("RTCCallStore").getState().callInfo.conferenceState;if(s===c("RTCConferenceState").TERMINATED)return null;var t=c("React").createElement("div",{className:"_2t45"},c("React").createElement("div",{className:"_225b"},i._("Group Members")),c("React").createElement(c("MessengerRTCGroupCallContactList.react"),{isParticipantSelected:this.state.isParticipantSelected,onClick:this.$RTCGroupCallAddMembersDialog2,remoteUsers:this.state.remoteUsers.toArray().sort(function(u,v){return u.userName.localeCompare(v.userName)}),participantStates:c("immutable").Map(this.state.remoteUsers.map(function(u){return[u.FBID,u.participantState]}))}));return c("React").createElement(c("MessengerDialog.react"),{onToggle:this.props.onUnmount,type:"default",width:m},c("React").createElement("div",{className:"_5zad"},c("React").createElement(c("MessengerDialogHeader.react"),null,c("React").createElement(c("MessengerDialogCancelButton.react"),null),c("React").createElement(c("MessengerDialogTitle.react"),null,i._("Add Group Members")),c("React").createElement(c("MessengerDialogButton.react"),{label:i._("Ring"),onClick:this.$RTCGroupCallAddMembersDialog3,disabled:this.$RTCGroupCallAddMembersDialog4().length+this.state.newParticipants.size===0,type:"primary"})),!this.props.isEscalatedCall?c("React").createElement(c("MessengerRTCGroupCallThreadRow.react"),{displayAddMemberWarning:true,participants:p,thread:q,viewerID:r}):null,c("React").createElement(c("MessengerGraphQLTokenizer.react"),{autoFocus:false,context:null,className:"_2el3",defaultEntries:t,enableMessageSearch:false,entries:this.state.newParticipants,excludeGroups:true,excludePages:true,forceHideClearButton:true,hasHoverState:false,hideViewWithEntries:false,onAddEntryAttempt:this.$RTCGroupCallAddMembersDialog5,onClear:this.$RTCGroupCallAddMembersDialog6,onRemoveEntryAttempt:this.$RTCGroupCallAddMembersDialog7,originalEntryIDs:c("immutable").Set(this.props.participants.keySeq().toArray().map(function(u){return c("MercuryIDs").getUserIDFromParticipantID(u)||u})),placeholder:i._("Add to group:"),showDefaultEntries:true,shouldQueryInternalBot:false,shouldQueryVCEndpoint:false,scrollableViewClassName:"_2el2",useLayer:false,viewer:this.props.viewerID,width:m})))};n.prototype.$RTCGroupCallAddMembersDialog8=function(o){if(this.state.newParticipants.size)if(c("MessengerAdminGroupUtils").isJoinableThread(o))this.state.newParticipants.forEach(function(q){var p=c("MercuryIDs").getThreadIDFromUserID(q.getUniqueID());this.$RTCGroupCallAddMembersDialog9().send(this.$RTCGroupCallAddMembersDialog10().constructUserGeneratedMessageObject(o.joinable_mode.link,c("MercuryTriodeSourceUtil").getMercuryTriodeSource(),p))}.bind(this));else{var p="thread:"+(o.thread_fbid||o.thread_id.split(".")[1]);this.$RTCGroupCallAddMembersDialog9().send(this.$RTCGroupCallAddMembersDialog10().constructLogMessageObject(c("MercuryTriodeSourceUtil").getMercuryTriodeSource(),p,c("MercuryLogMessageType").SUBSCRIBE,{added_participants:this.state.newParticipants.map(function(q){return c("MercuryIDs").getParticipantIDFromUserID(q.getUniqueID())}).toArray()}))}};n.prototype.$RTCGroupCallAddMembersDialog9=function(){return c("MercuryMessageActions").getForFBID(this.props.viewerID)};n.prototype.$RTCGroupCallAddMembersDialog10=function(){return c("MercuryMessageObject").getForFBID(this.props.viewerID)};n.prototype.$RTCGroupCallAddMembersDialog4=function(){return this.props.participants.filter(function(o,p){return this.state.isParticipantSelected.get(this.$RTCGroupCallAddMembersDialog1(p))}.bind(this)).toArray()};n.prototype.$RTCGroupCallAddMembersDialog1=function(o){return c("MercuryIDs").getUserIDFromParticipantID(o)||""};f.exports=c("FluxContainer").create(n)}),null);
__d("RTCIceCandidate",[],(function a(b,c,d,e,f,g){"use strict";f.exports=window.RTCIceCandidate||window.mozRTCPeerConnection}),null);
__d("RTCPeerConnection",[],(function a(b,c,d,e,f,g){"use strict";f.exports=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection}),null);
__d("RTCSessionDescription",["invariant","FBRTCConstants","FBRTCMediaType","FBRTCSdpUtils"],(function aa(ba,a,ca,da,b,ea,c){"use strict";__p&&__p();var d=a("FBRTCConstants").SignalingProtocol,e=window.RTCSessionDescription||window.mozRTCSessionDescription,f=2,g="o",h="m",i="a",j="rtpmap",k="ssrc-group",l="ssrc",m="cname",n="msid",o="mslabel",p="label",q="sendonly",r="recvonly",s="sendrecv",t="inactive",u="offer",v="answer",w="=",x=" ",y=":",z="\r\n",A="audio",fa="video",ga="application",B=function B(I,J){return I.startsWith(J+w)},C=function C(I){return I.substr(f)},D=function D(I,J){return I.startsWith(J+z)||I.startsWith(J+y)},E=function E(I,J){return I.substr(J.length+1)};function F(I){__p&&__p();this.$SessionDescription1=[];this.$SessionDescription2="-";this.$SessionDescription3="multiway";this.$SessionDescription4=1;this.$SessionDescription5="IN";this.$SessionDescription6="IP4";this.$SessionDescription7="127.0.0.1";I.forEach(function(J){__p&&__p();if(B(J,g)){var K=C(J).split(x);if(K.length==6){this.$SessionDescription2=K[0];this.$SessionDescription3=K[1];this.$SessionDescription4=parseInt(K[2],10);this.$SessionDescription5=K[3];this.$SessionDescription6=K[4];this.$SessionDescription7=K[5]}}this.$SessionDescription1.push(J)}.bind(this))}F.prototype.setVersion=function(I){this.$SessionDescription4=I};F.prototype.getVersion=function(){return this.$SessionDescription4};F.prototype.toSdp=function(){return this.$SessionDescription1.map(function(I){if(B(I,g))return g+w+this.$SessionDescription2+x+this.$SessionDescription3+x+this.$SessionDescription4+x+this.$SessionDescription5+x+this.$SessionDescription6+x+this.$SessionDescription7;else return I}.bind(this)).join(z)};function G(I,J){__p&&__p();var K=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];this.$MediaDescription1=[];var L={},M=[],N=[];I.forEach(function(O){__p&&__p();var P=C(O);if(B(O,h))this.$MediaDescription4=P.split(x)[0];if(B(O,i)&&D(P,j)){var Q=E(P,j),R=Q.split(x),S=R[0],T=R[1];L[T]=S}if(B(O,i)&&D(P,l))this.$MediaDescription6(P,M);else if(B(O,i)&&D(P,k))this.$MediaDescription7(P,N);else if(B(O,i)&&(P===q||P===r||P===s||P===t))this.$MediaDescription5=P;else this.$MediaDescription1.push(O)}.bind(this));Object.keys(K).forEach(function(O){if(L[O]){var P=Object.keys(K[O]).map(function(Q){return Q+"="+K[O][Q]}).join(";");this.$MediaDescription1.push("a=fmtp:"+L[O]+" "+P)}}.bind(this));this.$MediaDescription3={};this.$MediaDescription2={};M.forEach(function(O){__p&&__p();if(Object.prototype.hasOwnProperty.call(O,m)){var P=O.cname;if(!this.$MediaDescription3[P])this.$MediaDescription3[P]=[O];else this.$MediaDescription3[P].push(O);var Q=this.findSsrcGroupForSsrc(N,O.ssrc);if(Q){if(!this.$MediaDescription2[P])this.$MediaDescription2[P]=[Q];else this.$MediaDescription2[P].push(Q);this.removeSsrcGroup(Q,N)}}}.bind(this));if(this.$MediaDescription4!==ga)if(J===u)if(M.length===0)this.$MediaDescription5=r;else this.$MediaDescription5=s;else if(J===v)this.$MediaDescription5=s}G.prototype.getMediaType=function(){return this.$MediaDescription4};G.prototype.findSsrcGroupForSsrc=function(I,J){return I.find(function(K){var L=K.ssrcs;return L.some(function(M){return M===J})})};G.prototype.addStreamsForEndpoint=function(I,J){this.$MediaDescription3[I]=J};G.prototype.addSsrcGroupsForEndpoint=function(I,J){this.$MediaDescription3[I].forEach(function(K){var L=K.ssrc,M=this.findSsrcGroupForSsrc(J,L);if(M){if(!this.$MediaDescription2[I])this.$MediaDescription2[I]=[M];else this.$MediaDescription2[I].push(M);this.removeSsrcGroup(M,J)}}.bind(this))};G.prototype.removeSsrcGroup=function(I,J){var K=J.indexOf(I);if(K!==-1)J.splice(K,1)};G.prototype.$MediaDescription7=function(I,J){var K=E(I,k);if(K){var L=K.split(x),M=L[0],N=L.slice(1);J.push({semantics:M,ssrcs:N.map(function(O){return parseInt(O,10)})})}};G.prototype.$MediaDescription6=function(I,J){__p&&__p();var K=I.indexOf(x),L=I.substr(0,K),M=parseInt(E(L,l),10),N=I.substr(K+1),O=J.find(function(O){return O.ssrc===M});if(!O){O={};O.ssrc=M;J.push(O)}if(D(N,m))O.cname=E(N,m);else if(D(N,n)){var P=E(N,n).split(x);O.msid={id:P[0],appdata:P[1]}}else if(D(N,o))O.mslabel=E(N,o);else if(D(N,p))O.label=E(N,p)};G.prototype.toSdp=function(){__p&&__p();var I=[];this.$MediaDescription1.forEach(function(L){I.push(L)});for(var J in this.$MediaDescription2)this.$MediaDescription2[J].forEach(function(L){I.push(i+w+k+y+L.semantics+x+L.ssrcs.join(x))});I.push(i+w+this.$MediaDescription5);for(var K in this.$MediaDescription3)this.$MediaDescription3[K].forEach(function(L){if(L.cname)I.push(i+w+l+y+L.ssrc+x+m+y+L.cname);if(L.msid)I.push(i+w+l+y+L.ssrc+x+n+y+L.msid.id+(L.msid.appdata?x+L.msid.appdata:""));if(L.mslabel)I.push(i+w+l+y+L.ssrc+x+o+y+L.mslabel);if(L.label)I.push(i+w+l+y+L.ssrc+x+p+y+L.label)});return I.join(z)};function H(I){__p&&__p();var J=arguments.length<=1||arguments[1]===undefined?{}:arguments[1],K=arguments.length<=2||arguments[2]===undefined?{}:arguments[2],L=J.type,M=L===undefined?"offer":L,N=J.sdp,O=N===undefined?"":N;this.$RTCSessionDescription2=I;this.type=M;switch(I){case d.CUSTOM:this.$RTCSessionDescription1=O;return;case d.MULTIWAY:this.$RTCSessionDescription3(O,K);return;case d.P2P:this.$RTCSessionDescription4(O,K);return}}H.prototype.$RTCSessionDescription3=function(I,J){__p&&__p();if(this.type=="offer")I=a("FBRTCSdpUtils").removeUnknownRtpHeaderExtensions(I);var K=I.trim().split(z),L=[],M=0;while(M<K.length&&!B(K[M],h)){L.push(K[M]);M++}this.sessionDescription=new F(L);this.mediaDescriptions=[];while(M<K.length){var N=[];N.push(K[M]);M++;while(M<K.length&&!B(K[M],h)){N.push(K[M]);M++}this.mediaDescriptions.push(new G(N,this.type,J.FORMAT_PARAMETERS))}};H.prototype.$RTCSessionDescription4=function(I,J){__p&&__p();var K,L=[function(I){return a("FBRTCSdpUtils").addIceOptionToSdp(I,"fb-force-5245")},function(I){return a("FBRTCSdpUtils").useDTLSOverCrypto(I)}];if(this.type==="offer"){if(J.DISABLE_VIDEO)L.push(function(I){return a("FBRTCSdpUtils").disableVideo(I)});L.push(function(I){return a("FBRTCSdpUtils").replaceRTPSAVPFProfile(I)},function(I){return a("FBRTCSdpUtils").preferIsac(I)},function(I){return a("FBRTCSdpUtils").removeSdparta(I)},function(I){return a("FBRTCSdpUtils").addSetup(I)},function(I){return a("FBRTCSdpUtils").removeUnknownRtpHeaderExtensions(I)});if(J.ADD_AUDIO_NACK)L.push(function(I){return a("FBRTCSdpUtils").addAudioNack(I)});if(J.FORMAT_PARAMETERS){var M=function M(R){__p&&__p();var S,T=R[0],ha=R[1],U=function U(Z){var ia=Z[0],$=Z[1];typeof $==="string"||c(0);L.push(function(I){return a("FBRTCSdpUtils").addFmtp(I,T,ia,$)})};for(var V=Object.entries(ha),W=Array.isArray(V),X=0,V=W?V:V[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var Y;if(W){if(X>=V.length)break;Y=V[X++]}else{X=V.next();if(X.done)break;Y=X.value}var Z=Y;U(Z)}};for(var N=Object.entries(J.FORMAT_PARAMETERS),O=Array.isArray(N),P=0,N=O?N:N[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var Q;if(O){if(P>=N.length)break;Q=N[P++]}else{P=N.next();if(P.done)break;Q=P.value}var R=Q;M(R)}}L.push(function(I){return a("FBRTCSdpUtils").clearFirefoxInactiveDataChannelBlock(I)})}if(J.ADD_FB_FEATURES!=null)L.push(function(I){Array.isArray(J.ADD_FB_FEATURES)||c(0);return a("FBRTCSdpUtils").addFBFeatures.apply(a("FBRTCSdpUtils"),[I].concat(J.ADD_FB_FEATURES))});this.$RTCSessionDescription1=L.reduce(function(I,S){return S(I)},I)};H.prototype.processServerMediaUpdate=function(I){__p&&__p();var J=I.sourceKey,K=I.media,L=I.ssrcGroups,M=[],N=[];K.forEach(function(O){O.ssrcs.forEach(function(P){var Q={ssrc:P,cname:J,msid:{id:J,appdata:O.id},label:O.id,mslabel:J};if(a("FBRTCMediaType").AUDIO===O.type)M.push(Q);else if(a("FBRTCMediaType").VIDEO===O.type)N.push(Q)})});this.mediaDescriptions.forEach(function(O){if(O.getMediaType()===A){O.addStreamsForEndpoint(J,M);O.addSsrcGroupsForEndpoint(J,L)}else if(O.getMediaType()===fa){O.addStreamsForEndpoint(J,N);O.addSsrcGroupsForEndpoint(J,L)}})};H.prototype.toDesc=function(){return new e({type:this.type,sdp:this.toSdp()})};H.prototype.toSdp=function(){var I=this.$RTCSessionDescription2;switch(I){case d.MULTIWAY:return[this.sessionDescription.toSdp(),this.mediaDescriptions.map(function(J){return J.toSdp()}).join(z),""].join(z);case d.CUSTOM:case d.P2P:default:return this.$RTCSessionDescription1}};H.prototype.strongDiff=function(I){var J=this.toSdp(),K=I.toSdp();return J!==K&&this.$RTCSessionDescription5(J)!==this.$RTCSessionDescription5(K)};H.prototype.$RTCSessionDescription5=function(I){return this.$RTCSessionDescription6(I).split("\r\n").filter(function(J){return!/^a=(candidate|setup):/.test(J)}).join("\r\n")};H.prototype.$RTCSessionDescription6=function(I){return I.replace(/(o=\S+\s\S+)\s\S+\s/,"$1 - ")};b.exports=H}),null);
__d("FBRTCPeerConnection",["Promise","regeneratorRuntime","FBRTCExperiment","FBRTCSdpUtils","Map","RTCIceCandidate","RTCPeerConnection","RTCSessionDescription","URI","UserAgent","isBonfireURI"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(w){__p&&__p();var x=arguments.length<=1||arguments[1]===undefined?{}:arguments[1],y=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];this.$FBRTCPeerConnection3=[];this.$FBRTCPeerConnection4=[];this.$FBRTCPeerConnection7=new(c("Map"))();this.addEventListener=function(z,A){var B=this.$FBRTCPeerConnection7.get(z);if(!Array.isArray(B)){B=[];this.$FBRTCPeerConnection7.set(z,B)}B.push(A);this.$FBRTCPeerConnection5.addEventListener(z,A)};this.removeEventListener=function(z,A){var B=this.$FBRTCPeerConnection7.get(z);if(Array.isArray(B)){B=B.filter(function(C){return C!==A});if(B.length<1)this.$FBRTCPeerConnection7["delete"](z);else this.$FBRTCPeerConnection7.set(z,B)}this.$FBRTCPeerConnection5.removeEventListener(z,A)};this.$FBRTCPeerConnection9=function(z){var A=z.candidate;if(A)this.$FBRTCPeerConnection4.push(A)}.bind(this);this.$FBRTCPeerConnection10=function(z){var A=z.channel;this.$FBRTCPeerConnection11(A)}.bind(this);this.$FBRTCPeerConnection6=w;this.$FBRTCPeerConnection1=x;this.$FBRTCPeerConnection2=y;this.$FBRTCPeerConnection5=this.$FBRTCPeerConnection8()}h.prototype.$FBRTCPeerConnection8=function(){__p&&__p();var w=new(c("RTCPeerConnection"))(this.$FBRTCPeerConnection1,this.$FBRTCPeerConnection2);w.addEventListener("icecandidate",this.$FBRTCPeerConnection9);w.addEventListener("datachannel",this.$FBRTCPeerConnection10);for(var x=this.$FBRTCPeerConnection7.entries(),y=Array.isArray(x),z=0,x=y?x:x[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var A;if(y){if(z>=x.length)break;A=x[z++]}else{z=x.next();if(z.done)break;A=z.value}var B=A,C=B[0],D=B[1];for(var E=D,F=Array.isArray(E),G=0,E=F?E:E[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var H;if(F){if(G>=E.length)break;H=E[G++]}else{G=E.next();if(G.done)break;H=G.value}var I=H;w.addEventListener(C,I)}}return w};h.prototype.removeAllListeners=function(){__p&&__p();for(var w=this.$FBRTCPeerConnection7.entries(),x=Array.isArray(w),y=0,w=x?w:w[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var z;if(x){if(y>=w.length)break;z=w[y++]}else{y=w.next();if(y.done)break;z=y.value}var A=z,B=A[0],C=A[1];for(var D=C,E=Array.isArray(D),F=0,D=E?D:D[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var G;if(E){if(F>=D.length)break;G=D[F++]}else{F=D.next();if(F.done)break;G=F.value}var H=G;this.$FBRTCPeerConnection5.removeEventListener(B,H)}}this.$FBRTCPeerConnection5.removeEventListener("datachannel",this.$FBRTCPeerConnection9);this.$FBRTCPeerConnection5.removeEventListener("icecandidate",this.$FBRTCPeerConnection9)};h.prototype.reset=function(){__p&&__p();var w=this.$FBRTCPeerConnection5;for(var x=this.$FBRTCPeerConnection7.entries(),y=Array.isArray(x),z=0,x=y?x:x[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var A;if(y){if(z>=x.length)break;A=x[z++]}else{z=x.next();if(z.done)break;A=z.value}var B=A,C=B[0],D=B[1];for(var E=D,F=Array.isArray(E),G=0,E=F?E:E[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var H;if(F){if(G>=E.length)break;H=E[G++]}else{G=E.next();if(G.done)break;H=G.value}var I=H;w.removeEventListener(C,I)}}w.removeEventListener("datachannel",this.$FBRTCPeerConnection9);w.removeEventListener("icecandidate",this.$FBRTCPeerConnection9);this.$FBRTCPeerConnection3=[];this.$FBRTCPeerConnection4=[];this.$FBRTCPeerConnection5=this.$FBRTCPeerConnection8();for(var J=w.getLocalStreams(),K=Array.isArray(J),L=0,J=K?J:J[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var M;if(K){if(L>=J.length)break;M=J[L++]}else{L=J.next();if(L.done)break;M=L.value}var N=M;this.addStream(N)}return c("Promise").race([new(c("Promise"))(function(O){var P=this.$FBRTCPeerConnection5,Q=function Q(R){var S=R.target;if(S.iceConnectionState!=="checking"&&S.iceConnectionState!=="new"){O();P.removeEventListener("iceconnectionstatechange",Q);q(w)}};P.addEventListener("iceconnectionstatechange",Q)}.bind(this)),new(c("Promise"))(function(O){return setTimeout(O,5e3)})])["catch"](function(O){return c("Promise").resolve()}).then(function(){q(w)})};h.prototype.close=function(){q(this.$FBRTCPeerConnection5)};h.prototype.getCreatedIceCandidates=function(){return this.$FBRTCPeerConnection4};h.prototype.$FBRTCPeerConnection11=function(w){w.addEventListener("close",function(){this.$FBRTCPeerConnection3=this.$FBRTCPeerConnection3.filter(function(x){return x!==w})}.bind(this));this.$FBRTCPeerConnection3.push(w)};h.prototype.onReceivedRemoteIceCandidate=function(w){var x=w.sdp,y=w.label,z=w.sdp_mid,A=new(c("RTCIceCandidate"))({sdpMLineIndex:y,candidate:c("FBRTCSdpUtils").fixMobileIceSdp(x),sdpMid:z});return this.$FBRTCPeerConnection5.addIceCandidate(A)};h.prototype.getSignalingProtocol=function(){return this.$FBRTCPeerConnection6};h.prototype.getLocalStreams=function(){return this.$FBRTCPeerConnection5.getLocalStreams()};h.prototype.getRemoteStreams=function(){return this.$FBRTCPeerConnection5.getRemoteStreams()};h.prototype.addStream=function(w,x){__p&&__p();if(r("addTrack"))for(var y=w.getTracks(),z=Array.isArray(y),A=0,y=z?y:y[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var B;if(z){if(A>=y.length)break;B=y[A++]}else{A=y.next();if(A.done)break;B=A.value}var C=B,D=this.$FBRTCPeerConnection5.addTrack(C,w);if(x)x(D)}else this.$FBRTCPeerConnection5.addStream(w)};h.prototype.removeStream=function(w){__p&&__p();var x,y=this;if(r("removeTrack")&&r("getSenders"))(function(){__p&&__p();var z=w.getTracks(),A=y.$FBRTCPeerConnection5.getSenders().filter(function(F){return z.includes(F.track)});for(var B=A,C=Array.isArray(B),D=0,B=C?B:B[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var E;if(C){if(D>=B.length)break;E=B[D++]}else{D=B.next();if(D.done)break;E=D.value}var F=E;y.$FBRTCPeerConnection5.removeTrack(F)}})();else this.$FBRTCPeerConnection5.removeStream(w)};h.prototype.createOffer=function w(){var x=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],y=arguments.length<=1||arguments[1]===undefined?{}:arguments[1],z=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];return c("regeneratorRuntime").async(function A(B){while(1)switch(B.prev=B.next){case 0:return B.abrupt("return",j(this.$FBRTCPeerConnection5,x).then(function(C){return v(C,z)}).then(function(C){return new(c("RTCSessionDescription"))(this.$FBRTCPeerConnection6,C,y)}.bind(this)));case 1:case"end":return B.stop()}},null,this)};h.prototype.createAnswer=function w(){var x=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];return c("regeneratorRuntime").async(function y(z){while(1)switch(z.prev=z.next){case 0:return z.abrupt("return",k(this.$FBRTCPeerConnection5).then(function(A){return new(c("RTCSessionDescription"))(this.$FBRTCPeerConnection6,A,x)}.bind(this)));case 1:case"end":return z.stop()}},null,this)};h.prototype.setLocalDescription=function w(x){return c("regeneratorRuntime").async(function y(z){while(1)switch(z.prev=z.next){case 0:return z.abrupt("return",o(this.$FBRTCPeerConnection5,x.toDesc()).then(function(){return x}));case 1:case"end":return z.stop()}},null,this)};h.prototype.setRemoteDescription=function w(x){return c("regeneratorRuntime").async(function y(z){while(1)switch(z.prev=z.next){case 0:return z.abrupt("return",p(this.$FBRTCPeerConnection5,x.toDesc()).then(function(){return x}));case 1:case"end":return z.stop()}},null,this)};h.prototype.getLocalDescription=function(){return new(c("RTCSessionDescription"))(this.$FBRTCPeerConnection6,this.$FBRTCPeerConnection5.localDescription||{})};h.prototype.getRemoteDescription=function(){return new(c("RTCSessionDescription"))(this.$FBRTCPeerConnection6,this.$FBRTCPeerConnection5.remoteDescription||{})};h.prototype.getSignalingState=function(){return this.$FBRTCPeerConnection5.signalingState};h.prototype.getIceGatheringState=function(){return this.$FBRTCPeerConnection5.iceGatheringState};h.prototype.getIceConnectionState=function(){return this.$FBRTCPeerConnection5.iceConnectionState};h.prototype.getStats=function w(x){__p&&__p();return c("regeneratorRuntime").async(function y(z){__p&&__p();while(1)switch(z.prev=z.next){case 0:if(!(x!=null)){z.next=2;break}return z.abrupt("return",c("Promise").reject(new Error("getStats() doesn't support selector (yet)")));case 2:if(!c("UserAgent").isBrowser("Edge")){z.next=4;break}return z.abrupt("return",c("Promise").resolve(new(c("Map"))()));case 4:if(!c("UserAgent").isBrowser("Firefox")){z.next=6;break}return z.abrupt("return",c("Promise").resolve(this.$FBRTCPeerConnection5.getStats()).then(function(A){if(c("UserAgent").isBrowser("Firefox >= 48"))return A;return t(A)}).then(function(A){__p&&__p();if(c("UserAgent").isBrowser("Firefox >= 53"))return A;try{A.forEach(function(C){C.type=u(C.type)})}catch(B){if(B.name!=="TypeError")throw B;A.forEach(function(C,D){A.set(D,babelHelpers["extends"]({},C,{type:u(C.type)}))})}return A}));case 6:if(!(c("UserAgent").isBrowser("Chrome")||c("UserAgent").isBrowser("Opera"))){z.next=8;break}return z.abrupt("return",new(c("Promise"))(function(A,B){this.$FBRTCPeerConnection5.getStats(A,B)}.bind(this)).then(function(A){__p&&__p();var B={};for(var C=A.result(),D=Array.isArray(C),E=0,C=D?C:C[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var F;if(D){if(E>=C.length)break;F=C[E++]}else{E=C.next();if(E.done)break;F=E.value}var G=F,H={id:G.id,timestamp:G.timestamp,type:u(G.type)};for(var I=G.names(),J=Array.isArray(I),K=0,I=J?I:I[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var L;if(J){if(K>=I.length)break;L=I[K++]}else{K=I.next();if(K.done)break;L=K.value}var M=L;H[M]=G.stat(M)}B[H.id]=H}return B}).then(t));case 8:return z.abrupt("return",c("Promise").reject(new Error("getStats() not supported")));case 9:case"end":return z.stop()}},null,this)};h.prototype.createDataChannel=function(w,x){if(this.$FBRTCPeerConnection5.createDataChannel){var y=this.$FBRTCPeerConnection5.createDataChannel(w,x);this.$FBRTCPeerConnection11(y);return y}return null};h.prototype.getDataChannelByLabel=function(w){return this.$FBRTCPeerConnection3.find(function(x){return x.label===w})};var i=c("UserAgent").isBrowser("Chrome < 59")||c("UserAgent").isBrowser("Opera < 46")||c("UserAgent").isBrowser("Firefox < 37");function j(w,x){if(i)return new(c("Promise"))(function(y,z){return w.createOffer(y,z,m(x))});return c("Promise").resolve(w.createOffer(m(x)))}function k(w){if(i)return new(c("Promise"))(function(x,y){return w.createAnswer(x,y)});return c("Promise").resolve(w.createAnswer())}var l=c("UserAgent").isBrowser("Chrome < 38")||c("UserAgent").isBrowser("Opera < 26");function m(w){var x=w.offerToReceiveAudio,y=x===undefined?true:x,z=w.offerToReceiveVideo,A=z===undefined?true:z,B=babelHelpers.objectWithoutProperties(w,["offerToReceiveAudio","offerToReceiveVideo"]);if(l){if(Object.keys(B).length>0)return{mandatory:{OfferToReceiveAudio:y,OfferToReceiveVideo:A},optional:babelHelpers["extends"]({},s(B))};return{mandatory:{OfferToReceiveAudio:y,OfferToReceiveVideo:A}}}return babelHelpers["extends"]({offerToReceiveAudio:y,offerToReceiveVideo:A},B)}var n=c("UserAgent").isBrowser("Chrome < 51")||c("UserAgent").isBrowser("Opera < 38")||c("UserAgent").isBrowser("Firefox < 37");function o(w,x){if(n)return new(c("Promise"))(function(y,z){return w.setLocalDescription(x,y,z)});return c("Promise").resolve(w.setLocalDescription(x))}function p(w,x){if(n)return new(c("Promise"))(function(y,z){return w.setRemoteDescription(x,y,z)});return c("Promise").resolve(w.setRemoteDescription(x))}function q(w){if(w&&w.signalingState!=="closed")w.close()}function r(w){return w in c("RTCPeerConnection").prototype}function s(w){__p&&__p();var x={};for(var y=Object.keys(w),z=Array.isArray(y),A=0,y=z?y:y[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var B;if(z){if(A>=y.length)break;B=y[A++]}else{A=y.next();if(A.done)break;B=A.value}var C=B,D=""+C.substr(0,1).toUpperCase()+C.substr(1);x[D]=w[C]}return x}function t(w){return new(c("Map"))(Object.keys(w).map(function(x){return[x,w[x]]}))}function u(w){switch(w){case"inbound-rtp":return"inboundrtp";case"outbound-rtp":return"outboundrtp";case"candidate-pair":return"candidatepair";case"local-candidate":return"localcandidate";case"remote-candidate":return"remotecandidate";default:return w}}function v(w,x){var y=x.audio,z=x.video,A=w.sdp,B=w.type,C=z&&z.match(/H264/),D=c("FBRTCExperiment").gen("rtc_browser_use_h264"),E=D.getParam("allow_h264","no"),F=c("isBonfireURI")(new(c("URI"))(window.location.href));if(E!=="yes"&&!C&&!F)A=c("FBRTCSdpUtils").removeH264(A);if(y)A=c("FBRTCSdpUtils").preferCodec(A,y,false);if(z)A=c("FBRTCSdpUtils").preferCodec(A,z,true);return c("Promise").resolve({sdp:A,type:B})}f.exports=h}),null);
__d("XGroupCallSendRequestController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/groupcall/sendrequest/",{webrtc_fbtrace:{type:"Int"}})}),null);
__d("MultiwayRequests",["Promise","AsyncRequest","FBRTCCapability","FBRTCMessageType","RTCConfig","RTCUtils","XGroupCallSendRequestController"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=15e3;function i(){}i.prototype.sendJoinRequest=function(j,k,l,m,n,o,p){var q=c("RTCUtils").createRequestHeader(c("FBRTCMessageType").JOIN,k,l),r={offer:{sdpString:m.toSdp()},deviceCapabilities:[c("FBRTCCapability").SUPPORT_AUDIO_DEPRECATED,c("FBRTCCapability").SUPPORT_VIDEO_DEPRECATED],userCapabilities:JSON.stringify({CAN_BE_MUTED:c("RTCConfig").RtcRemoteMuteCapability})};if(n&&n.length>0&&!p)r.usersToCall=n;if(p)r.userToEscalate=p;if(o)r.mediaStatus=o;var s={endpoint:j,jsonPayload:{header:q,body:{joinRequest:r}}};return this.$MultiwayRequests1(s)};i.prototype.sendHangupRequest=function(j,k,l,m,n){var o=c("RTCUtils").createRequestHeader(c("FBRTCMessageType").HANGUP,k,l),p={reason:m,detailedReasonString:n},q={endpoint:j,jsonPayload:{header:o,body:{hangupRequest:p}}};return this.$MultiwayRequests1(q)};i.prototype.sendAddParticipantsRequest=function(j,k,l,m){var n=c("RTCUtils").createRequestHeader(c("FBRTCMessageType").ADD_PARTICIPANTS,k,l),o={usersToInvite:m},p={endpoint:j,jsonPayload:{header:n,body:{addParticipantsRequest:o}}};return this.$MultiwayRequests1(p)};i.prototype.sendSubscriptionRequest=function(j,k,l,m){return this.$MultiwayRequests1({endpoint:j,jsonPayload:{header:c("RTCUtils").createRequestHeader(c("FBRTCMessageType").SUBSCRIPTION,k,l),body:{subscriptionRequest:{subscriptions:m}}}})};i.prototype.sendClientMediaUpdateRequest=function(j,k,l,m,n,o){return this.$MultiwayRequests1({endpoint:j,jsonPayload:{header:c("RTCUtils").createRequestHeader(c("FBRTCMessageType").CLIENT_MEDIA_UPDATE,k,l),body:{clientMediaUpdateRequest:{fromVersion:m,toVersion:n,mediaUpdates:o}}}})};i.prototype.$MultiwayRequests1=function(j){return new(c("Promise"))(function(k,l){var m=c("XGroupCallSendRequestController").getURIBuilder().getURI(),n=new(c("AsyncRequest"))(m).setMethod("POST").setData({request:JSON.stringify(j)}).setAllowCrossPageTransition(true).setHandler(function(o){k(o.payload)}).setErrorHandler(function(o){var p=o.getErrorDescription(),q=Error(p!=null?p.toString():"AsyncRequest error");l(q)}).setTimeoutHandler(h,function(){l("Timeout")});n.send()})};f.exports=new i()}),null);
__d("RTCMWProtocolHandler",["regeneratorRuntime","Promise","Base64","ChannelManager","CurrentUser","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCConstants","FBRTCGroupCallStore","FBRTCPeerConnection","FBRTCRtcResponseStatusCode","FBRTCSdpUtils","FBRTCVideoQuality","MercuryIDs","MercuryParticipants","MercuryParticipantsConstants","MultiwayParticipantFetcher","MultiwayRequests","RTCCallActions","RTCCallStore","RTCConfig","RTCGroupCallActions","RTCGroupCallEscalationStore","RTCMultiwayMessageHandler","RTCSessionDescription","RTCUtils","emptyFunction"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("FBRTCConstants").CallEndReason,i=c("FBRTCConstants").CallType,j=c("FBRTCConstants").GroupVideoViewLayout,k=c("FBRTCConstants").IceConnectionState,l=c("FBRTCConstants").SignalingProtocol,m="229895473858072",n=18e4,o={appId:m,deviceId:c("ChannelManager").getCompleteConfig().sessionID,userId:c("CurrentUser").getID()};c("ChannelManager").startChannelManager();function p(){__p&&__p();var r=arguments.length<=0||arguments[0]===undefined?null:arguments[0];this.$RTCMWProtocolHandler4=false;this.$RTCMWProtocolHandler5=false;this.$RTCMWProtocolHandler8=function(s){__p&&__p();var t=s.target;c("RTCCallActions").emit("onIceConnectionStateChange",t.iceConnectionState);switch(t.iceConnectionState){case k.DISCONNECTED:case k.FAILED:if(!this.$RTCMWProtocolHandler2)this.$RTCMWProtocolHandler2=setTimeout(function(){c("RTCCallActions").endCall(h.CONNECTION_DROPPED,"ConnectionDropped");this.$RTCMWProtocolHandler11()}.bind(this),n);break;default:clearTimeout(this.$RTCMWProtocolHandler2);this.$RTCMWProtocolHandler2=null}}.bind(this);this.$RTCMWProtocolHandler1=r}p.prototype.setKeepLocalStreamsOnClose=function(r){this.$RTCMWProtocolHandler5=r};p.prototype.startCall=function(r,s,t,u){__p&&__p();var v=u.addStreamCallback,w=v===undefined?c("emptyFunction"):v,x=u.callTrigger,y=u.formatParameters,z=y===undefined?{}:y,A=u.preferredCodecs,B=A===undefined?{}:A,C=u.serverInfoData,D=u.shouldSetDescriptions,E=D===undefined?true:D,F=u.isEscalatedCall,G=F===undefined?false:F,H=u.connectedOnJoin,I=H===undefined?false:H;c("RTCCallActions").initialize(l.MULTIWAY,t,C,this.$RTCMWProtocolHandler1,x);var J=c("FBRTCCallSummary").restoreOrInitialize(c("FBRTCCallSummaryStore").getInstance(),c("RTCUtils").isGroupCall(t)?-1:c("RTCUtils").getPeerID(t),this.$RTCMWProtocolHandler1,!C);x&&J.onCallStarted(x);J.setIsUsingMultiway(1);J.onPopupOpened();J.setConferenceName(t);J.setServerInfoData(C);J.save(c("FBRTCCallSummaryStore").getInstance());c("RTCCallActions").setCallSummary(J);c("RTCGroupCallActions").setMWCallType(s.some(function(N){return N.getVideoTracks().length>0})?i.DIRECT_VIDEO:i.VOIP);var K={mandatory:{},optional:[{googNumUnsignalledRecvStreams:10},{googHighBitrate:true},{googVeryHighBitrate:true},{RtpDataChannels:true}]};if(!c("RTCConfig").RtcUseDtlsGK)K.optional.push({DtlsSrtpKeyAgreement:false});var L=new(c("FBRTCPeerConnection"))(l.MULTIWAY,{iceServers:[]},K),M=L.createDataChannel("data");if(M)M.onmessage=function(N){var O=N.data;try{var P=JSON.parse(O),Q=P.body;this.$RTCMWProtocolHandler6(Q)}catch(R){}}.bind(this);L.addEventListener("addstream",function(event){this.$RTCMWProtocolHandler7(t,event.stream)}.bind(this));L.addEventListener("removestream",function(event){c("RTCCallActions").removeRemoteStream(event.stream)});L.addEventListener("iceconnectionstatechange",this.$RTCMWProtocolHandler8);this.$RTCMWProtocolHandler9(L,s,t,C,r,w,z,B,E,G,I);if(!C)c("RTCCallActions").call(r,L);else c("RTCCallActions").join(L);return L};p.prototype.$RTCMWProtocolHandler7=function(r,s){__p&&__p();s.onaddtrack=function(u){var v=u.target,w=u.track;c("RTCCallActions").addRemoteTrack(v,w)};s.onremovetrack=function(u){var v=u.target,w=u.track;c("RTCCallActions").removeRemoteTrack(v,w)};var t=s.id.split(":")[0];if(t!==c("CurrentUser").getID())c("MultiwayParticipantFetcher").fetchParticipant(r,t).done(function(u){__p&&__p();var v={},w=c("MercuryIDs").getParticipantIDFromUserID(t);c("MercuryParticipants").getBigImageMulti([w],function(x){v[w]=u;c("RTCGroupCallActions").onParticipantsAdded(v,x);c("RTCCallActions").addRemoteStream(s);if(c("RTCGroupCallEscalationStore").getState().inProgress)c("RTCCallActions").setPreferredRemoteStream(s);var y=c("RTCCallStore").getState(),z=y.callInfo,A=c("FBRTCGroupCallStore").getState(),B=A.layout,C=A.pinnedSpeakerFBID,D=c("RTCCallStore").getConnection(l.MULTIWAY);if(D)p.subscription(z.conferenceName,z.serverInfoData,D.getRemoteStreams(),B,C)},c("MercuryParticipantsConstants").WWW_INCALL_THUMBNAIL_SIZE)})};p.prototype.$RTCMWProtocolHandler6=function(r){if(r.genericMessage&&r.genericMessage.data){var s=JSON.parse(c("Base64").decode(r.genericMessage.data)),t=!c("RTCCallStore").getState().localUser.isAudioMuted();if(s.RTC_REMOTE_COMMAND==="MUTE_SELF"&&t)c("RTCCallActions").toggleMuteAudio(false)}else if(r.dominantSpeakerNotification){var u=r.dominantSpeakerNotification.userId;c("RTCGroupCallActions").setDominantSpeaker(u)}};p.prototype.setDescriptions=function(){this.$RTCMWProtocolHandler4=true;var r=c("RTCCallStore").getConnection(l.MULTIWAY);if(this.$RTCMWProtocolHandler3&&r)r.setRemoteDescription(this.$RTCMWProtocolHandler3)};p.videoEscalation=function(){__p&&__p();return c("RTCUtils").initLocalStream(true).then(function(r){__p&&__p();var s=c("RTCCallStore").getState(),t=s.callInfo,u=t.conferenceName,v=t.serverInfoData,w=s.localUser,x=c("RTCCallStore").getConnection(l.MULTIWAY);if(!x)return;r.getTracks().forEach(function(z){if(z.kind==="audio")z.enabled=!w.isAudioMuted()});var y=w.streams.first();x.removeStream(y);return q(x,[r],u,v,[]).then(function(){c("RTCCallActions").removeLocalStream(y);c("RTCCallActions").addLocalStream(r);c("RTCGroupCallActions").setMWCallType(i.ESCALATED)})})};p.startScreenStream=function(r){__p&&__p();var s=c("RTCCallStore").getState(),t=s.callInfo,u=t.conferenceName,v=t.serverInfoData,w=s.connections,x=s.localUser,y=w.first(),z=x.streams.first();if(z){for(var A=z.getAudioTracks(),B=Array.isArray(A),C=0,A=B?A:A[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var D;if(B){if(C>=A.length)break;D=A[C++]}else{C=A.next();if(C.done)break;D=C.value}var E=D;r.addTrack(E);z.removeTrack(E)}y.removeStream(z)}return q(y,[r],u,v,[]).then(function(){c("RTCCallActions").addLocalScreenStream(r);if(z)c("RTCCallActions").removeLocalStream(z)})};p.restartCameraStream=function(){var r=c("RTCCallStore").getState(),s=r.callInfo,t=s.conferenceName,u=s.serverInfoData,v=r.connections,w=r.localUser,x=w.streams.first(),y=v.first();if(x){y.removeStream(x);c("RTCCallActions").removeLocalStream(x)}return c("RTCUtils").initLocalStream(true).then(function(z){return q(v.first(),[z],t,u,[]).then(function(){c("RTCCallActions").addLocalStream(z)})})};p.endCall=function(r,s,t){var u=arguments.length<=3||arguments[3]===undefined?"":arguments[3];p.genEndCall(r,t,{serverInfoData:s,detailedReasonString:u,keepLocalStream:false}).done()};p.genEndCall=function(r,s,t){c("RTCMultiwayMessageHandler").close();if(!t.keepLocalStream)c("RTCCallActions").removeAllLocalStreams(true);var u=t.detailedReasonString||"Hangup by user";c("RTCCallActions").hangup(s,u);return c("MultiwayRequests").sendHangupRequest(o,r,t.serverInfoData,s,u).then(function(){c("RTCCallActions").hangupSuccess()})["catch"](function(v){c("RTCCallActions").hangupError();throw v})};p.otherUserInAnotherCall=function(r,s,t){var u=arguments.length<=3||arguments[3]===undefined?"":arguments[3];c("MultiwayRequests").sendHangupRequest(o,r,s,t,u||"User receiving this call is in another call").done()};p.prototype.iceRestart=function(r,s){var t=c("RTCCallStore").getConnection(l.MULTIWAY);if(t)q(t,[],r,s,[],{iceRestart:true})};p.addParticipants=function(r,s,t){c("MultiwayRequests").sendAddParticipantsRequest(o,r,s,t)};p.subscription=function(r,s,t,u,v){var w=u===j.DOMINANT_SPEAKER?c("FBRTCVideoQuality").LOW:u===j.GRID?c("FBRTCVideoQuality").MEDIUM:c("FBRTCVideoQuality").HIGH,x=t.map(function(y){var z=y.id;return{cname:z,options:{videoQuality:u===j.DOMINANT_SPEAKER&&v===z.split(":")[0]?c("FBRTCVideoQuality").HIGH:w}}});if(u===j.DOMINANT_SPEAKER&&!v)x.push({cname:""});c("MultiwayRequests").sendSubscriptionRequest(o,r,s,x)};p.clientMediaUpdate=function(r,s,t,u,v){c("MultiwayRequests").sendClientMediaUpdateRequest(o,r,s,t,u,v).then(function(w){var x=w.header.responseStatusCode,y=w.body.clientMediaUpdateResponse.currentVersion;return c("RTCGroupCallActions").onClientMediaUpdateResponse(x,y)})["catch"](function(w){})};p.prototype.$RTCMWProtocolHandler9=function(r,s,t,u,v,w,x,y,z,A,B){this.$RTCMWProtocolHandler10(t,u);q(r,s,t,u,v,{},w,x,y,z,A).done(function(C){this.$RTCMWProtocolHandler3=C;if(this.$RTCMWProtocolHandler4)this.setDescriptions();c("RTCCallActions").callSuccess(B)}.bind(this),function(C){c("RTCCallActions").callError(C);this.$RTCMWProtocolHandler11()}.bind(this))};p.prototype.$RTCMWProtocolHandler11=function(){var r=c("RTCCallStore").getConnection(l.MULTIWAY);c("RTCMultiwayMessageHandler").close();if(r)r.close();if(!this.$RTCMWProtocolHandler5)c("RTCCallActions").removeAllLocalStreams(true)};p.prototype.$RTCMWProtocolHandler10=function(r,s){c("RTCMultiwayMessageHandler").initHandler(r,s)};function q(r,s,t,u,v){__p&&__p();var w=arguments.length<=5||arguments[5]===undefined?{}:arguments[5],x=arguments.length<=6||arguments[6]===undefined?c("emptyFunction"):arguments[6],y=arguments.length<=7||arguments[7]===undefined?{}:arguments[7],z=arguments.length<=8||arguments[8]===undefined?{}:arguments[8],A=arguments.length<=9||arguments[9]===undefined?true:arguments[9],B=arguments.length<=10||arguments[10]===undefined?false:arguments[10],C,D,E,F,G,H;return c("regeneratorRuntime").async(function I(J){__p&&__p();while(1)switch(J.prev=J.next){case 0:C={};D=[];s.forEach(function(K){D.concat(K.getTracks());r.addStream(K,x)});D.forEach(function(K){C[K.id]=true});J.next=6;return c("regeneratorRuntime").awrap(r.createOffer(w,{FORMAT_PARAMETERS:y},z));case 6:E=J.sent;if(c("FBRTCSdpUtils").validateOfferSdp(t,E.toSdp())){J.next=9;break}throw c("FBRTCRtcResponseStatusCode").BAD_REQUEST;case 9:J.next=11;return c("regeneratorRuntime").awrap(r.setLocalDescription(E));case 11:c("RTCGroupCallActions").onJoinRequestSent();J.next=14;return c("regeneratorRuntime").awrap(c("MultiwayRequests").sendJoinRequest(o,t,u,E,v.length>0?v:null,D.length>0?C:null,B&&v.length>0?v[0]:null));case 14:F=J.sent;G=F.header.responseStatusCode;if(!(G!==c("FBRTCRtcResponseStatusCode").OK)){J.next=18;break}return J.abrupt("return",new(c("Promise"))(function(K,L){L(G)}));case 18:c("RTCGroupCallActions").onJoinResponse(F.header.serverInfoData);H=new(c("RTCSessionDescription"))(l.MULTIWAY,{type:"answer",sdp:F.body.joinResponse.answer.sdpString},{FORMAT_PARAMETERS:y});if(!A){J.next=23;break}J.next=23;return c("regeneratorRuntime").awrap(r.setRemoteDescription(H));case 23:c("RTCGroupCallActions").toggleRemoteStream(F.body.joinResponse.mediaStatus);return J.abrupt("return",H);case 25:case"end":return J.stop()}},null,this)}f.exports=p}),null);
__d("CollabCallMessengerBrowserEventEnum",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({CALL_START_TRY:"call: try",CALL_PROCESS_STARTED:"call: start process",CALL_CONNECTED:"call: connected",CALL_ENDED:"call: ended",CONNECTION_INFO:"connection info",TURN_CREDENTIALS_RECEIVED:"TURN credentials received",HANGUP_CALL_ID_MISSMATCH:"hangup callID missmatch",CONNECTION_RECOVERY:"connection recovery",OFFER_ACCEPTED:"offer accepted",OFFER_IGNORED:"offer ignored",RENEGOTIATION:"offer renegotiation",LOCAL_STREAM_SET:"local stream: set",LOCAL_STREAM_READY:"local stream: ready",LOCAL_STREAM_STARTED:"local stream: started",LOCAL_STREAM_TRACKS_CHANGED:"local stream: tracks changed",LOCAL_SCREEN_STREAM_SET:"screen stream: set",SCREEN_SHARING_CANCELLED:"screen sharing: cancelled",SCREEN_SHARING_DIALOG_CANCEL:"screen sharing: dialog cancel",SCREEN_SHARING_DIALOG_SUCCESS:"screen sharing: dialog success",SCREEN_SHARING_EXT_DIALOG:"screen sharing: extension install dialog",SCREEN_SHARING_EXT_LINK:"screen sharing: user clicked on install link",SCREEN_SHARING_NOT_SUPPORTED:"screen sharing: not supported",SCREEN_SHARING_TOGGLED:"screen sharing: toggled",SCREEN_SHARING_ERROR:"screen sharing: error",REMOTE_STREAM_SET:"remote stream: set",REMOTE_STREAM_STARTED:"remote stream: started",REMOTE_STREAM_TRACKS_CHANGED:"remote stream: tracks changed",REMOTE_STREAM_ADDED:"remote stream: added",REMOTE_STREAM_MUTE_TOGGLED:"remote steam: mute toggled",REMOTE_STREAM_REMOVED:"remote stream: removed",FAIL_BROWSER_NOT_SUPPORTED:"browser not supported",CALL_CONTROLLER_INIT:"call controller init",REQUEST_USER_MEDIA:"request user media",WSS_START_TRY:"wss: try",WSS_CONNECTED:"wss: connected",WSS_ENDED:"wss: ended",ICE_CONNECTION_STATE_CHANGE:"ICE connection state change",ICE_GATHERING_STATE_CHANGE:"ICE gathering state change",ICE_CANDIDATE_ERROR:"ICE candidate error",USER_SETTINGS_CHANGED:"user settings change",RTC_ERROR:"RTC error",MESSAGE_SENT:"message sent",MESSAGE_RECEIVED:"message received",SDP_UPDATE:"SDP update",GET_USER_MEDIA_ERROR:"get user media: error",INIT_USER_MEDIA_CONSTRAINT:"init user media constraint"})}),null);
__d("XRTCCallNUXController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/rtc/call/nuxstatus/",{})}),null);
__d("RTCP2PCallNUXActions",["FBRTCUtils","RTCAppDispatcher","RTCP2PCallActionTypes","XRTCCallNUXController","dangerouslyBypassDispatchError"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h={refreshNUXState:function i(){c("FBRTCUtils").sendServerRequest(c("XRTCCallNUXController").getURIBuilder().getURI(),function(j){var k=j.payload;c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallActionTypes").P2P_INIT_NUX_STATE,payload:k})},function(){})},markNUXViewed:function i(j){try{c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallActionTypes").P2P_MARK_NUX_VIEWED,nuxID:j})}catch(k){c("dangerouslyBypassDispatchError")(function(){return c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallActionTypes").P2P_MARK_NUX_VIEWED,nuxID:j})})}},dismissNUX:function i(j){c("RTCAppDispatcher").dispatch({type:c("RTCP2PCallActionTypes").P2P_DISMISS_NUX,nuxID:j})}};f.exports=h}),null);
__d("RTCPeerConnectionQueue",[],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(){this.$RTCPeerConnectionQueue1=[];this.$RTCPeerConnectionQueue2=[]}h.prototype.push=function(i,j){switch(i){case"add":this.$RTCPeerConnectionQueue1.push(j);break;case"remove":this.$RTCPeerConnectionQueue2.push(j);break}};h.prototype.drain=function(){this.$RTCPeerConnectionQueue3(this.$RTCPeerConnectionQueue2);this.clear("remove");this.$RTCPeerConnectionQueue3(this.$RTCPeerConnectionQueue1);this.clear("add")};h.prototype.$RTCPeerConnectionQueue3=function(i){__p&&__p();if(i.length<1)return;for(var j=i,k=Array.isArray(j),l=0,j=k?j:j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var m;if(k){if(l>=j.length)break;m=j[l++]}else{l=j.next();if(l.done)break;m=l.value}var n=m;try{n()}catch(o){}}};h.prototype.clear=function(i){switch(i){case"add":this.$RTCPeerConnectionQueue1=[];break;case"remove":this.$RTCPeerConnectionQueue2=[];break;default:this.$RTCPeerConnectionQueue1=[];this.$RTCPeerConnectionQueue2=[]}};f.exports=h}),null);
__d("RTCP2PProtocolHandler",["invariant","Promise","Bootloader","ChannelManager","CollabCallMessengerBrowserEventEnum","ErrorUtils","FBRTCCallControlActions","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCConfig","FBRTCConstants","FBRTCIceCache","FBRTCLocalMessageQueue","FBRTCLogger","FBRTCMessage","FBRTCMessageDedup","FBRTCMessageListener","FBRTCMessageSender","FBRTCPCConfig","FBRTCPeerConnection","FBRTCRetriableMessage","FBRTCSdpUtils","FBRTCTurnDiscovery","FBRTCUrlManager","FBRTCUserSettings","FBRTCUtils","RTCCallActions","RTCCallStore","RTCConferenceState","RTCConfig","RTCEndCallReason","RTCGroupCallEscalationStore","RTCGroupCallEscalator","RTCP2PCallActions","RTCP2PCallEscalationStore","RTCP2PCallEscalator","RTCP2PCallNUXActions","RTCP2PCallStore","RTCP2PCallWindowHandler","RTCP2PConstants","RTCPeerConnectionQueue","RTCSessionDescription","RTCStreamDurationTracker","RTCUserMediaConstraints","RTCUtils","UserAgent","debounce"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=c("RTCP2PConstants").ConnectionStatus,j=c("FBRTCConstants").CallEndReason,k=c("FBRTCConstants").SignalingProtocol,l=c("FBRTCConstants").VideoQuality,m=6e4;function n(){__p&&__p();this.$RTCP2PProtocolHandler5={streams:{}};this.$RTCP2PProtocolHandler6=c("FBRTCLogger").getInstance();this.$RTCP2PProtocolHandler8=false;this.$RTCP2PProtocolHandler9=true;this.$RTCP2PProtocolHandler10=false;this.$RTCP2PProtocolHandler11="passive";this.$RTCP2PProtocolHandler17=new(c("FBRTCIceCache"))();this.$RTCP2PProtocolHandler18=false;this.$RTCP2PProtocolHandler21=0;this.$RTCP2PProtocolHandler22=null;this.$RTCP2PProtocolHandler24=new(c("RTCStreamDurationTracker"))("video");this.$RTCP2PProtocolHandler25=new(c("RTCStreamDurationTracker"))("video");this.$RTCP2PProtocolHandler26=false;this.$RTCP2PProtocolHandler53=function(t){this.$RTCP2PProtocolHandler32(j.WEBRTC_ERROR,false,true,false,t.message);r(t)}.bind(this);this.$RTCP2PProtocolHandler40=function(t){var u=t.candidate;if(u)this.$RTCP2PProtocolHandler54(u)}.bind(this);this.$RTCP2PProtocolHandler41=function(t){__p&&__p();var u=t.target,v=u.iceConnectionState;q("P2P:PC iceconnectionstatechange %o",v);if((this.$RTCP2PProtocolHandler22==="disconnected"||this.$RTCP2PProtocolHandler22==="failed")&&v==="connected")this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").CONNECTION_RECOVERY,this.$RTCP2PProtocolHandler22);this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").ICE_CONNECTION_STATE_CHANGE,v);clearTimeout(this.$RTCP2PProtocolHandler21);switch(v){case"checking":this.$RTCP2PProtocolHandler10=true;break;case"connected":case"completed":this.$RTCP2PProtocolHandler55();this.$RTCP2PProtocolHandler56();break;case"failed":this.$RTCP2PProtocolHandler21=setTimeout(function(){if(c("RTCConfig").CollaborationBrowserConfig.ICE_recovery&&c("FBRTCConfig").isVCEndpointCall()){this.$RTCP2PProtocolHandler57("ICE failure");return}this.$RTCP2PProtocolHandler53(new Error("ICE failed"));c("RTCP2PCallActions").setConnectionStatus(i.DISCONNECTED)}.bind(this),c("RTCConfig").CollaborationBrowserConfig.ICE_failed_timeout);break;case"disconnected":this.$RTCP2PProtocolHandler21=setTimeout(function(){this.$RTCP2PProtocolHandler32(j.CONNECTION_DROPPED,false,true,false)}.bind(this),c("RTCConfig").CollaborationBrowserConfig.ICE_disconnected_timeout);break;case"closed":break}}.bind(this);this.$RTCP2PProtocolHandler61=function(){var t=this.$RTCP2PProtocolHandler4.getCreatedIceCandidates();for(var u=0;u<t.length;u++)this.$RTCP2PProtocolHandler54(t[u])}.bind(this);this.$RTCP2PProtocolHandler42=function(t){var u=t.target,v=u.iceGatheringState;q("P2P:PC icegatheringstatechange %o",v);this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").ICE_GATHERING_STATE_CHANGE,v)}.bind(this);this.$RTCP2PProtocolHandler43=function(t){var u=t.errorCode,v=t.errorText,w=t.hostCandidate,x=t.url;q("P2P:PC icecandidateerror %o: %s %o %o",u,v);this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").ICE_CANDIDATE_ERROR,{errorCode:u,errorText:v,hostCandidate:w,url:x})}.bind(this);this.$RTCP2PProtocolHandler62=function(){var t=void 0;if(this.$RTCP2PProtocolHandler23)t=j.UNSUPPORTED_VERSION;else t=j.OTHER_NOT_CAPABLE;this.$RTCP2PProtocolHandler32(t,false,true,false,"TimedOut")}.bind(this);this.$RTCP2PProtocolHandler46=c("debounce")(function(t){__p&&__p();var u=t.target;if(u.iceConnectionState==="closed"){q("P2P:PC negotiationneeded pc is %o",u.iceConnectionState);return}else if(!this.$RTCP2PProtocolHandler9){this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").RENEGOTIATION,"ignore");q("P2P:PC negotiationneeded %o","ignore");return}else if(!c("RTCP2PCallEscalator").isNegotiationAllowed()){this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").RENEGOTIATION,"not allowed - escalating");q("P2P:PC negotiationneeded %o","not allowed","escalating");return}else if(this.$RTCP2PProtocolHandler8){this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").RENEGOTIATION,"retry");q("P2P:PC SDP lock %o, will retry in a bit","on");setTimeout(function(){return this.$RTCP2PProtocolHandler46(t)}.bind(this),100);return}else q("P2P:PC SDP lock %o","off");this.$RTCP2PProtocolHandler9=false;var v=[];q("P2P:PC negotiationneeded @ signalingState %o",u.signalingState);if(u.signalingState==="stable"){if(this.$RTCP2PProtocolHandler10){var w=c("RTCP2PCallStore").getState(),x=w.signalingExperiments;if(!x.support("sdp_update")){this.$RTCP2PProtocolHandler58();v.push("new offer")}else{var y=x.support("multiple_streams_plan_b");v.push("SDP update",y?"plan B":null)}this.$RTCP2PProtocolHandler11="passive"}this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").RENEGOTIATION,"create offer");this.$RTCP2PProtocolHandler59().then(function(z){if(z.strongDiff(this.$RTCP2PProtocolHandler4.getLocalDescription())){q("P2P SDP difference %o - set offer","strong");this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").RENEGOTIATION,v);return z}q("P2P SDP difference %o - noop","weak");return null}.bind(this)).then(function(z){if(z){if(this.$RTCP2PProtocolHandler10)c("RTCP2PCallActions").setConnectionStatus(i.RECONNECTING);this.$RTCP2PProtocolHandler60(z)}this.$RTCP2PProtocolHandler11="active"}.bind(this))["catch"](this.$RTCP2PProtocolHandler53)}}.bind(this),50);this.$RTCP2PProtocolHandler47=function(t){__p&&__p();if(this.$RTCP2PProtocolHandler26){this.$RTCP2PProtocolHandler27.push("add",function(){return this.$RTCP2PProtocolHandler47(t)}.bind(this));return}var u=t.stream,v=this.$RTCP2PProtocolHandler63(u),w=this.$RTCP2PProtocolHandler1;if(v===c("FBRTCConstants").StreamType.SCREEN_CONTENT){c("RTCCallActions").addRemoteScreenStream(u,w);if(!c("RTCP2PCallStore").getState().signalingExperiments.support("multiple_streams_plan_b")&&u.getAudioTracks().length>0)this.$RTCP2PProtocolHandler25.track(u)}else{c("FBRTCUserSettings").updateForRemoteStream(u);c("RTCCallActions").addRemoteStream(u,w);this.$RTCP2PProtocolHandler25.track(u);this.$RTCP2PProtocolHandler55()}this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").REMOTE_STREAM_ADDED,u);q("P2P:PC remote %o stream %o %o",v,"added",u)}.bind(this);this.$RTCP2PProtocolHandler48=function(t){__p&&__p();if(this.$RTCP2PProtocolHandler26){this.$RTCP2PProtocolHandler27.push("remove",function(){return this.$RTCP2PProtocolHandler48(t)}.bind(this));return}var u=t.stream,v=this.$RTCP2PProtocolHandler63(u),w=this.$RTCP2PProtocolHandler1;if(v===c("FBRTCConstants").StreamType.SCREEN_CONTENT){c("RTCCallActions").removeRemoteScreenStream(u,w);var x=c("RTCCallStore").getState().remoteUsers.first();if(x){var y=x.streams.first();if(y)this.$RTCP2PProtocolHandler25.track(y)}}else c("RTCCallActions").removeRemoteStream(u,w);this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").REMOTE_STREAM_REMOVED,u);q("P2P:PC remote %o stream %o %o",v,"removed",u)}.bind(this);this.$RTCP2PProtocolHandler30=function(t){this.$RTCP2PProtocolHandler6.logInfo(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Received Turn Creds");this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").TURN_CREDENTIALS_RECEIVED,t);c("FBRTCPCConfig").setTurnCredentials(t)}.bind(this);this.$RTCP2PProtocolHandler31=function(){this.$RTCP2PProtocolHandler6.logError(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Failed to get turn creds");this.$RTCP2PProtocolHandler32(j.CLIENT_ERROR,false,!c("RTCP2PCallStore").isCaller(),false,"NoTurnCreds")}.bind(this);this.$RTCP2PProtocolHandler36=function(t,u){this.$RTCP2PProtocolHandler32(t,false,false,false,u)}.bind(this);this.$RTCP2PProtocolHandler35=function(t,u){__p&&__p();var v=u.call_id;if(this.$RTCP2PProtocolHandler72()){this.$RTCP2PProtocolHandler6.logError(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Message sent after call ended: "+u.type);return}if(this.$RTCP2PProtocolHandler1!==t||this.$RTCP2PProtocolHandler2!==v)return;s(function(w){return w.onMessageSent(u)});this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").MESSAGE_SENT,u.msg_id)}.bind(this);this.$RTCP2PProtocolHandler38=function(t){__p&&__p();var u=void 0;try{u=new(c("FBRTCMessage"))(t)}catch(v){this.$RTCP2PProtocolHandler6.logError(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Unknown data: "+JSON.stringify(t));return}this.$RTCP2PProtocolHandler6.logReceivedMessage(u.peerID,u.callID,u.msg);this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").MESSAGE_RECEIVED,u.msgID);if(this.$RTCP2PProtocolHandler72()){this.$RTCP2PProtocolHandler6.logInfo(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Ignoring message (call ended): "+u.msgID);return}if(!c("FBRTCMessageDedup").check(u.peerID,u.callID,u.msgID)){this.$RTCP2PProtocolHandler6.logInfo(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Ignoring message (duplicate): "+u.msgID);return}if(c("RTCCallStore").getState().callInfo.conferenceState===c("RTCConferenceState").AWAITING_USER_START){this.$RTCP2PProtocolHandler6.logInfo(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Ignoring message (awaiting user start): "+u.msgID);return}if(this.$RTCP2PProtocolHandler1&&this.$RTCP2PProtocolHandler1!==u.peerID){if(u.isOffer())this.$RTCP2PProtocolHandler73(u);this.$RTCP2PProtocolHandler6.logInfo(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Ignoring message (different peer): "+u.msgID);return}if(!u.isForCall(this.$RTCP2PProtocolHandler2,this.$RTCP2PProtocolHandler16)){this.$RTCP2PProtocolHandler6.logInfo(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Ignoring message (different call): "+u.msgID+"(callID: "+u.callID+")");return}q("P2P msg.get type:%o callID:%o %o",u.msgType,u.callID,u);if(this.$RTCP2PProtocolHandler2&&this.$RTCP2PProtocolHandler2===u.callID)s(function(x){return x.onFullMessageReceived(u)});c("RTCP2PCallActions").setRemoteSignalingExperiments(u.getSignalingExperiments());q("P2P msg.get %o %o",u.msgType,u);var w=c("RTCGroupCallEscalationStore").getState().inProgress;switch(u.msgType){case c("FBRTCConstants").PayloadType.ICERESTART_OFFER:case c("FBRTCConstants").PayloadType.PCRESTART_OFFER:this.$RTCP2PProtocolHandler58();this.$RTCP2PProtocolHandler74(u);break;case c("FBRTCConstants").PayloadType.OFFER:this.$RTCP2PProtocolHandler74(u);break;case c("FBRTCConstants").PayloadType.ANSWER:case c("FBRTCConstants").PayloadType.ICERESTART_ANSWER:case c("FBRTCConstants").PayloadType.PCRESTART_ANSWER:this.$RTCP2PProtocolHandler75(u);break;case c("FBRTCConstants").PayloadType.SDP_UPDATE:this.$RTCP2PProtocolHandler76(u);break;case c("FBRTCConstants").PayloadType.ICE_CANDIDATE:this.$RTCP2PProtocolHandler77(u);break;case c("FBRTCConstants").PayloadType.HANGUP:this.$RTCP2PProtocolHandler78(u);break;case c("FBRTCConstants").PayloadType.OFFER_ACK:this.$RTCP2PProtocolHandler79(u);break;case c("FBRTCConstants").PayloadType.OFFER_NACK:this.$RTCP2PProtocolHandler23=true;break;case c("FBRTCConstants").PayloadType.ANSWER_ACK:this.$RTCP2PProtocolHandler80();break;case c("FBRTCConstants").PayloadType.MSG_ACK:this.$RTCP2PProtocolHandler81(u);break;case c("FBRTCConstants").PayloadType.SET_VIDEO:if(c("RTCP2PCallStore").getState().isRemoteVideoSupported&&!c("RTCP2PCallStore").isAudioOnly())this.$RTCP2PProtocolHandler70(u.msg);break;case c("FBRTCConstants").PayloadType.SWITCH_TO_MULTIWAY:if(!w)this.handleSwitchToMultiway();else q("P2P Received %o while escalation is in progress %o",u.msgType,u);break;case c("FBRTCConstants").PayloadType.VIDEO_REQUEST:case c("FBRTCConstants").PayloadType.ACK:case c("FBRTCConstants").PayloadType.OK:case c("FBRTCConstants").PayloadType.PING:case c("FBRTCConstants").PayloadType.PING_ACK:case c("FBRTCConstants").PayloadType.OTHER_DISMISS:case c("FBRTCConstants").PayloadType.PRANSWER:break;default:break}this.$RTCP2PProtocolHandler28.parseMessage(u);c("FBRTCCallControlActions").receivedSignalingMessage(u)}.bind(this);this.$RTCP2PProtocolHandler37=function(t){var u=t.message+"; "+t.stackFrames[0].identifier;this.$RTCP2PProtocolHandler6.logError(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"JSError: "+u)}.bind(this);c("ChannelManager").startChannelManager();this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").CALL_CONTROLLER_INIT)}n.prototype.init=function(t,u,v){__p&&__p();this.$RTCP2PProtocolHandler1=t;this.$RTCP2PProtocolHandler2=u;this.$RTCP2PProtocolHandler6.logInfo(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"init call");if(v!=null)this.$RTCP2PProtocolHandler3=v;this.$RTCP2PProtocolHandler7=new(c("FBRTCLocalMessageQueue"))();var w=this.$RTCP2PProtocolHandler7.getOffer(this.$RTCP2PProtocolHandler1);if(w){var x=new(c("FBRTCMessage"))(w);if(x.isFromMobile())c("RTCP2PCallActions").setVideoQuality(l.LQ_VIDEO)}};n.prototype.fetchTURNCredentials=function(){if(c("FBRTCConfig").isVCEndpointCall()&&c("RTCConfig").CollabDisableBrowserTurnDiscoveryGK){this.$RTCP2PProtocolHandler6.logInfo(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Skipping the TURN discovery");return c("Promise").resolve()}this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").CALL_START_TRY,"not ready");return c("FBRTCTurnDiscovery").requestTurnCreds(this.$RTCP2PProtocolHandler2.toString(),this.$RTCP2PProtocolHandler1).then(this.$RTCP2PProtocolHandler30,this.$RTCP2PProtocolHandler31)};n.prototype.endCall=function(){var t=arguments.length<=0||arguments[0]===undefined?j.HANGUP_CALL:arguments[0],u=arguments.length<=1||arguments[1]===undefined?"":arguments[1],v=arguments.length<=2||arguments[2]===undefined?false:arguments[2];c("RTCCallActions").hangup(t,u);this.$RTCP2PProtocolHandler32(t,false,true,v,u)};n.prototype.startCall=function(){__p&&__p();this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").CALL_PROCESS_STARTED);this.$RTCP2PProtocolHandler4=this.$RTCP2PProtocolHandler33();this.$RTCP2PProtocolHandler34();this.$RTCP2PProtocolHandler27=new(c("RTCPeerConnectionQueue"))();var t=this.$RTCP2PProtocolHandler7.getOffer(this.$RTCP2PProtocolHandler1),u=null;if(t){this.$RTCP2PProtocolHandler19=new(c("FBRTCMessage"))(t);c("FBRTCMessageDedup").check(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler19.callID,this.$RTCP2PProtocolHandler19.msgID);u=false}else{u=true;c("RTCP2PCallActions").setIsCaller(u)}this.$RTCP2PProtocolHandler9=u;if(this.$RTCP2PProtocolHandler19 instanceof c("FBRTCMessage"))c("RTCP2PCallActions").processMessage(this.$RTCP2PProtocolHandler19);var v=c("FBRTCCallSummary").restoreOrInitialize(c("FBRTCCallSummaryStore").getInstance(),this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,u,this.$RTCP2PProtocolHandler19&&this.$RTCP2PProtocolHandler19.msg);v.setClientVersion("2.0");v.setIsUsingMultiway(this.$RTCP2PProtocolHandler3);v.setCallType(c("RTCP2PCallEscalationStore").getState().callType);c("RTCCallActions").setCallSummary(v);c("FBRTCUrlManager").init(this.$RTCP2PProtocolHandler1);this.$RTCP2PProtocolHandler12=new(c("FBRTCMessageSender"))();this.$RTCP2PProtocolHandler12.onMessageSent=this.$RTCP2PProtocolHandler35;this.$RTCP2PProtocolHandler12.onSendFailure=this.$RTCP2PProtocolHandler36;this.$RTCP2PProtocolHandler28=new(c("RTCP2PCallEscalator"))(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,this.$RTCP2PProtocolHandler12);c("ErrorUtils").addListener(this.$RTCP2PProtocolHandler37,true);c("FBRTCMessageListener").setMessageHandler(this.$RTCP2PProtocolHandler38,this);this.$RTCP2PProtocolHandler39();c("RTCP2PCallActions").setConnectionStatus(i.CONTACTING);c("RTCCallActions").call([this.$RTCP2PProtocolHandler1],this.$RTCP2PProtocolHandler4)};n.prototype.$RTCP2PProtocolHandler33=function(){__p&&__p();var t=new(c("FBRTCPeerConnection"))(k.P2P,c("FBRTCPCConfig").getConfig(),c("FBRTCPCConfig").getConstraints()),u=void 0,v=void 0,w=void 0,x=void 0;c("RTCCallStore").addListener(c("debounce")(function(){__p&&__p();var y=c("RTCCallStore").getState(),z=y.localUser;if(!z||z===w)return;w=z;var A=z.isVideoMuted();if(x!==A){if(this.$RTCP2PProtocolHandler12&&x!=null)this.$RTCP2PProtocolHandler12.sendMuteStateUpdate(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,!A);x=A}var B=z.streams,C=z.screenStreams;if(B!==u||C!==v){u=B;v=C;this.$RTCP2PProtocolHandler34()}else this.$RTCP2PProtocolHandler24.update()}.bind(this),50));if(c("FBRTCConfig").isVCEndpointCall())t.createDataChannel("noop");t.addEventListener("icecandidate",this.$RTCP2PProtocolHandler40);t.addEventListener("iceconnectionstatechange",this.$RTCP2PProtocolHandler41);t.addEventListener("icegatheringstatechange",this.$RTCP2PProtocolHandler42);t.addEventListener("icecandidateerror",this.$RTCP2PProtocolHandler43);t.addEventListener("connectionstatechange",this.$RTCP2PProtocolHandler44);t.addEventListener("signalingstatechange",this.$RTCP2PProtocolHandler45);t.addEventListener("negotiationneeded",this.$RTCP2PProtocolHandler46);t.addEventListener("addstream",this.$RTCP2PProtocolHandler47);t.addEventListener("removestream",this.$RTCP2PProtocolHandler48);t.addEventListener("datachannel",this.$RTCP2PProtocolHandler49);this.$RTCP2PProtocolHandler50(t);return t};n.prototype.$RTCP2PProtocolHandler34=function(){__p&&__p();if(c("RTCGroupCallEscalationStore").getState().inProgress){q("Group Escalation in progress, ignoring addStream to P2P");return}if(this.$RTCP2PProtocolHandler4.getSignalingState()==="closed")return;var t=c("RTCCallStore").getState(),u=t.localUser;if(!u)return;var v=this.$RTCP2PProtocolHandler4.getLocalStreams(),w=u.streams.first(),x=u.screenStreams.first();if(c("RTCP2PCallStore").getState().signalingExperiments.support("multiple_streams_plan_b")){if(x&&!v.includes(x))this.$RTCP2PProtocolHandler51(x);if(w){if(!v.includes(w))this.$RTCP2PProtocolHandler51(w);this.$RTCP2PProtocolHandler24.track(w)}for(var y=v,z=Array.isArray(y),A=0,y=z?y:y[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var B;if(z){if(A>=y.length)break;B=y[A++]}else{A=y.next();if(A.done)break;B=A.value}var C=B;if(C!==x&&C!==w)this.$RTCP2PProtocolHandler52(C)}}else{var D=x||w;if(x){for(var E=x.getAudioTracks(),F=Array.isArray(E),G=0,E=F?E:E[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var H;if(F){if(G>=E.length)break;H=E[G++]}else{G=E.next();if(G.done)break;H=G.value}var I=H;x.removeTrack(I)}if(w){for(var J=w.getAudioTracks(),K=Array.isArray(J),L=0,J=K?J:J[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var M;if(K){if(L>=J.length)break;M=J[L++]}else{L=J.next();if(L.done)break;M=L.value}var N=M;x.addTrack(N);w.removeTrack(N)}this.$RTCP2PProtocolHandler51(x);this.$RTCP2PProtocolHandler24.track(x)}else this.$RTCP2PProtocolHandler51(x)}else if(w){if(!v.includes(w))this.$RTCP2PProtocolHandler51(w);this.$RTCP2PProtocolHandler24.track(w)}for(var O=v,P=Array.isArray(O),Q=0,O=P?O:O[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var R;if(P){if(Q>=O.length)break;R=O[Q++]}else{Q=O.next();if(Q.done)break;R=Q.value}var S=R;if(S!==D)this.$RTCP2PProtocolHandler52(S)}}};n.prototype.$RTCP2PProtocolHandler51=function(t){this.$RTCP2PProtocolHandler9=true;this.$RTCP2PProtocolHandler4.addStream(t)};n.prototype.$RTCP2PProtocolHandler52=function(t){this.$RTCP2PProtocolHandler9=true;this.$RTCP2PProtocolHandler4.removeStream(t);c("RTCUtils").stopMediaStream(t)};n.prototype.$RTCP2PProtocolHandler57=function(t){__p&&__p();this.$RTCP2PProtocolHandler8=true;this.$RTCP2PProtocolHandler9=false;this.$RTCP2PProtocolHandler11="passive";this.$RTCP2PProtocolHandler58();q("P2P:PC recovering from %o",t);this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").CONNECTION_RECOVERY,t);this.$RTCP2PProtocolHandler59().then(function(u){c("RTCP2PCallActions").setConnectionStatus(i.RECONNECTING);this.$RTCP2PProtocolHandler60(u);this.$RTCP2PProtocolHandler11="active"}.bind(this))["catch"](this.$RTCP2PProtocolHandler53)};n.prototype.$RTCP2PProtocolHandler59=function(){return this.$RTCP2PProtocolHandler4.createOffer({offerToReceiveAudio:true,offerToReceiveVideo:!c("RTCP2PCallStore").isAudioOnly()},{ADD_FB_FEATURES:["video"]})};n.prototype.$RTCP2PProtocolHandler54=function(t){this.$RTCP2PProtocolHandler12.sendIceCandidate(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,t)};n.prototype.$RTCP2PProtocolHandler44=function(t){var u=t.target;q("P2P:PC connectionstatechange %o",u.connectionState)};n.prototype.$RTCP2PProtocolHandler45=function(t){var u=t.target;q("P2P:PC signalingstatechange %o",u.signalingState)};n.prototype.$RTCP2PProtocolHandler58=function(){__p&&__p();this.$RTCP2PProtocolHandler9=false;var t=this.$RTCP2PProtocolHandler1,u=c("RTCCallStore").getState().remoteUsers.first(),v=u.streams,w=u.screenStreams;this.$RTCP2PProtocolHandler26=true;this.$RTCP2PProtocolHandler27.clear("add");this.$RTCP2PProtocolHandler27.push("remove",function(){__p&&__p();for(var x=v,y=Array.isArray(x),z=0,x=y?x:x[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var A;if(y){if(z>=x.length)break;A=x[z++]}else{z=x.next();if(z.done)break;A=z.value}var B=A;c("RTCCallActions").removeRemoteStream(B,t)}for(var C=w,D=Array.isArray(C),E=0,C=D?C:C[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var F;if(D){if(E>=C.length)break;F=C[E++]}else{E=C.next();if(E.done)break;F=E.value}var G=F;c("RTCCallActions").removeRemoteScreenStream(G,t)}});this.$RTCP2PProtocolHandler4.reset().then(function(){this.$RTCP2PProtocolHandler26=false;this.$RTCP2PProtocolHandler27.drain()}.bind(this))["catch"](r);if(c("FBRTCConfig").isVCEndpointCall())this.$RTCP2PProtocolHandler4.createDataChannel("noop")};n.prototype.$RTCP2PProtocolHandler63=function(t){var u=c("FBRTCConstants").StreamType;try{switch(this.$RTCP2PProtocolHandler5.streams[t.id].type){case u.SCREEN_CONTENT:return u.SCREEN_CONTENT;case u.AUDIO_VIDEO:return u.AUDIO_VIDEO;case u.AUDIO_ONLY:return u.AUDIO_ONLY;default:throw Error("no known stream type found, detecting")}}catch(v){return t.getVideoTracks().length>0?u.AUDIO_VIDEO:u.AUDIO_ONLY}};n.prototype.$RTCP2PProtocolHandler55=function(){this.$RTCP2PProtocolHandler24.isStarted()?this.$RTCP2PProtocolHandler24.update():this.$RTCP2PProtocolHandler24.start();this.$RTCP2PProtocolHandler25.isStarted()?this.$RTCP2PProtocolHandler25.update():this.$RTCP2PProtocolHandler25.start()};n.prototype.$RTCP2PProtocolHandler56=function(){c("RTCP2PCallActions").setConnectionStatus(i.CONNECTED);s(function(t){t.onCallConnected();t.onNetworkReady()})};n.prototype.$RTCP2PProtocolHandler49=function(t){var u=t.channel;q("P2P:PC datachannel %o",u)};n.initStream=function(t,u,v){return c("RTCUtils").getUserMedia({audio:c("RTCUserMediaConstraints").audio(u||""),video:t?babelHelpers["extends"]({aspectRatio:{ideal:Number((16/9).toFixed(10))}},p(c("RTCUserMediaConstraints").video(c("RTCP2PCallStore").getState().videoQuality,v||""))):false})};n.replaceLocalStream=function(t){var u=c("RTCCallStore").getState().localUser.streams.first();c("RTCCallActions").replaceLocalStream(u,t)};n.prototype.escalateToMultiway=function(){var t=c("RTCP2PCallStore").getState(),u=t.offerEscalationSupport,v=t.escalationConferenceName;if(u&&v){var w=new(c("RTCGroupCallEscalator"))(v,true,this.$RTCP2PProtocolHandler1);w.startEscalationToMultiway()}};n.prototype.handleSwitchToMultiway=function(){var t=c("RTCP2PCallStore").getState(),u=t.offerEscalationSupport,v=t.escalationConferenceName;this.$RTCP2PProtocolHandler8=false;if(u&&v){var w=new(c("RTCGroupCallEscalator"))(v,true,this.$RTCP2PProtocolHandler1);w.startEscalationToMultiway()}};n.prototype.$RTCP2PProtocolHandler39=function(){__p&&__p();c("FBRTCUrlManager").onCallStarted();q("P2P start call offer %o",this.$RTCP2PProtocolHandler19);if(this.$RTCP2PProtocolHandler19){this.$RTCP2PProtocolHandler8=true;this.$RTCP2PProtocolHandler9=false;var t=this.$RTCP2PProtocolHandler19.msg,u=t.sdp,v=t.attributes,w=t.offer_escalation_support,x=t.escalation_conference_name;c("RTCP2PCallActions").setRemoteSignalingExperiments(this.$RTCP2PProtocolHandler19.getSignalingExperiments());var y=w&&c("RTCConfig").RtcReceiveMultiwayEscalationGK;c("RTCP2PCallActions").setMultiwayEscalationSupport(y,x);this.$RTCP2PProtocolHandler15=y;this.$RTCP2PProtocolHandler16=x;this.$RTCP2PProtocolHandler64(u,"offer",v);this.$RTCP2PProtocolHandler7.removeOffer(this.$RTCP2PProtocolHandler1);this.$RTCP2PProtocolHandler19=null}this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").CALL_START_TRY)};n.prototype.$RTCP2PProtocolHandler60=function(t){__p&&__p();q("P2P SDP %o created %o",t.type,t);this.$RTCP2PProtocolHandler8=true;return this.$RTCP2PProtocolHandler4.setLocalDescription(t).then(function(u){return u.toDesc()}).then(function(u){__p&&__p();var v=u.sdp,w=u.type;q("P2P SDP %o set %o",w,{sdp:v});switch(w){case"offer":if(c("RTCP2PCallStore").getState().signalingExperiments.support("sdp_update")&&c("RTCCallStore").getState().callInfo.conferenceState===c("RTCConferenceState").CONNECTED)this.$RTCP2PProtocolHandler65(v);else this.$RTCP2PProtocolHandler66(v);this.$RTCP2PProtocolHandler18=false;break;case"answer":this.$RTCP2PProtocolHandler67(v);break;default:break}}.bind(this))["catch"](this.$RTCP2PProtocolHandler53)};n.prototype.$RTCP2PProtocolHandler68=function(){return{streams:this.$RTCP2PProtocolHandler69()}};n.prototype.$RTCP2PProtocolHandler69=function(){__p&&__p();var t={},u=c("RTCCallStore").getState(),v=u.localUser.screenStreams;for(var w=this.$RTCP2PProtocolHandler4.getLocalStreams(),x=Array.isArray(w),y=0,w=x?w:w[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var z;if(x){if(y>=w.length)break;z=w[y++]}else{y=w.next();if(y.done)break;z=y.value}var A=z,B=v.includes(A)?c("FBRTCConstants").StreamType.SCREEN_CONTENT:A.getVideoTracks().length?c("FBRTCConstants").StreamType.AUDIO_VIDEO:c("FBRTCConstants").StreamType.AUDIO_ONLY;t[A.id]={type:B}}return t};n.prototype.$RTCP2PProtocolHandler65=function(t){var u=c("RTCCallStore").getState(),v=u.localUser;this.$RTCP2PProtocolHandler12.sendSdpUpdate(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,t,!c("RTCP2PCallStore").isAudioOnly()&&!v.isVideoMuted(),this.$RTCP2PProtocolHandler68())};n.prototype.$RTCP2PProtocolHandler66=function(t){var u=this.$RTCP2PProtocolHandler10?c("FBRTCConstants").PayloadType.PCRESTART_OFFER:c("FBRTCConstants").PayloadType.OFFER;q("P2P offer type %o",u);this.$RTCP2PProtocolHandler13=new(c("FBRTCRetriableMessage"))(this.$RTCP2PProtocolHandler12);this.$RTCP2PProtocolHandler13.addListener("sendingRetry",this.$RTCP2PProtocolHandler61);this.$RTCP2PProtocolHandler13.addListener("timeoutFailure",this.$RTCP2PProtocolHandler62);this.$RTCP2PProtocolHandler13.sendMessage(u,this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,t,!c("RTCP2PCallStore").isAudioOnly(),this.$RTCP2PProtocolHandler68());this.$RTCP2PProtocolHandler20=setTimeout(function(){this.$RTCP2PProtocolHandler32(j.NO_ANSWER_TIMEOUT,false,true,false)}.bind(this),m)};n.prototype.$RTCP2PProtocolHandler70=function(t){__p&&__p();if(!Object.prototype.hasOwnProperty.call(t,"videoon"))return;var u=!t.videoon;c("RTCCallActions").toggleMuteRemoteVideo(u,this.$RTCP2PProtocolHandler1);for(var v=this.$RTCP2PProtocolHandler4.getRemoteStreams(),w=Array.isArray(v),x=0,v=w?v:v[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var y;if(w){if(x>=v.length)break;y=v[x++]}else{x=v.next();if(x.done)break;y=x.value}var z=y;if(z.getAudioTracks().length>0){this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").REMOTE_STREAM_MUTE_TOGGLED,z);return}}this.$RTCP2PProtocolHandler25.update()};n.prototype.$RTCP2PProtocolHandler67=function(t){this.$RTCP2PProtocolHandler14=new(c("FBRTCRetriableMessage"))(this.$RTCP2PProtocolHandler12);this.$RTCP2PProtocolHandler14.addListener("sendingRetry",this.$RTCP2PProtocolHandler61);var u={escalationConferenceName:this.$RTCP2PProtocolHandler16,negotiatedEscalationSupport:this.$RTCP2PProtocolHandler15};this.$RTCP2PProtocolHandler14.sendMessage(c("FBRTCConstants").PayloadType.ANSWER,this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,t,!c("RTCP2PCallStore").isAudioOnly(),this.$RTCP2PProtocolHandler68(),u)};n.prototype.$RTCP2PProtocolHandler71=function(r){this.$RTCP2PProtocolHandler32(j.WEBRTC_ERROR,false,true,false,r.endCallSubreason);this.$RTCP2PProtocolHandler6.logError(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"webrtc error: "+JSON.stringify(r.details));this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").RTC_ERROR,r.details)};n.prototype.$RTCP2PProtocolHandler73=function(t){__p&&__p();var u=t.peerID,v=t.callID,w=t.msg,x=new(c("FBRTCCallSummary"))({peerID:u,callID:v,isCaller:false});x.setClientVersion("2.0");x.setIsUsingMultiway(this.$RTCP2PProtocolHandler3);x.onFullMessageReceived(t);this.$RTCP2PProtocolHandler12.sendOfferAck(u,v,w);x.onOfferAckSent(w);var y=new(c("RTCEndCallReason"))(j.IN_ANOTHER_CALL);this.$RTCP2PProtocolHandler82(u,v,y,false);x.onCallEnded(y.getReasonID(),false);x.save(c("FBRTCCallSummaryStore").getInstance())};n.prototype.$RTCP2PProtocolHandler74=function(t){__p&&__p();q("P2P handle %o","offer");var u=this.$RTCP2PProtocolHandler4.getSignalingState();if(u!=="stable"){q("P2P ignore %o; wrong signaling state: %o","offer",u);return}var v=t.msg;if(v.calltype){this.$RTCP2PProtocolHandler12.sendOfferNack(this.$RTCP2PProtocolHandler1,v.call_id,v);return}this.$RTCP2PProtocolHandler12.sendOfferAck(this.$RTCP2PProtocolHandler1,v.call_id,v);this.$RTCP2PProtocolHandler12.sendOtherDismiss(v.call_id);if(this.$RTCP2PProtocolHandler83(v))this.$RTCP2PProtocolHandler84(t);else this.$RTCP2PProtocolHandler85(t)};n.prototype.$RTCP2PProtocolHandler84=function(t){__p&&__p();var u,v=this,w=t.msg;this.$RTCP2PProtocolHandler70(w);this.$RTCP2PProtocolHandler86();this.$RTCP2PProtocolHandler87();this.$RTCP2PProtocolHandler88();if(this.$RTCP2PProtocolHandler2!==w.call_id)(function(){__p&&__p();var x=new(c("RTCEndCallReason"))(j.OTHER_INSTANCE_HANDLED);v.$RTCP2PProtocolHandler82(v.$RTCP2PProtocolHandler1,v.$RTCP2PProtocolHandler2,x,false);s(function(z){z.onCallEnded(x.getReasonID(),false)});var y=new(c("FBRTCCallSummary"))({peerID:v.$RTCP2PProtocolHandler1,callID:w.call_id,isCaller:false});c("RTCCallActions").setCallSummary(y);s(function(z){z.setClientVersion("2.0");z.setIsUsingMultiway(this.$RTCP2PProtocolHandler3);z.onFullMessageReceived(t);z.onOfferAckSent(w)}.bind(v));v.$RTCP2PProtocolHandler6.logEvent(v.$RTCP2PProtocolHandler1,v.$RTCP2PProtocolHandler2,"Handling offer collision")})();else this.$RTCP2PProtocolHandler6.logEvent(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Handling offer refresh");this.$RTCP2PProtocolHandler18=false;this.$RTCP2PProtocolHandler19=t;c("RTCP2PCallActions").processMessage(t);this.$RTCP2PProtocolHandler39();this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").OFFER_ACCEPTED,t.msgID)};n.prototype.$RTCP2PProtocolHandler85=function(t){q("P2P:PC ignoring offer %o",t);this.$RTCP2PProtocolHandler6.logEvent(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Ignoring offer");this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").OFFER_IGNORED,t.msgID)};n.prototype.$RTCP2PProtocolHandler76=function(t){__p&&__p();var u=t.msg;this.$RTCP2PProtocolHandler70(u);switch(this.$RTCP2PProtocolHandler4.getSignalingState()){case"stable":this.$RTCP2PProtocolHandler64(this.$RTCP2PProtocolHandler89("offer",t),"offer",u.attributes);break;case"have-local-offer":this.$RTCP2PProtocolHandler64(this.$RTCP2PProtocolHandler89("answer",t),"answer",u.attributes).then(function(){return this.$RTCP2PProtocolHandler90()}.bind(this))["catch"](this.$RTCP2PProtocolHandler53);break;case"have-remote-offer":setTimeout(function(){return this.$RTCP2PProtocolHandler76(t)}.bind(this),1e3);break;case"have-local-pranswer":case"have-remote-pranswer":q("P2P SDP update unexpected signalingState %o",this.$RTCP2PProtocolHandler4.getSignalingState());break;case"closed":break}this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").SDP_UPDATE,[u.sdp,u.attributes])};n.prototype.$RTCP2PProtocolHandler89=function(t,u){var v=u.msg,w=c("RTCP2PCallStore").getState(),x=w.isPeerOnMobile,y=c("RTCP2PCallStore").isCaller();if(t==="offer"){if(!x&&y&&c("UserAgent").isBrowser("Firefox"))return c("FBRTCSdpUtils").setDtlsRole(v.sdp,this.$RTCP2PProtocolHandler11);return v.sdp}return c("FBRTCSdpUtils").setDtlsRole(v.sdp,x&&!y?"passive":this.$RTCP2PProtocolHandler11)};n.prototype.$RTCP2PProtocolHandler90=function(){this.$RTCP2PProtocolHandler8=false};n.prototype.$RTCP2PProtocolHandler64=function(t,u,v){__p&&__p();q("P2P SDP %o update %o %o",u,{sdp:t},v);this.$RTCP2PProtocolHandler91(v);return this.$RTCP2PProtocolHandler4.setRemoteDescription(new(c("RTCSessionDescription"))(k.P2P,{type:u,sdp:t})).then(function(){q("P2P drain remote ICE");this.$RTCP2PProtocolHandler18=true;this.$RTCP2PProtocolHandler17.drainCandidates(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,function(w){return this.$RTCP2PProtocolHandler4.onReceivedRemoteIceCandidate(w)}.bind(this))}.bind(this)).then(function(){this.$RTCP2PProtocolHandler56();if(u!=="offer")return null;return this.$RTCP2PProtocolHandler4.createAnswer({ADD_FB_FEATURES:["video"]}).then(function(w){this.$RTCP2PProtocolHandler60(w);this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").SDP_UPDATE,{answer:w.toSdp()})}.bind(this))}.bind(this))["catch"](this.$RTCP2PProtocolHandler53)};n.prototype.$RTCP2PProtocolHandler91=function(t){__p&&__p();var u,v=this;if(t)(function(){var w=t.streams;v.$RTCP2PProtocolHandler5=babelHelpers["extends"]({},v.$RTCP2PProtocolHandler5,t,{streams:babelHelpers["extends"]({},v.$RTCP2PProtocolHandler5.streams,w)});Object.keys(w).some(function(x){if(w[x].type===c("FBRTCConstants").StreamType.SCREEN_CONTENT){c("RTCCallActions").removeAllLocalScreenStreams(true);return true}return false})})()};n.prototype.$RTCP2PProtocolHandler83=function(t){if(t.call_id===this.$RTCP2PProtocolHandler2)return true;return Boolean((this.$RTCP2PProtocolHandler20||!this.$RTCP2PProtocolHandler19)&&(!this.$RTCP2PProtocolHandler2||t.call_id!==this.$RTCP2PProtocolHandler2)&&c("RTCP2PCallStore").isCaller()&&(!t.handlescollision||t.call_id<this.$RTCP2PProtocolHandler2))};n.prototype.$RTCP2PProtocolHandler75=function(t){__p&&__p();q("P2P handle %o","answer");var u=this.$RTCP2PProtocolHandler4.getSignalingState();if(u!=="have-local-offer"){q("P2P ignore %o; wrong signaling state: %o","answer",u);return}var v=t.msg;c("RTCP2PCallActions").setMultiwayEscalationSupport(!!v.negotiated_escalation_support,v.escalation_conference_name);this.$RTCP2PProtocolHandler16=v.escalation_conference_name;this.$RTCP2PProtocolHandler15=!!v.negotiated_escalation_support;this.$RTCP2PProtocolHandler86();this.$RTCP2PProtocolHandler87();this.$RTCP2PProtocolHandler12.sendAnswerAck(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,v);c("RTCP2PCallActions").processMessage(t);c("RTCP2PCallActions").setConnectionStatus(i.CONNECTING);this.$RTCP2PProtocolHandler64(v.sdp,"answer",v.attributes).then(function(){this.$RTCP2PProtocolHandler90();c("RTCCallActions").callSuccess(true)}.bind(this))["catch"](this.$RTCP2PProtocolHandler53);this.$RTCP2PProtocolHandler70(v)};n.prototype.$RTCP2PProtocolHandler81=function(t){__p&&__p();var u=t.msg;if(this.$RTCP2PProtocolHandler13&&this.$RTCP2PProtocolHandler13.isAckMsg(u)){s(function(v){v.onMsgAckReceived(t,true)});this.$RTCP2PProtocolHandler79(t)}else if(this.$RTCP2PProtocolHandler14&&this.$RTCP2PProtocolHandler14.isAckMsg(u)){s(function(v){v.onMsgAckReceived(t,false)});this.$RTCP2PProtocolHandler80()}};n.prototype.$RTCP2PProtocolHandler79=function(t){c("RTCP2PCallActions").setConnectionStatus(i.RINGING);s(function(u){u.setUploadLogLevel(c("FBRTCUtils").getUploadLogLevel(c("FBRTCConstants").convertToUploadLogLevel(t.msg.ull)))});this.$RTCP2PProtocolHandler86()};n.prototype.$RTCP2PProtocolHandler80=function(){this.$RTCP2PProtocolHandler88();this.$RTCP2PProtocolHandler90();c("RTCCallActions").incomingCallSuccess()};n.prototype.$RTCP2PProtocolHandler77=function(t){var u=t.msg;if(u.call_id===this.$RTCP2PProtocolHandler2&&this.$RTCP2PProtocolHandler18)this.$RTCP2PProtocolHandler4.onReceivedRemoteIceCandidate(u)["catch"](function(v){this.$RTCP2PProtocolHandler92(u)}.bind(this));else this.$RTCP2PProtocolHandler92(u)};n.prototype.$RTCP2PProtocolHandler92=function(t){this.$RTCP2PProtocolHandler17.cacheCandidate(this.$RTCP2PProtocolHandler1,t.call_id,t)};n.prototype.$RTCP2PProtocolHandler78=function(t){var u=t.msg,v=u.call_id,w=u.reason,x=u.subreason;if(v===this.$RTCP2PProtocolHandler2)this.$RTCP2PProtocolHandler32(w,true,false,false,x);else{this.$RTCP2PProtocolHandler6.logError(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Receiving hangup for a different call: "+v.toString());this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").HANGUP_CALL_ID_MISSMATCH,v.toString())}};n.prototype.$RTCP2PProtocolHandler32=function(t,u,v,w,x){__p&&__p();var y=new(c("RTCEndCallReason"))(t).setSubreason(x).setRemoteEnded(u);c("RTCP2PCallActions").setEndCallReason(y);c("RTCP2PCallNUXActions").refreshNUXState();this.$RTCP2PProtocolHandler6.logCallAction(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,c("FBRTCLogger").CallAction.END_CALL,y.toStrName());this.$RTCP2PProtocolHandler86();this.$RTCP2PProtocolHandler87();this.$RTCP2PProtocolHandler88();if(this.$RTCP2PProtocolHandler72()){this.$RTCP2PProtocolHandler6.logError(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Ending an already-ended call");return}if(v)this.$RTCP2PProtocolHandler82(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,y,w);this.$RTCP2PProtocolHandler24.stop();this.$RTCP2PProtocolHandler25.stop();this.$RTCP2PProtocolHandler4.close();c("RTCCallActions").hangupSuccess();c("RTCCallActions").removeAllLocalStreams(true);c("RTCCallActions").removeAllLocalScreenStreams(true);c("RTCP2PCallActions").setConnectionStatus(i.DISCONNECTED);s(function(z){z.setCallType(c("RTCP2PCallEscalationStore").getState().callType);z.setVideoDurations(this.$RTCP2PProtocolHandler24.getDuration(),this.$RTCP2PProtocolHandler25.getDuration());z.onCallEnded(y.getReasonID(),u,null,y.getSubreason())}.bind(this));this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").CALL_ENDED,{reason:y.toStrName(),reasonID:y.getReasonID(),subReason:y.getSubreason(),isRemoteEnded:u});if(y.getReasonID()===j.HANGUP_CALL&&y.getSubreason()==="CallReset"&&u)c("RTCP2PCallWindowHandler").close()};n.prototype.shutDownP2PListenersForMultiwayEscalation=function(){this.$RTCP2PProtocolHandler86();this.$RTCP2PProtocolHandler87();this.$RTCP2PProtocolHandler88();this.$RTCP2PProtocolHandler24.stop();this.$RTCP2PProtocolHandler25.stop();this.$RTCP2PProtocolHandler4.removeAllListeners();setTimeout(function(){c("RTCCallActions").completeTransitionToMultiway()},100);this.destroy()};n.prototype.$RTCP2PProtocolHandler82=function(t,u,v,w){this.$RTCP2PProtocolHandler12.sendHangup(t,u,v.getReasonID(),w,v.getSubreason());this.$RTCP2PProtocolHandler12.sendOtherDismiss(u)};n.prototype.$RTCP2PProtocolHandler86=function(){if(this.$RTCP2PProtocolHandler13)this.$RTCP2PProtocolHandler13.stopRetrying()};n.prototype.$RTCP2PProtocolHandler88=function(){if(this.$RTCP2PProtocolHandler14)this.$RTCP2PProtocolHandler14.stopRetrying()};n.prototype.$RTCP2PProtocolHandler87=function(){if(this.$RTCP2PProtocolHandler20)clearTimeout(this.$RTCP2PProtocolHandler20);this.$RTCP2PProtocolHandler20=null};n.prototype.$RTCP2PProtocolHandler72=function(){return c("RTCCallStore").getState().callInfo.conferenceState===c("RTCConferenceState").TERMINATED};n.prototype.$RTCP2PProtocolHandler50=function(t){__p&&__p();o(function(u){__p&&__p();var v=u.logConnectionStats(function(){var A=t.getSignalingState();return A!=="closed"?t.getStats():c("Promise").reject("peer connection closed")},this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2),w=v.start,x=v.stop,y=function(A){var B=A.target,C=B.iceConnectionState;if(C==="completed"||C==="connected"){q("P2P collab stats %o","start");this.$RTCP2PProtocolHandler6.logInfo(this.$RTCP2PProtocolHandler1,this.$RTCP2PProtocolHandler2,"Call Connected");this.$RTCP2PProtocolHandler29(c("CollabCallMessengerBrowserEventEnum").CALL_CONNECTED);w();t.removeEventListener("iceconnectionstatechange",y);t.addEventListener("iceconnectionstatechange",z)}}.bind(this),z=function z(A){var B=A.target,C=B.iceConnectionState;if(C==="closed"){q("P2P collab stats %o","stop");x();t.removeEventListener("iceconnectionstatechange",z)}};t.addEventListener("iceconnectionstatechange",y)}.bind(this))};n.prototype.$RTCP2PProtocolHandler29=function(event,t){o(function(u){return u.log(event,{peerID:this.$RTCP2PProtocolHandler1,callID:this.$RTCP2PProtocolHandler2,eventDetails:t})}.bind(this))};n.prototype.destroy=function(){q("P2P %o","destroy()");this.$RTCP2PProtocolHandler27.clear();c("FBRTCMessageListener").removeMessageHandler();this.$RTCP2PProtocolHandler12.onMessageSent=null;this.$RTCP2PProtocolHandler12.onSendFailure=null};n.prototype.generateEscalationRequestToken=function(){return this.$RTCP2PProtocolHandler28.generateRequestToken()};n.prototype.generateEscalationResponseToken=function(t,u){return this.$RTCP2PProtocolHandler28.generateResponseToken(t,u)};function o(t){if(!c("FBRTCConfig").isVCEndpointCall())return;c("Bootloader").loadModules(["CollabMessengerLogger"],t,"RTCP2PProtocolHandler")}function p(t){t instanceof Object||h(0);return t}function q(){}function r(){}function s(t){var u=c("RTCCallStore").getState(),v=u.callSummary;t(v);v.save(c("FBRTCCallSummaryStore").getInstance())}f.exports=n}),null);
__d("FBRTCGroupCallIncomingController",["FBRTCConstants","FBRTCCallBlockingStore","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCCallUIWrapper","FBRTCCapability","FBRTCDeviceStatus","FBRTCHangupReason","FBRTCMultiwayMessage","FBRTCRingType","FBRTCRtcResponseStatusCode","FBRTCSupport","FBRTCTransactions","MessengerRTCGroupCallUnsupportedBrowserDialogController","RTCConfig","RTCMWProtocolHandler","RTCUtils"],(function a(b,c,d,e,f,g){__p&&__p();var h,i,j=c("FBRTCConstants").CallEndReason,k=c("FBRTCTransactions").FBRTCTransactionOwner;h=babelHelpers.inherits(l,k);i=h&&h.prototype;function l(m){"use strict";i.constructor.call(this);this.$FBRTCGroupCallIncomingController1=m;this.$FBRTCGroupCallIncomingController2=null}l.prototype.onMessageReceived=function(m){"use strict";__p&&__p();var n=new(c("FBRTCMultiwayMessage"))(m),o=this.getTransaction(n);o.start().then(function(p){__p&&__p();if(p!=null)if(p.ringRequest()!=null){if(c("RTCUtils").isMessengerCall(p.conferenceName())&&!c("RTCConfig").RtcWwwMessengerPrefix||!c("RTCUtils").isGroupCall(p.conferenceName())&&!c("RTCConfig").RTCConferencingP2PCanReceiveGK)return;var q=c("RTCUtils").generateRandomInt(),r=new(c("FBRTCCallSummary"))({peerID:c("RTCUtils").isGroupCall(p.conferenceName())||c("RTCUtils").isMessengerCall(p.conferenceName())?-1:c("RTCUtils").getPeerID(p.conferenceName()),callID:q,isCaller:false});if(c("FBRTCCallBlockingStore").getBlockingStatus()){r.onCallEnded(j.IGNORE_CALL,false,false,"calling disabled");r.save(c("FBRTCCallSummaryStore").getInstance());return}if(!c("FBRTCSupport").isGroupCallWebtrcSupported()){r.onCallEnded(j.UNSUPPORTED_VERSION,false);r.save(c("FBRTCCallSummaryStore").getInstance());var s=p.ringRequest(),t=s.ringType;c("MessengerRTCGroupCallUnsupportedBrowserDialogController").render({hasVideo:c("RTCConfig").RtcConferencingVideoGK&&(t===c("FBRTCRingType").GROUP_VIDEO_CALL||t===c("FBRTCRingType").PEER_VIDEO_CALL)});return}o.sendResponse(this.handleRingRequest(p,q,r))}else if(p.dismissRequest()!=null)o.sendResponse(this.handleDismissRequest(p))}.bind(this),function(p){}).done()};l.prototype.cancelIncomingCallDialog=function(){"use strict";if(this.$FBRTCGroupCallIncomingController2){this.$FBRTCGroupCallIncomingController2.cancel();this.$FBRTCGroupCallIncomingController2=null}};l.prototype.handleDismissRequest=function(m){"use strict";c("MessengerRTCGroupCallUnsupportedBrowserDialogController").unmount();if(this.$FBRTCGroupCallIncomingController2){var n=this.$FBRTCGroupCallIncomingController2.serverInfoData();if(n==m.serverInfoData())this.cancelIncomingCallDialog()}return m.createResponse(c("FBRTCRtcResponseStatusCode").OK,{})};l.prototype.handleRingRequest=function(m,n,o){"use strict";__p&&__p();var p=m.ringRequest(),q=m.serverInfoData();if(p==null||q==null)return m.createResponse(c("FBRTCRtcResponseStatusCode").BAD_REQUEST);var r=p.caller,s=p.otherParticipants,t=c("RTCConfig").RtcConferencingVideoGK&&(p.ringType==c("FBRTCRingType").GROUP_VIDEO_CALL||p.ringType==c("FBRTCRingType").PEER_VIDEO_CALL),u=new this.$FBRTCGroupCallIncomingController1(m.conferenceName(),n,r,s,t,q);u.addListener("answerCall",function(w,x){c("FBRTCCallUIWrapper").openGroupCallURI(w,n,t,q,"answer button",o)});u.addListener("ignoreCall",function(){c("RTCMWProtocolHandler").endCall(m.conferenceName(),q,c("FBRTCHangupReason").IGNORE_CALL);o.onCallEnded(j.IGNORE_CALL,false);o.save(c("FBRTCCallSummaryStore").getInstance());this.cancelIncomingCallDialog()}.bind(this));u.addListener("timeout",function(){c("RTCMWProtocolHandler").endCall(m.conferenceName(),q,c("FBRTCHangupReason").NO_ANSWER_TIMEOUT);o.onCallEnded(j.NO_ANSWER_TIMEOUT,false);o.save(c("FBRTCCallSummaryStore").getInstance());this.cancelIncomingCallDialog()}.bind(this));this.$FBRTCGroupCallIncomingController2=u;u.showIncomingDialog();var v={deviceCapabilities:[c("FBRTCCapability").SUPPORT_AUDIO_DEPRECATED,c("FBRTCCapability").SUPPORT_VIDEO_DEPRECATED],deviceStatus:c("FBRTCDeviceStatus").OK};return m.createResponse(c("FBRTCRtcResponseStatusCode").OK,{ringResponse:v})};f.exports=l}),null);