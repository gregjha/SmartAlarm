if (self.CavalryLogger) { CavalryLogger.start_js(["eJV0h"]); }

__d("MercuryThreadlistContainer.react",["Bootloader","immutable","MercuryAPIArgsSource","MercuryConfig","MercuryFilters","MercuryIDs","MercuryThreadlistConstants","MessagingTag","P2PJewelBannerContainer.react","QE2Logger","React","SubscriptionsHandler","gkx","MessengerStateStore","MessengerMessageRequestsTypedLogger"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=c("React").PropTypes,k="search",l="www_messenger_jewel_perf_h2_2017",m=3;h=babelHelpers.inherits(n,c("React").Component);i=h&&h.prototype;function n(){__p&&__p();var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=i.constructor).call.apply(o,[this].concat(r)),this.state={aggregatedThreads:null,showAggregation:false,isLoading:true,isSearching:false,unreadMessageRequestThreads:[],threads:c("immutable").Map()},this.threadListReqsInFlight=0,this.$MercuryThreadlistContainer18=function(){this.$MercuryThreadlistContainer1.getFilteredThreadlist(c("MercuryThreadlistConstants").RECENT_THREAD_OFFSET,c("MercuryThreadlistConstants").MAX_UNREAD_COUNT,c("MessagingTag").PENDING,c("MercuryFilters").UNREAD,this.$MercuryThreadlistContainer20,true,this.props.source)}.bind(this),this.$MercuryThreadlistContainer13=function(){if(this.props.folder!=="aggregation"&&!this.state.isSearching&&!this.state.isLoading&&!this.$MercuryThreadlistContainer1.hasLoadedThreadlist(this.props.folder,this.props.filter))this.$MercuryThreadlistContainer8(this.props.folder,this.props.filter,this.$MercuryThreadlistContainer9(this.props.folder)+c("MercuryThreadlistConstants").JEWEL_MORE_COUNT+1)}.bind(this),this.$MercuryThreadlistContainer20=function(){if(!this.$MercuryThreadlistContainer1||!this.$MercuryThreadlistContainer2)return;var t=this.$MercuryThreadlistContainer1.getAvailableThreadlistNow(c("MessagingTag").PENDING,c("MercuryFilters").UNREAD);this.$MercuryThreadlistContainer2.getMultiThreadMeta(t,function(u){this.setState({unreadMessageRequestThreads:t.map(function(v){return u[v]})})}.bind(this))}.bind(this),this.$MercuryThreadlistContainer15=function(t,u){this.setState({isLoading:u,searchThreads:[]},function(){return this.$MercuryThreadlistContainer7(k,c("MercuryFilters").ALL,t)}.bind(this))}.bind(this),this.$MercuryThreadlistContainer14=function(t){this.setState({isSearching:!!t})}.bind(this),this.$MercuryThreadlistContainer16=function(t,u){this.setState({showAggregation:true,aggregatedThreads:u});var v=c("MercuryIDs").getParticipantIDFromUserID(this.props.viewer),w=[],x=u.map(function(y){w.push(c("MercuryIDs").getThreadKeyfromThreadIDUserID(y.thread_id,c("MercuryIDs").tokenize(v).value));return y.thread_id});this.props.onAggregationClick&&this.props.onAggregationClick(t,x);new(c("MessengerMessageRequestsTypedLogger"))().setAction("aggregation_entrypoint_tap").setEntryPoint("inbox_aggregation").setSurface("inbox").setFolderType("pending").setThreadKeyList(w.filter(function(y){return y}).join(", ")).log()}.bind(this),p}n.prototype.componentWillMount=function(){this.setState({showAggregation:c("MessengerStateStore").getState()&&c("MessengerStateStore").getState().threadIDs!==null})};n.prototype.componentDidMount=function(){__p&&__p();c("QE2Logger").logExposureForUser(l);c("Bootloader").loadModules(["MercuryOrderedThreadlist","MercuryThreadInformer","MercuryThreads"],function(o,p,q){__p&&__p();if(this.props.resetAggregatedThreads)this.setState({showAggregation:false,aggregatedThreads:null});this.$MercuryThreadlistContainer1=o.getForFBID(this.props.viewer);this.$MercuryThreadlistContainer2=q.getForFBID(this.props.viewer);this.$MercuryThreadlistContainer3=function(){__p&&__p();var r=this.$MercuryThreadlistContainer1.getAvailableThreadlistNow(c("MessagingTag").INBOX,this.props.filter);if(r.length===0)return r;var s=this.$MercuryThreadlistContainer2.getThreadMetaNow(r[r.length-1]);if(!s)return r;var t=s.timestamp,u=this.$MercuryThreadlistContainer1.getThreadlistUntilTimestamp(t,c("MessagingTag").PENDING,this.props.filter);u.sort(function(w,x){var y=this.$MercuryThreadlistContainer2.getThreadMetaNow(w),z=this.$MercuryThreadlistContainer2.getThreadMetaNow(x);return(z&&z.timestamp)-(y&&y.timestamp)}.bind(this));var v=c("MercuryConfig").MCMA?this.$MercuryThreadlistContainer4(u):u;return r.concat(v).sort(function(w,x){var y=typeof w==="string"?this.$MercuryThreadlistContainer2.getThreadMetaNow(w):this.$MercuryThreadlistContainer2.getThreadMetaNow(w[0]),z=typeof x==="string"?this.$MercuryThreadlistContainer2.getThreadMetaNow(x):this.$MercuryThreadlistContainer2.getThreadMetaNow(x[0]);return(z&&z.timestamp)-(y&&y.timestamp)}.bind(this))}.bind(this);this.$MercuryThreadlistContainer5=p.getForFBID(this.props.viewer);this.$MercuryThreadlistContainer6=new(c("SubscriptionsHandler"))();this.$MercuryThreadlistContainer6.addSubscriptions(this.$MercuryThreadlistContainer5.subscribe("threadlist-updated",function(r,s){this.$MercuryThreadlistContainer7(this.props.folder,this.props.filter);if(c("MercuryConfig").MessengerInboxRequests){this.props.folder===c("MessagingTag").INBOX&&this.$MercuryThreadlistContainer7(c("MessagingTag").PENDING,this.props.filter);this.props.folder===c("MessagingTag").PENDING&&this.$MercuryThreadlistContainer7(c("MessagingTag").INBOX,this.props.filter)}}.bind(this)));if(c("MercuryConfig").MessengerInboxRequests)this.$MercuryThreadlistContainer8(c("MessagingTag").PENDING,this.props.filter,this.$MercuryThreadlistContainer9(c("MessagingTag").PENDING)+c("MercuryThreadlistConstants").CONNECTION_REQUEST);this.$MercuryThreadlistContainer10(this.props.folder,this.props.filter)}.bind(this),"MercuryThreadlistContainer.react")};n.prototype.componentWillReceiveProps=function(o){if(o.resetAggregatedThreads!==this.props.resetAggregatedThreads||o.folder!==this.props.folder||o.filter!==this.props.filter||o.folder===c("MessagingTag").INBOX&&this.state.showAggregation==true)this.$MercuryThreadlistContainer10(o.folder,o.filter)};n.prototype.componentDidUpdate=function(){if(this.props.resetAggregatedThreads&&this.state.showAggregation)this.setState({showAggregation:false,aggregatedThreads:null})};n.prototype.componentWillUnmount=function(){this.$MercuryThreadlistContainer11();this.$MercuryThreadlistContainer12();this.$MercuryThreadlistContainer6&&this.$MercuryThreadlistContainer6.release()};n.prototype.render=function(){var o=this.props,p=o.ChildClass,q=o.folder,r=o.filter,s=babelHelpers.objectWithoutProperties(o,["ChildClass","folder","filter"]),t=this.state.isSearching?this.state.threads.get(k)||[]:this.state.threads.get(q)||[];return c("React").createElement(p,babelHelpers["extends"]({},s,{filter:this.props.filter,folder:q,isLoaded:q==="aggregation"||!!this.$MercuryThreadlistContainer1&&this.$MercuryThreadlistContainer1.hasLoadedThreadlist(q,r),isLoading:this.state.isLoading,isSearching:this.state.isSearching,newMessageRequestThreads:this.state.unreadMessageRequestThreads,onRenderThreads:this.props.onRenderThreads,onMessageRequestsClick:this.props.onMessageRequestsClick,showAggregation:this.state.showAggregation,threads:this.state.aggregatedThreads||t,onLoadMoreRequest:this.$MercuryThreadlistContainer13,onQuery:this.$MercuryThreadlistContainer14,onSearchResults:this.$MercuryThreadlistContainer15,onAggregationClick:this.$MercuryThreadlistContainer16,p2pJewelBannerContainer:this.$MercuryThreadlistContainer17(),maxInitialThreadCount:this.props.threadCount}))};n.prototype.$MercuryThreadlistContainer4=function(o){__p&&__p();var p=c("MercuryConfig").Unit||3,q=(c("MercuryConfig").Duration||3)*1e3*60*60*24,r=o.map(function(z){return this.$MercuryThreadlistContainer2.getThreadMetaNow(z).timestamp}.bind(this)),s=[];for(var t=0;t<r.length;t++){var u=r[t],v=r[t+p-1];if(v&&u-v<q){var w=[o[t]];for(var x=t+1;x<r.length;x++){var y=r[x];if(y&&u-y<q){w.push(o[x]);t++}else break}s.push(w)}else s.push(o[t])}return s};n.prototype.$MercuryThreadlistContainer17=function(){return c("React").createElement(c("P2PJewelBannerContainer.react"),null)};n.prototype.$MercuryThreadlistContainer10=function(o,p){__p&&__p();if(o==="aggregation")return;var q=c("MessengerStateStore").getState()&&c("MessengerStateStore").getState().threadIDs||this.props.threadIDs;if(!q)this.setState({showAggregation:false,aggregatedThreads:null});if(!c("MercuryConfig").MessengerInboxRequests&&o===c("MessagingTag").INBOX&&(c("gkx")("AT6h5--3KUdxbat1rL4n2mVcPcg9eZ8bwokXjpPZS-_sSShoFlPyHXdioNqIwODAz2vH7270MK0r4x8XFkaYt6-h")||this.props.source!==c("MercuryAPIArgsSource").JEWEL))this.$MercuryThreadlistContainer18();if(!this.$MercuryThreadlistContainer19(o,p))this.$MercuryThreadlistContainer8(o,p,this.props.threadCount||c("MercuryThreadlistConstants").JEWEL_THREAD_COUNT+m);else if(this.state.isLoading)this.setState({isLoading:false},function(){this.$MercuryThreadlistContainer7(o,p)}.bind(this));else this.$MercuryThreadlistContainer7(o,p)};n.prototype.$MercuryThreadlistContainer8=function(o,p,q){__p&&__p();if(!this.$MercuryThreadlistContainer1)return;this.$MercuryThreadlistContainer12();this.threadListReqsInFlight++;this.setState({isLoading:true},function(){this.props.onDataFetchStart&&this.props.onDataFetchStart();var r=this.$MercuryThreadlistContainer1.getFilteredThreadlist(c("MercuryThreadlistConstants").RECENT_THREAD_OFFSET,q,o,p||c("MercuryFilters").ALL,function(s){this.threadListReqsInFlight--;if(this.threadListReqsInFlight===0){this.props.onDataFetchEnd&&this.props.onDataFetchEnd();this.setState({isLoading:false})}}.bind(this),true,this.props.source);this.$MercuryThreadlistContainer21={subscriberID:r,folder:o,filter:p}}.bind(this))};n.prototype.$MercuryThreadlistContainer7=function(o,p,q){__p&&__p();if(!this.$MercuryThreadlistContainer1||!this.$MercuryThreadlistContainer2)return;this.$MercuryThreadlistContainer11();var r=void 0;if(c("MercuryConfig").MessengerInboxRequests&&o===c("MessagingTag").INBOX)r=this.$MercuryThreadlistContainer3();else if(o==="aggregation"||this.state.showAggregation){r=c("MessengerStateStore").getState()&&c("MessengerStateStore").getState().threadIDs||this.props.threadIDs;this.$MercuryThreadlistContainer22(r)}else r=q||this.$MercuryThreadlistContainer1.getAvailableThreadlistNow(o,p);var s=[].concat.apply([],r);this.$MercuryThreadlistContainer23=this.$MercuryThreadlistContainer2.getMultiThreadMeta(s,function(q){this.setState({threads:this.state.threads.set(o,this.$MercuryThreadlistContainer24(r,q))})}.bind(this))};n.prototype.$MercuryThreadlistContainer22=function(o){__p&&__p();var p=this.$MercuryThreadlistContainer1.getAvailableThreadlistNow(c("MessagingTag").PENDING,this.props.filter);if(o&&o.length>0){var q=o.filter(function(r){return p.indexOf(r)!==-1});this.$MercuryThreadlistContainer2.getMultiThreadMeta(q,function(r){if(!Array.isArray(r))r=Object.values(r);this.setState({aggregatedThreads:r})}.bind(this))}else this.setState({aggregatedThreads:null})};n.prototype.$MercuryThreadlistContainer24=function(o,p){return o.map(function(q){if(Array.isArray(q))return q.map(function(r){return p[r]});else return p[q]})};n.prototype.$MercuryThreadlistContainer19=function(o,p){var q=this.props.threadCount||c("MercuryThreadlistConstants").JEWEL_THREAD_COUNT+m;return!!(this.$MercuryThreadlistContainer1&&(this.$MercuryThreadlistContainer1.getThreadCount(o,p)>=q||this.$MercuryThreadlistContainer1.hasLoadedThreadlist(o,p)))};n.prototype.$MercuryThreadlistContainer9=function(o){var p=this.state.threads.get(o);return p?p.length:0};n.prototype.$MercuryThreadlistContainer11=function(){this.$MercuryThreadlistContainer2&&this.$MercuryThreadlistContainer23&&this.$MercuryThreadlistContainer2.unsubscribe(this.$MercuryThreadlistContainer23)};n.prototype.$MercuryThreadlistContainer12=function(){this.$MercuryThreadlistContainer1&&this.$MercuryThreadlistContainer21&&this.$MercuryThreadlistContainer1.unsubscribe(this.$MercuryThreadlistContainer21.subscriberID,this.$MercuryThreadlistContainer21.folder,this.$MercuryThreadlistContainer21.filter)};n.propTypes={ChildClass:j.func.isRequired,filter:j.string.isRequired,folder:j.string.isRequired,onMessageRequestsClick:j.func,onRenderThreads:j.func,onDataFetchStart:j.func,onDataFetchEnd:j.func,onAggregationClick:j.func,showCount:j.bool,showPresence:j.bool,source:j.string,threadCount:j.number,threadIDs:j.array,viewer:j.string.isRequired,onRenderBackArrow:j.func,resetAggregatedThreads:j.bool};n.defaultProps={source:c("MercuryAPIArgsSource").JEWEL};f.exports=n}),null);