if (self.CavalryLogger) { CavalryLogger.start_js(["HejXk"]); }

__d("MessengerConversation.react",["csx","cx","fbt","Bootloader","BootloadOnRender.react","ChatTypingIndicators.react","CSS","DOM","DOMDimensions","Event","EventProfiler","FluxContainer","immutable","ImmutableObject","JSReliabilityFixesGatingConfig","JSResource","KeyEventController","LazyComponent.react","MercuryActionType","MercuryIDs","MercuryDeliveryReceiptsRe","mercuryRogerRe","MercuryShareAttachmentRenderLocations","MessageList.react","MessengerAttachmentRenderer","messengerButtonReact","MessengerCollapsedLogMessageGroup.react","MessengerContextBannerContainer.react","MessengerConfig","MessengerDateBreak.react","MessengerFlexScrollableArea.react","MessengerBootloadedLogMessage.react","MessengerMessageGroup.react","messengerNewMessagesNoticeReact","MessengerPlatformSubscriptionMessageClassification","MessengerQuickCamButtonHTML5.react","MessengerQuickCamOrigins","MessengerSpinner.react","MessengerTypingIndicator.react","MessengerVideoAutoplayActions","MessengerVideoAutoplayStore","MessengerViewerContactMethodsWebGraphQLQuery","MNOmniMConstants","OmniMStore","Parent","React","ReactDOM","Set","SubscriptionsHandler","UserActivity","WebGraphQL","WebMessengerConstants","convertMIGColorToFIGColor","getPageIDFromThreadID","gkx","idx","ifRequired","joinClasses","setImmediate","throttle"],(function a(b,c,d,e,f,g,h,i,j){"use strict";__p&&__p();var k,l,m=c("MercuryDeliveryReceiptsRe").get(),n=c("mercuryRogerRe").get(),o=c("messengerButtonReact").jsComponent,p=c("messengerNewMessagesNoticeReact").jsComponent,q=c("immutable").OrderedMap,r=c("React").PropTypes,s=20,t=100,u=1e3;function v(event,z){return!!(c("KeyEventController").filterEventTypes(event,z)&&c("KeyEventController").filterEventModifiers(event,z)&&event.target instanceof Element&&c("Parent").bySelector(event.target,"._4_j4"))}k=babelHelpers.inherits(w,c("React").PureComponent);l=k&&k.prototype;function w(){__p&&__p();var z,A;for(var B=arguments.length,C=Array(B),D=0;D<B;D++)C[D]=arguments[D];return A=(z=l.constructor).call.apply(z,[this].concat(C)),this.state={readReceipts:x(this.props),deliveryTimestamp:0,scrollingToUnreadMessage:false,showUnreadNotice:false,unreadCount:this.props.thread?this.props.thread.unread_count:0,width:0,suggestions:null,omniMPrefs:null,viewerEmail:null,viewerPhone:null},this.$MessengerConversation1=null,this.$MessengerConversation2=0,this.$MessengerConversation3=0,this.$MessengerConversation4=null,this.$MessengerConversation6=[],this.$MessengerConversation16=function(){__p&&__p();var E=this.$MessengerConversation18();if(!this.refs||!E||this.props.isLoading){this.$MessengerConversation6=[];return}var F=c("getPageIDFromThreadID")(this.props.threadID),G=this.refs.messageList;if(!G||!F){this.$MessengerConversation6=[];return}var H=10,I=E.getElement().getBoundingClientRect(),J=[];this.$MessengerConversation5.forEach(function(K){__p&&__p();var L=K.message_id,M=this.refs.messageList.getMessageElement(L);if(M){var N=M.getBoundingClientRect();if(N.top>I.top-H&&N.bottom<I.bottom+H){J.push(L);if(!this.$MessengerConversation6.includes(L))c("Bootloader").loadModules(["MessengerAdsWebLogger","MNAdsLoggerEventEnum"],function(O,P){O.log(K.ad_client_token,K.ad_id,P.MESSAGE_SEEN_THREAD,true,L,F)},"MessengerConversation.react")}}}.bind(this),this);this.$MessengerConversation6=J}.bind(this),this.$MessengerConversation9=function(){var E=this.$MessengerConversation18();E&&E.pageUp();return false}.bind(this),this.$MessengerConversation10=function(){var E=this.$MessengerConversation18();E&&E.pageDown();return false}.bind(this),this.$MessengerConversation11=function(E){if(E.target===document.body){this.scrollToTop();return false}return null}.bind(this),this.$MessengerConversation12=function(E){if(E.target===document.body){this.scrollToBottom();return false}return null}.bind(this),this.$MessengerConversation15=function(){__p&&__p();if(c("JSReliabilityFixesGatingConfig").should_get_fix&&!this.refs)return;if(!this.refs.scrollable)return;var E=this.$MessengerConversation18(),F=this.refs.quickReply;F&&c("CSS").conditionClass(F,"_1mzg",!this.isScrolledToBottom());this.$MessengerConversation13();this.$MessengerConversation14();if(E&&this.state.unreadCount&&this.$MessengerConversation23(E))this.setState({showUnreadNotice:false,unreadCount:0});this.$MessengerConversation31(E);this.$MessengerConversation32(E);this.$MessengerConversation8()}.bind(this),this.$MessengerConversation30=function(E){E.preventDefault();this.setState({showUnreadNotice:false});this.$MessengerConversation20()}.bind(this),this.$MessengerConversation14=function(){__p&&__p();if(!this.isScrolledToBottom()||this.props.messages.size===0)return;if(c("UserActivity").isOnTab()&&c("UserActivity").isActive())this.props.onRead(this.props.threadID);else if(!this.$MessengerConversation4)this.$MessengerConversation4=c("UserActivity").subscribe(function(){if(c("UserActivity").isOnTab()){this.$MessengerConversation17();this.props.onRead(this.props.threadID)}}.bind(this))}.bind(this),this.handleResize=function(){__p&&__p();if(c("JSReliabilityFixesGatingConfig").should_get_fix&&!this.refs)return;if(this.refs.scrollable){this.refs.scrollable.handleResize();var E=c("DOMDimensions").getElementDimensions(c("ReactDOM").findDOMNode(this.refs.scrollable)).width;if(E!==this.state.width)this.setState({width:E})}var F=this.refs.quickReply;F&&c("CSS").conditionClass(F,"_1mzg",!this.isScrolledToBottom());this.trackBottomIfRequired()}.bind(this),A}w.getStores=function(){return[c("OmniMStore")]};w.calculateState=function(z,A){if(!c("MercuryIDs").isValid(A.threadID))return babelHelpers["extends"]({},z);return{suggestions:c("OmniMStore").suggestionsForThread(A.threadID),omniMPrefs:c("OmniMStore").prefs()}};w.prototype.componentDidMount=function(){__p&&__p();var z=new(c("SubscriptionsHandler"))();z.addSubscriptions(c("Event").listen(window,"resize",c("throttle")(this.handleResize,50)),c("KeyEventController").registerKey("PAGE_UP",this.$MessengerConversation9,v),c("KeyEventController").registerKey("PAGE_DOWN",this.$MessengerConversation10,v),c("KeyEventController").registerKey("HOME",this.$MessengerConversation11,v),c("KeyEventController").registerKey("END",this.$MessengerConversation12,v),n.subscribe("change",function(A,B){B[this.props.threadID]&&this.setState({readReceipts:x(this.props)})}.bind(this)),m.subscribe("change",function(A,B){this.setState({deliveryTimestamp:this.props.threadID?m.getDeliveryTime(this.props.threadID):0})}.bind(this)));this.$MessengerConversation1=z;this.$MessengerConversation13();this.handleResize();this.$MessengerConversation14();this.$MessengerConversation7=c("throttle")(this.$MessengerConversation15,t);this.$MessengerConversation8=c("throttle")(this.$MessengerConversation16,u);this.$MessengerConversation5=this.props.messages.filter(function(A){return A.is_sponsored});this.$MessengerConversation8()};w.prototype.componentWillReceiveProps=function(z){__p&&__p();var A=z.threadID!==this.props.threadID;if(A){this.$MessengerConversation17();this.setState({scrollingToUnreadMessage:false,showUnreadNotice:false,unreadCount:z.thread?z.thread.unread_count:0})}if(A||z.messages!==this.props.messages){this.$MessengerConversation5=z.messages.filter(function(B){return B.is_sponsored});this.setState({readReceipts:x(z),deliveryTimestamp:z.threadID?m.getDeliveryTime(z.threadID):0})}};w.prototype.componentWillUnmount=function(){this.$MessengerConversation17();this.$MessengerConversation1&&this.$MessengerConversation1.release()};w.prototype.componentWillUpdate=function(){var z=this.$MessengerConversation18();if(z){this.$MessengerConversation2=z.getScrollHeight();this.$MessengerConversation3=z.getScrollTop()}};w.prototype.componentDidUpdate=function(z){__p&&__p();if(c("JSReliabilityFixesGatingConfig").should_get_fix&&!this.refs)return;if(!this.refs.scrollable)return;var A=this.props.threadID!==z.threadID;if(A||y(z,this.props)){this.scrollToBottom();this.$MessengerConversation19()}else{var B=this.$MessengerConversation18();if(B){var C=B.getScrollHeight();if(C!==this.$MessengerConversation2){var D=B.getScrollHeight()-this.$MessengerConversation2+this.$MessengerConversation3;this.refs.scrollable.scrollToPosition(D)}else this.$MessengerConversation19()}}if(this.props.messages!==z.messages){this.$MessengerConversation14();if(this.state.scrollingToUnreadMessage)this.$MessengerConversation20();this.$MessengerConversation21()}this.$MessengerConversation22();setTimeout(function(){var G=this.$MessengerConversation18();this.trackBottomIfRequired();if(G&&this.state.unreadCount&&!this.state.scrollingToUnreadMessage&&!this.props.isLoading)if(this.$MessengerConversation23(G))this.setState({showUnreadNotice:false,unreadCount:0});else this.setState({showUnreadNotice:true});this.$MessengerConversation13();this.$MessengerConversation8()}.bind(this),0);var E=z.messages&&z.messages.size||0,F=this.props.messages&&this.props.messages.size||0;if(A||E===0&&(F>0||!this.props.isLoading))c("EventProfiler").informManualInteractionTimestamp(["MessengerThredRow"],true,"click")};w.prototype.render=function(){__p&&__p();if(this.props.isLoading&&this.props.messages.isEmpty())return this.$MessengerConversation24();var z=this.props.messages.last(),A=c("MercuryIDs").getParticipantIDFromUserID(this.props.viewer),B=null,C=null,D=this.state.suggestions||{},E=D.quickReplies,F=D.agentSuggestions;if(!E||!E.length)E=this.$MessengerConversation25(z);if(E&&E.length&&z&&z.author!==A){B=E;C=c("MNOmniMConstants").QUICKREPLIES}else if(F&&F.length&&c("gkx")("AT4E-H2IF55T_cfJfVFc0DIJ5Zc0x6Ksd6rrKuinf7B4BwJUeLW2H-a3HWX5xDBokJhpUd0lJcH9_F8HOyg9KFc8")){B=F;C=c("MNOmniMConstants").OMNIM}var G=z&&B&&B.length&&!B.every(function(P){return P.content_type==="user_email"&&this.state.viewerEmail===null||P.content_type==="user_phone_number"&&this.state.viewerPhone===null}.bind(this))&&B.filter(function(P){return!P.dismissed}).length?c("React").createElement(c("BootloadOnRender.react"),{component:c("React").createElement(c("LazyComponent.react"),{options:B,threadID:z.thread_id,onVoiceClipCreate:this.props.onVoiceClipCreate,source:C,viewer:this.props.viewer,quickCamOriginLocation:c("MessengerQuickCamOrigins").MESSENGER,omniMPrefs:this.state.omniMPrefs,messageId:z.message_id,pageId:c("MercuryIDs").getUserIDFromParticipantID(z.author),isSponsored:z.is_sponsored,viewerEmail:this.state.viewerEmail,viewerPhone:this.state.viewerPhone}),loader:c("JSResource")("MessengerBotsQuickReplyButtonList.react").__setRef("MessengerConversation.react"),placeholder:c("React").createElement("div",null)}):null,H=null;if(z&&z.message_source&&z.author!==A&&c("gkx")("AT7Fdvvof3gB21NGh8Fo7o5af68El03cTnUDtqQrI_yHQbziWN3MyQvvj6iMavHBZ0fTg3S3rpHTM9337zgjjUnM")){var I=z.message_source;if(I==="camera"){var J=this.props.thread?c("convertMIGColorToFIGColor")(this.props.thread.custom_color):null,K=c("React").createElement("div",{className:"_1gc5",style:J&&{color:J}},j._("Send a photo reply"));H=c("React").createElement("div",{className:"_1gc6"},c("React").createElement(c("MessengerQuickCamButtonHTML5.react"),{className:"_4rv5 _1gcb",location:c("MessengerQuickCamOrigins").MESSENGER,threadID:this.props.threadID,viewer:this.props.viewer,textChild:K}))}}var L=null,M=null;if(H||G){L=c("React").createElement("div",{className:"_51op"},c("React").createElement("div",{className:"_51oq",onResize:this.handleResize}));M=c("React").createElement("div",{ref:"quickReply"},c("React").createElement("div",{className:"_1mzb",onResize:this.handleResize},H,G))}var N=j._("Messages"),O=j._("Load more...");return c("React").createElement(c("MessengerFlexScrollableArea.react"),{className:this.props.className,flexChildren:this.$MessengerConversation26(),footerChildren:M,onMount:function(){return c("setImmediate")(this.$MessengerConversation14)}.bind(this),onScroll:this.props.useManualFetch?undefined:this.$MessengerConversation7,ref:"scrollable",shouldStickToBottom:true,tabIndex:0,useScrollProtection:!c("gkx")("AT7X8zD-9DNn0OeQ0S5-rozrySawyX8ZP8Z_NFsQBL8WAUNZhO-HKIM8cWBdfNilWyfk5H-Q_oFDDxJhsL4ycAkk")&&c("MessengerConfig").ChatScrollInterval},c("React").createElement("div",{"aria-label":N,className:c("joinClasses")("__i_",this.props.innerClassName),role:"region"},c("React").createElement("h3",{className:"accessible_elem"},N),this.$MessengerConversation27(),this.props.useManualFetch&&!this.props.upExhausted?c("React").createElement(o,{className:"_41jf",label:O,onClick:function(){return this.props.fetchMessages(c("WebMessengerConstants").MORE_SEARCH_CONTEXT_UP)}.bind(this),type:"primary",use:"default"}):null,this.$MessengerConversation28(),c("React").createElement(c("MessageList.react"),{DateBreak:c("MessengerDateBreak.react"),deliveryTimestamp:this.state.deliveryTimestamp,isCanonical:this.props.isCanonical,LogMessage:c("MessengerBootloadedLogMessage.react"),CollapsedLogMessageGroup:c("MessengerCollapsedLogMessageGroup.react"),MessageGroup:c("MessengerMessageGroup.react"),messages:this.props.messages,onAttachmentLoad:this.$MessengerConversation29(this.props.threadID),readReceipts:this.state.readReceipts,ref:"messageList",location:c("MercuryShareAttachmentRenderLocations").MESSENGER,viewer:this.props.viewer,thread:this.props.thread}),this.props.useManualFetch&&!this.props.downExhausted?c("React").createElement(o,{className:"_41jf",label:O,onClick:function(){return this.props.fetchMessages(c("WebMessengerConstants").MORE_SEARCH_CONTEXT_DOWN)}.bind(this),type:"primary",use:"default"}):null,c("React").createElement(c("ChatTypingIndicators.react"),{indicatorClass:c("MessengerTypingIndicator.react"),indicatorsDidShow:function(){this.trackBottomIfRequired()}.bind(this),rootClassName:"clearfix _17pz",threadID:this.props.threadID,viewer:this.props.viewer}),L))};w.prototype.$MessengerConversation25=function(z){var A=null,B=z&&z.platform_xmd&&JSON.parse(z.platform_xmd),C=B&&B.message_classification===c("MessengerPlatformSubscriptionMessageClassification").AD_MESSAGE;if(C)A=B&&B.quick_replies;return A};w.prototype.$MessengerConversation13=function(){if(this.props.useManualFetch)return;var z=this.$MessengerConversation18();if(z&&z.getScrollTop()<s){this.props.fetchMessages(c("WebMessengerConstants").MORE_SEARCH_CONTEXT_UP);this.$MessengerConversation21()}};w.prototype.$MessengerConversation22=function(){__p&&__p();var z=this.state.suggestions||{},A=z.quickReplies;if(!A||A.length===0)return;var B=c("gkx")("AT6b68OqbLsWJQlJTGZqwlCTZJ0z0taRGUXqOzuQVRDoLPO2Dnjh-maTANaNF_FUgpVzi4qt9-S_T7GMqZpzzd99"),C=c("gkx")("AT70ApPO8u4r9N24CdWkIiFYZMdcnAaeV9BaXzLxdBmkmVf60X7teW8bfJTrYYnPlB7TPT4_aBOsOQDbCdO-mpJj4JY2rmmLkTH2jaDU2xAiSg");if(A.some(function(D){return D.content_type==="user_email"&&B||D.content_type==="user_phone_number"&&C}))c("WebGraphQL").exec(new(c("MessengerViewerContactMethodsWebGraphQLQuery"))({})).done(function(D){var E,F,G,H,I=C?(E=D)!=null?(E=E.viewer)!=null?(E=E.user)!=null?E.all_phones:E:E:E:null,J=B?(F=D)!=null?(F=F.viewer)!=null?F.all_emails:F:F:null,K=!I?null:I.find(function(M){return M.is_preferred});if(!K&&I)K=I[0];var L=!J?null:J.find(function(M){return M.is_primary});this.setState({viewerEmail:(G=L)!=null?(G=G.email_address)!=null?G.deduplicated_email_address:G:G,viewerPhone:(H=K)!=null?(H=H.phone_number)!=null?H.universal_number:H:H})}.bind(this))};w.prototype.isScrolledToBottom=function(){return!!(this.refs.scrollable&&this.refs.scrollable.isScrolledToBottom())};w.prototype.isScrolledToBottomWithHeight=function(z){return!!(this.refs.scrollable&&this.refs.scrollable.isScrolledToBottomWithHeight(z))};w.prototype.$MessengerConversation26=function(){return c("React").createElement(p,{isOpen:this.state.showUnreadNotice,label:j._({"*":"{number} unread messages","_1":"1 unread message"},[j.plural(this.state.unreadCount,"number")]),onClick:this.$MessengerConversation30})};w.prototype.$MessengerConversation27=function(){if(!this.props.isLoaded)return null;return c("React").createElement(c("MessengerContextBannerContainer.react"),{location:c("MercuryShareAttachmentRenderLocations").MESSENGER,threadID:this.props.threadID,viewer:this.props.viewer})};w.prototype.$MessengerConversation28=function(){if(this.props.isLoaded)return null;return c("React").createElement("div",{className:"_2k8v"},this.props.isLoading?c("React").createElement(c("MessengerSpinner.react"),null):null)};w.prototype.$MessengerConversation24=function(){return c("React").createElement("div",{className:"_4xu0"},c("React").createElement(c("MessengerSpinner.react"),{className:"_4xu1",size:c("MessengerSpinner.react").large_size}))};w.prototype.trackBottomIfRequired=function(){if(c("JSReliabilityFixesGatingConfig").should_get_fix&&!this.refs)return;this.refs.scrollable&&this.refs.scrollable.trackBottomIfRequired()};w.prototype.scrollToBottom=function(){if(c("JSReliabilityFixesGatingConfig").should_get_fix&&!this.refs)return;this.refs.scrollable&&this.refs.scrollable.scrollToBottom()};w.prototype.scrollToTop=function(z){if(c("JSReliabilityFixesGatingConfig").should_get_fix&&!this.refs)return;this.refs.scrollable&&this.refs.scrollable.scrollToTop(z)};w.prototype.$MessengerConversation29=function(z){return function(){if(this.props.threadID!==z)return;this.trackBottomIfRequired()}.bind(this)};w.prototype.$MessengerConversation19=function(){c("DOM").scry(c("ReactDOM").findDOMNode(this),"img").forEach(function(z){if(z.complete)return;var A=this.props.threadID,B=c("Event").listen(z,"load",function(){if(this.props.threadID===A)this.trackBottomIfRequired();B.remove()}.bind(this))}.bind(this))};w.prototype.$MessengerConversation33=function(){var z=this.props.messages,A=this.state.unreadCount;if(!A||A>z.size)return null;return z.get(z.size-A)};w.prototype.$MessengerConversation23=function(z){__p&&__p();var A=this.$MessengerConversation33();if(!A)return false;var B=this.refs.messageList.getMessageElement(A.message_id);if(!B)return false;var C=B.getBoundingClientRect().top,D=z.getElement().getBoundingClientRect().top;if(C-D<0)return false;return true};w.prototype.$MessengerConversation34=function(z){return!!this.props.messages.find(function(A){return A.message_id===z})};w.prototype.$MessengerConversation20=function(){__p&&__p();if(!this.state.unreadCount)return;this.setState({scrollingToUnreadMessage:true});var z=this.$MessengerConversation33();if(!z){this.scrollToTop(false);return}this.$MessengerConversation35(z.message_id,function(){this.setState({scrollingToUnreadMessage:false,unreadCount:0})}.bind(this))};w.prototype.$MessengerConversation35=function(z,A){var B=this.refs.messageList.getMessageElement(z,true),C=this.$MessengerConversation18();if(!B||!C)return;var D=B.getBoundingClientRect().top,E=c("ReactDOM").findDOMNode(this.refs.messageList).getBoundingClientRect().top,F=C.getElement().getBoundingClientRect().top,G=D+Math.abs(E)+F;C.setScrollTop(G,true,{callback:A})};w.prototype.$MessengerConversation18=function(){if(c("JSReliabilityFixesGatingConfig").should_get_fix&&!this.refs)return;return this.refs.scrollable&&this.refs.scrollable.getArea()};w.prototype.$MessengerConversation17=function(){this.$MessengerConversation4&&this.$MessengerConversation4.unsubscribe();this.$MessengerConversation4=null};w.prototype.$MessengerConversation36=function(){return this.props.messages.filter(function(z){return c("MessengerAttachmentRenderer").isSingleVideoAttachment(z)||c("MessengerAttachmentRenderer").isSharedVideoAttachmentMessage(z)}).reverse().map(function(z){return z.message_id})};w.prototype.$MessengerConversation31=function(z){__p&&__p();var A=this.refs.messageList;if(!A||!z)return;var B=[],C=z.getElement().getBoundingClientRect(),D=c("MessengerVideoAutoplayStore").getMessageIDs(this.props.threadID),E=D||this.$MessengerConversation36()||c("immutable").List();E.map(function(F){var G=c("MessengerAttachmentRenderer").getVideoElem(F,A);if(G)B.push([F,G.getBoundingClientRect()])});if(B.length)c("MessengerVideoAutoplayActions").onScroll(this.props.threadID,D?null:E,c("immutable").Map(B),C)};w.prototype.$MessengerConversation37=function(){return this.props.messages.filter(function(z){return c("MessengerAttachmentRenderer").isSingleSphericalPhotoAttachment(z)}).map(function(z){return z.message_id})};w.prototype.$MessengerConversation32=function(z){__p&&__p();c("ifRequired")("MessengerSphericalRendererActions",function(A){__p&&__p();c("ifRequired")("MessengerSphericalRendererStore",function(B){__p&&__p();var C=this.refs.messageList;if(!C||!z)return;var D=[],E=z.getElement().getBoundingClientRect(),F=B.getMessageIDs(this.props.threadID),G=F||this.$MessengerConversation37()||c("immutable").List();G.map(function(H){var I=c("MessengerAttachmentRenderer").getSphericalPhotoElem(H,C);if(I)D.push([H,I.getBoundingClientRect()])});if(D.length)A.onScroll(this.props.threadID,G,c("immutable").Map(D),E)}.bind(this),function(){})}.bind(this),function(){})};w.prototype.$MessengerConversation21=function(){c("MessengerVideoAutoplayActions").updateStore(this.props.threadID,this.$MessengerConversation36());var z=this.$MessengerConversation37();if(z&&z.count()!==0)c("ifRequired")("MessengerSphericalRendererActions",function(A){A.updateStore(this.props.threadID,z)}.bind(this),function(){c("Bootloader").loadModules(["MessengerSphericalRendererActions","MessengerSphericalRendererStore"],function(A,B){A.updateStore(this.props.threadID,z)}.bind(this),"MessengerConversation.react")}.bind(this))};w.propTypes={contact:r.instanceOf(c("ImmutableObject")),downExhausted:r.bool,fetchMessages:r.func.isRequired,innerClassName:r.string,isCanonical:r.bool,isLoaded:r.bool,isLoading:r.bool,messages:r.instanceOf(c("immutable").List).isRequired,onVoiceClipCreate:r.func,participants:r.instanceOf(c("immutable").Map),thread:r.object,threadID:r.string.isRequired,upExhausted:r.bool,useManualFetch:r.bool,viewer:r.string.isRequired};function x(z){__p&&__p();var A=c("MercuryIDs").getParticipantIDFromUserID(z.viewer),B=n.getSeenTimestamps(z.threadID),C=new(c("Set"))(z.thread?z.thread.participants:B.keys());C["delete"](A);var D=null;c("immutable").Seq(z.messages).reverse().forEach(function(E){if(E.action_type!==c("MercuryActionType").LOG_MESSAGE){D=E;return false}return true});return B.withMutations(function(B){__p&&__p();c("immutable").Seq(z.messages).reverse().forEach(function(E){__p&&__p();if(C.size===0)return false;if(!C.has(E.author))return;B.update(E.author,function(F){var G=F;if(!F||F.watermark<=E.timestamp)G={watermark:E.timestamp,action:E.timestamp};if(D&&D.timestamp<G.watermark)G={watermark:D.timestamp,action:D.timestamp};return G});C["delete"](E.author)})})}function y(z,A){var B=c("MercuryIDs").getParticipantIDFromUserID(A.viewer);return A.threadID===z.threadID&&A.messages!==z.messages&&!A.messages.isEmpty()&&A.messages.last()!==z.messages.last()&&A.messages.last().author===B}f.exports=c("FluxContainer").create(w,{withProps:true})}),null);