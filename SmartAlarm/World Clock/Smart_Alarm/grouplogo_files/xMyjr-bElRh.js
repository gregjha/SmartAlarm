if (self.CavalryLogger) { CavalryLogger.start_js(["8dEhl"]); }

__d("MessengerAttachmentRenderer",["cx","EmojiSticker.react","MercuryAttachment","MercuryAttachmentType","MercuryAudioType","MercuryIDs","MercuryShareAttachment.react","MercuryShareAttachmentRenderLocations","MessagingFlowerBorder.react","MessagingFlowerBorderChecker","MessagingGiftWrap.react","MessagingGiftWrapChecker","MessengerErrorAttachment.react","MessengerFileAttachment.react","MessengerFromViewerUtils","MessengerHotLikePreview.react","MessengerHotLikeUtils","MessengerPhotosGroup.react","MessengerStickerUtils","MessengerSupportedEmojiUtils","MessengerVoiceClipAttachment.react","MessengerWebDriverTestIDs","React","Sticker.react","StickerAssetType","StickerConstants","StickerInterfaces","StickerUtils","StickersActions","StickersPackInTray","StickersStoreController","StoryAttachmentStyle","XStickerAssetController","idx","isRetina","wrapNullableForReact"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=700,j="sticker:",k="giftwrap:",l="share:",m="_1c_u",n="_3o6m",o=function o(q){return q===Object(q)},p={getAttachmentsInsideBubble:function q(r,s){var t=c("MercuryAttachment").get(r).filter(o).filter(function(u){return!this.attachmentShouldAppearOutsideBubble(u)}.bind(this));return this._getAttachmentComponents(t,r,s)},getAttachmentsOutsideBubble:function q(r,s,t,u){var v=c("MercuryAttachment").get(r).filter(o).filter(function(w){return this.attachmentShouldAppearOutsideBubble(w)}.bind(this));return this._getAttachmentComponents(v,r,s,t,u)},_getAttachmentComponents:function q(r,s,t,u,v){var w=this._getPhotosGroup(r.filter(c("MercuryAttachment").isPhotoGroupAttachment),s,t,u),x=r.filter(function(y){return!c("MercuryAttachment").isPhotoGroupAttachment(y)}).map(function(y){return this._getAttachmentComponent(y,s,t,u,v)}.bind(this));if(w)x.push(w);return x},_getAttachmentComponent:function q(r,s,t,u,v){__p&&__p();var w=u&&u.customColor,x=u&&u.onUnwrap,y=u&&u.isVisible,z=u&&u.isFromViewer,A=u&&u.onSelect;if(c("MessengerStickerUtils").isStickerAttachment(r))return this._getStickerComponent(r,s,w,x);if(this.isEmojiLikeAttachment(r))return this._getEmojiLikeAttachment(r,s,x);if(this.isVoiceClip(r))return this._getVoiceClip(r,s,w,x);if(this.isFileAttchment(r))return this._getFileComponent(r,s);if(this.isP2P(r)||this.isShareAttachment(r))return this._getShareAttachment(r,s,t,y,z,A,v);if(this.isErrorAttachment(r))return this._getErrorAttachment(r,s);return null},_getStickerComponent:function q(r,s,t,u){__p&&__p();if(s.is_like_preview)return this._maybeGiftWrapSticker(c("React").createElement(c("MessengerHotLikePreview.react"),{customColor:t,customLike:s.customLike,key:"hlp:"+s.like_preview_since,since:s.like_preview_since}),s,u);var v=r.metadata;if(!v){v=c("MessengerHotLikeUtils").getMetadataForHotLike(s.sticker_id);if(!v){v={};var w=c("StickerUtils").getScaledDimensions(c("StickerConstants").THREAD_SIZE,c("StickerConstants").THREAD_SIZE,c("StickerConstants").THREAD_SIZE),x=w.height,y=w.width;v.height=x;v.width=y}v.stickerID=s.sticker_id}var z=c("XStickerAssetController").getURIBuilder().setInt("sticker_id",v.stickerID),A=null,B=null;if(c("isRetina")()){A=v.paddedSpriteURI2x;B=v.spriteURI2x}else{A=v.paddedSpriteURI;B=v.spriteURI}var C=v.stickerID.toString(),D=c("React").createElement(c("Sticker.react"),{accessibilityLabel:v.accessibilityLabel,className:"_2poz _ui9"+(c("MessagingGiftWrapChecker").shouldRenderWithGiftWrap(s)&&!!c("MessengerHotLikeUtils").getMetadataForHotLike(C)?" _4ue_":""),animationTrigger:"hover",customColor:t,frameCount:v.frameCount||1,frameRate:v.frameRate||c("StickerConstants").DEFAULT_FRAME_RATE,framesPerCol:v.framesPerCol||1,framesPerRow:v.framesPerRow||1,key:j+s.message_id,onStickerClick:function E(F,C){c("StickersPackInTray").onIsPackInTray(F,c("StickerInterfaces").MESSAGES,function(G){if(G.in_sticker_tray){c("StickersActions").selectTrayPack(F);c("StickersActions").showStickerFlyout(s.thread_id)}else c("StickersStoreController").showStore(F)})},packID:v.packID&&v.packID.toString(),paddedSpriteURI:A,sourceHeight:v.height,sourceURI:z.setEnum("image_type",c("StickerAssetType").IMAGE).getURI().toString(),sourceWidth:v.width,spriteURI:B,stickerID:C,testID:c("MessengerWebDriverTestIDs").STICKER});return this._maybeGiftWrapSticker(D,s,u)},_getEmojiLikeAttachment:function q(r,s,t){var u=c("MessengerSupportedEmojiUtils").transferSize(r.size),v=c("MessengerSupportedEmojiUtils").getNewEmojiData(s.body,u),w=v?v.emoji:undefined;if(!v)return this._getErrorAttachment(r,s);var x=c("React").createElement(c("EmojiSticker.react"),{className:"_2poz _ui9",key:j+s.message_id,emoji:s.body,emojiImage:w,sourceURI:""});return this._maybeGiftWrapSticker(x,s,t)},_getShareAttachment:function q(r,s,t,u,v,w,x){var y,z,A=null;if(s&&s.platform_xmd)A=JSON.parse(s.platform_xmd);var B=(y=r)!=null?(y=y.share)!=null?(y=y.messenger_ctas)!=null?(y=y[0])!=null?y.page_id:y:y:y:y,C=(z=r)!=null?(z=z.share)!=null?(z=z.target)!=null?(z=z.items)!=null?(z=z[0])!=null?(z=z.call_to_actions)!=null?(z=z[0])!=null?z.page_id:z:z:z:z:z:z:z,D=B||C,E=D?c("MercuryIDs").getParticipantIDFromUserID(D):s.author;return c("React").createElement(c("MercuryShareAttachment.react"),{attachment:r.share,isFromViewer:v,isSponsored:s.is_sponsored,isVisible:!!u,key:l+s.message_id,location:c("MercuryShareAttachmentRenderLocations").MESSENGER,maxWidth:i,messageID:s.message_id,mnMessageType:A&&A.template_type,onComponentLoaded:t,onSelect:w,pageID:E,threadID:s.thread_id,afterDecorators:x})},_getVoiceClip:function q(r,s,t,u){t=c("MessengerFromViewerUtils").isFromViewer(s)?t||undefined:undefined;return c("React").createElement(c("MessengerVoiceClipAttachment.react"),{attachment:r,customColor:t,isGiftWrapped:c("MessagingGiftWrapChecker").shouldRenderWithGiftWrap(s),hasFlowerBorder:c("MessagingFlowerBorderChecker").shouldRenderWithFlowerBorder(s),key:"audio:"+s.message_id,message:s,onUnwrap:function(v){function u(){return v.apply(this,arguments)}u.toString=function(){return v.toString()};return u}(function(){u&&u()})})},_getErrorAttachment:function q(r,s){return c("React").createElement(c("MessengerErrorAttachment.react"),{attachment:r,key:"error:"+s.message_id})},_getPhotosGroup:function q(r,s,t,u){__p&&__p();if(!r.length)return null;var v=u&&u.onUnwrap,w=u&&u.isVisible,x=u&&u.onSelect,y=u&&u.isPageMessage,z=u&&u.pageID,A=c("MessagingFlowerBorderChecker").shouldRenderWithFlowerBorder(s),B=c("MessagingGiftWrapChecker").shouldRenderWithGiftWrap(s)&&this._rendersWithoutAttribution(r);return c("React").createElement(c("MessengerPhotosGroup.react"),{attachments:r,className:"_2poz _52mr _ui9",count:r.length,hasFlowerBorder:A,isGiftWrapped:B,isPageMessage:y,isVisible:!!w,key:"photos:"+s.message_id,message:s,onSelect:x,onUnwrap:function(C){function v(){return C.apply(this,arguments)}v.toString=function(){return C.toString()};return v}(function(){v&&v()}),pageID:z})},getVideoElem:function q(r,s){var t=s.getMessageElement(r);if(!t)return null;var u=t.getElementsByClassName(m);return u&&u.length?u[0]:t},getSphericalPhotoElem:function q(r,s){var t=s.getMessageElement(r);if(!t)return null;var u=t.getElementsByClassName(n);return u&&u.length?u[0]:t},_rendersWithoutAttribution:function q(r){return r.length!=1||!c("MercuryAttachment").hasAttribution(r[0])},_getFileComponent:function q(r,s){return c("React").createElement(c("MessengerFileAttachment.react"),{attachment:r,className:"_2poz",key:"file:"+r.url})},attachmentShouldAppearOutsideBubble:function q(r){return c("MessengerStickerUtils").isStickerAttachment(r)||c("MercuryAttachment").isPhotoGroupAttachment(r)||this.isShareAttachment(r)||this.isP2P(r)||this.isVoiceClip(r)||this.isErrorAttachment(r)||this.isEmojiLikeAttachment(r)},isPhotosGroupAttachment:function q(r){var s=r.props.attachments;return!!s&&s.length>1&&s.some(function(t){return!!t&&c("MercuryAttachment").isPhotoGroupAttachment(t)})},isRenderedShareAttachment:function q(r){return!!(r.key&&r.key.startsWith(l))},isFileAttchment:function q(r){return r.attach_type===c("MercuryAttachmentType").FILE},isShareAttachment:function q(r){return!!(this._isStoryBased(r)&&!this.isP2P(r)&&(r.share.style_list.indexOf(c("StoryAttachmentStyle").SHARE)>-1||r.share.style_list.indexOf(c("StoryAttachmentStyle").FALLBACK)>-1))},isSharedVideoAttachment:function q(r){var s=r.attach_type===c("MercuryAttachmentType").SHARE&&r.share&&r.share.subattachments&&r.share.subattachments[0];return!!(s&&s.target&&s.target.video_id)},isP2P:function q(r){return!!(this._isStoryBased(r)&&r.share.style_list.indexOf(c("StoryAttachmentStyle").ORION)>-1)},_isStoryBased:function q(r){return!!(r.attach_type===c("MercuryAttachmentType").SHARE&&r.share&&r.share.style_list)},isEmojiLikeAttachment:function q(r){return r.attach_type===c("MercuryAttachmentType").EMOJI_LIKE},isVoiceClip:function q(r){var s=r.metadata;return!!s&&(!!s.isAudio||s.type===c("MercuryAudioType").AudioClip||s.type===c("MercuryAudioType").VoiceMessageWithTranscript)},isVoiceClipAttachment:function q(r){var s=c("MercuryAttachment").get(r).filter(o).filter(function(t){return this.isVoiceClip(t)}.bind(this));return!!s.length},isP2PAttachment:function q(r){var s=c("MercuryAttachment").get(r).filter(function(t){return o(t)&&this.isP2P(t)}.bind(this));return!!s.length},isSingleVideoAttachment:function q(r){var s=c("MercuryAttachment").get(r).filter(o).filter(function(t){return c("MercuryAttachment").isVideoAttachment(t)});return s.length===1},isSharedVideoAttachmentMessage:function q(r){var s=c("MercuryAttachment").get(r).filter(o).filter(function(t){return this.isSharedVideoAttachment(t)||this.isGenieSharedVideoAttachment(t)}.bind(this));return s.length===1},isGenieSharedVideoAttachment:function q(r){return!!(r.attach_type===c("MercuryAttachmentType").SHARE&&r.share&&r.share.style_list.indexOf(c("StoryAttachmentStyle").GENIE_MESSAGE)>-1&&r.share.target&&r.share.target.attachment&&this.isSharedVideoAttachment(r.share.target.attachment))},isSingleSphericalPhotoAttachment:function q(r){var s=c("MercuryAttachment").get(r).filter(o);if(s.length!==1)return false;var t=s.filter(function(u){return u.photo_encodings&&u.photo_encodings.length!==0}).length===1;return t},isErrorAttachment:function q(r){return r.attach_type===c("MercuryAttachmentType").ERROR},_maybeGiftWrapComponentForMessage:function q(r,s,t){var u=c("MessagingGiftWrapChecker").shouldRenderWithGiftWrap(s),v=c("MessagingFlowerBorderChecker").shouldRenderWithFlowerBorder(s);if(!u&&!v)return r;return c("React").createElement("div",{key:k+s.message_id},r,u?c("React").createElement(c("MessagingGiftWrap.react"),{onUnwrap:c("wrapNullableForReact")(t)}):null,v?c("React").createElement(c("MessagingFlowerBorder.react"),{offset:-10}):null)},_maybeGiftWrapSticker:function q(r,s,t){var u=c("MessagingGiftWrapChecker").shouldRenderWithGiftWrap(s),v=c("MessagingFlowerBorderChecker").shouldRenderWithFlowerBorder(s);if(!u&&!v)return r;return c("React").createElement("div",{key:k+s.message_id},r,u?c("React").createElement(c("MessagingGiftWrap.react"),{isSticker:true,onUnwrap:c("wrapNullableForReact")(t)}):null,v?c("React").createElement(c("MessagingFlowerBorder.react"),{offset:-10}):null)}};f.exports=p}),null);