if (self.CavalryLogger) { CavalryLogger.start_js(["XID1R"]); }

__d("MessengerComposerInput.react",["cx","fbt","Bootloader","CompositeDraftDecorator","DebouncedMentionsTextEditor.react","DraftModifier","DOMDimensions","EditorState","EmojiFormat","MessengerActions","MessengerDialog.react","messengerDialogBodyReact","MessengerDialogButton.react","MessengerDialogFooter.react","MessengerDialogHeader.react","MessengerEmojiSpan.react","MessengerEmoticonSpan.react","MessengerMentionsEntityDecorator.react","MessengerSingleSectionContactList.react","Event","immutable","MentionsLayer.react","MercuryIDs","MercuryThreadIDMap","MercuryThreadSnippet.react","MercuryThreadTitle.react","MercuryTimestamp","MercuryTriodeSourceUtil","MessengerBotMenuButton.react","MessengerConstants","messengerDomIDsRe","MessengerEditorStateManager","MessengerMentionSource","MessengerTabIndices","messengerUploadFilesUtilRe","MessengerURLUploader","React","ReactDOM","Run","TypingDetectorController","URLMatcher","clearImmediate","createMessengerMentionDraftEntity","createMentionsSearchSourceFromParticipants","debounce","getEntityMatcher","getEveryoneMentionIndex","getProfileRangesForContentState","getThreadTypeNameFromThreadType","getVisibleValueForContentStateWithMessengerEmoji","gkx","handleBeforeInputForMessengerEmoji","handleBeforeInputForMessengerEmoticon","handleSoftNewlineForMessengerEmoticon","insertEmoticonIntoEditorState","insertMentionIntoEditorState","insertMessengerEmojiIntoContentState","isSoftNewlineEvent","setImmediate","shouldNotRenderSegoe","throttle"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j,k,l=c("messengerDialogBodyReact").jsComponent,m=c("messengerDomIDsRe").ids,n=c("React").PropTypes,o=1,p=/^image\//,q="handled",r=8,s="not-handled";j=babelHelpers.inherits(t,c("React").PureComponent);k=j&&j.prototype;function t(w){__p&&__p();k.constructor.call(this,w);u.call(this);this.$MessengerInput11=this.$MessengerInput11.bind(this);this.state=this.$MessengerInput12();this.$MessengerInput6=c("debounce")(function(x){if(this.props.isComposing&&x.isComposing)return;if(!this.props.thread||!x.thread||v(this.props,x))this.$MessengerInput13()}.bind(this),300);this.$MessengerInput7=c("throttle")(function(){if(this.$MessengerInput10){var x=c("DOMDimensions").getElementDimensions(c("ReactDOM").findDOMNode(this)).height;if(this.$MessengerInput1!==x)this.props.onResize&&this.props.onResize();this.$MessengerInput1=x}}.bind(this),100)}t.prototype.$MessengerInput12=function(w){return{editorState:this.$MessengerInput14(c("MessengerEditorStateManager").get(this.props.threadID),w)}};t.prototype.componentDidMount=function(){this.$MessengerInput10=true;this.$MessengerInput1=c("DOMDimensions").getElementDimensions(c("ReactDOM").findDOMNode(this)).height;this.$MessengerInput13();this.$MessengerInput2=new(c("MessengerURLUploader"))(this.getValue,c("ReactDOM").findDOMNode(this.refs.input),this.props.threadID);c("Run").onUnload(this.$MessengerInput15);this.$MessengerInput3=c("Event").listen(window,"blur",this.$MessengerInput15);this.$MessengerInput4=c("Event").listen(window,"focus",this.$MessengerInput16);this.$MessengerInput5=c("debounce")(function(){this.$MessengerInput17()}.bind(this),1e3)};t.prototype.componentWillUpdate=function(w){if(this.props.threadID!==w.threadID)this.$MessengerInput17()};t.prototype.componentDidUpdate=function(w,x){this.$MessengerInput9=c("setImmediate")(this.$MessengerInput7);if(this.props.threadID!==w.threadID)this.$MessengerInput13();else this.$MessengerInput6(w);if(x.editorState!==this.state.editorState)this.props.onChange&&this.props.onChange(this.getValue())};t.prototype.componentWillUnmount=function(){this.$MessengerInput10=false;this.$MessengerInput8&&this.$MessengerInput8.destroy();this.props.threadID&&this.$MessengerInput17();this.$MessengerInput9&&c("clearImmediate")(this.$MessengerInput9);this.$MessengerInput3&&this.$MessengerInput3.remove();this.$MessengerInput4&&this.$MessengerInput4.remove()};t.prototype.insertEmoticon=function(w){var x=c("insertEmoticonIntoEditorState")(w,this.state.editorState);if(x!==this.state.editorState)this.$MessengerInput18(x)};t.prototype.insertEmoji=function(w){var x=this.state.editorState,y=c("insertMessengerEmojiIntoContentState")(c("EmojiFormat").codeArrayToCodeString(w),x.getCurrentContent(),x.getSelection(),x.getCurrentInlineStyle()),z=c("EditorState").push(x,y,"insert-characters");if(z!==this.state.editorState)this.$MessengerInput18(c("EditorState").forceSelection(z,y.getSelectionAfter()))};t.prototype.$MessengerInput20=function(){var w=this.props.fileUploader;return Boolean(w&&w.get("uploadedFiles").size>0)};t.prototype.$MessengerInput13=function(){__p&&__p();if(!this.$MessengerInput10)return;this.$MessengerInput21();this.$MessengerInput22();if(this.$MessengerInput2){this.$MessengerInput2.setThreadID(this.props.threadID);this.$MessengerInput2.clearShareData()}var w=this.$MessengerInput12();if(this.props.mentionsEnabled){var x=this.props,y=x.participants,z=x.viewer,A=x.thread;w.mentionsSource=c("createMentionsSearchSourceFromParticipants")(z,y&&y.toArray(),A,c("gkx")("AT49sw5n0nlIyoqYGYpRJXtOnRzCLqSpsmIoWA7hmyYTaoQcU5JHlDW_AWGZ_laa8hQ933FOWyuLNLlpGxYhTnOb"))}this.setState(w,function(){if(this.props.threadID!==c("MessengerConstants").NEW_THREAD_KEY)c("setImmediate")(function(){if(!this.props.disableAutofocus)this.focus()}.bind(this))}.bind(this))};t.prototype.$MessengerInput17=function(){if(!this.props.threadID)return;c("MessengerEditorStateManager").set(this.props.threadID,this.state.editorState)};t.prototype.$MessengerInput21=function(w){if(this.$MessengerInput2)this.$MessengerInput2.clearShareData();this.setState({editorState:this.$MessengerInput14(c("EditorState").createEmpty()),addedMentionsCount:0,mentionsTriggeredCount:0,mentionsTriggerSource:null,showEveryoneMentionDialog:false},w)};t.prototype.$MessengerInput22=function(){this.$MessengerInput8&&this.$MessengerInput8.destroy();this.$MessengerInput8=null;var w=this.props.viewer;if(!w)return;var x=c("ReactDOM").findDOMNode(this.refs.input);if(this.props.threadID!==c("MessengerConstants").NEW_THREAD_KEY&&x)this.$MessengerInput8=new(c("TypingDetectorController"))(c("MercuryIDs").getUserIDFromThreadID(this.props.threadID),x,c("MercuryTriodeSourceUtil").getMercuryTriodeSource(),null,c("MercuryThreadIDMap").getForFBID(w).getServerIDFromClientIDNow(this.props.threadID),this.getValue)};t.prototype.$MessengerInput23=function(){var w=this.props.fileUploader;if(w){c("messengerUploadFilesUtilRe").sendAttchments(w,this.props.onFileUpload);c("MessengerActions").cleanFiles(this.props.threadID)}};t.prototype.onEveryoneWarningAccept=function(){this.setState({showEveryoneMentionDialog:false},function(){if(this.props.thread){var w=this.getMentions(this.props.thread.thread_fbid);this.$MessengerInput24(w)}}.bind(this))};t.prototype.hideWarningDialog=function(){this.setState({showEveryoneMentionDialog:false})};t.prototype.getEveryoneMentionWarningDialog=function(){var w=i._("Mention everyone?").toString(),x=i._("Doing so will send a mention to everyone in this group.").toString();return c("React").createElement(c("MessengerDialog.react"),{onToggle:function(y){if(!y)this.hideWarningDialog()}.bind(this)},c("React").createElement(c("MessengerDialogHeader.react"),null,w),c("React").createElement(l,null,x),c("React").createElement(c("MessengerDialogFooter.react"),null,c("React").createElement(c("MessengerDialogButton.react"),{action:"cancel",label:i._("Cancel"),type:"secondary",onClick:function(){return this.hideWarningDialog()}.bind(this)}),c("React").createElement(c("MessengerDialogButton.react"),{label:i._("OK"),type:"primary",use:"default",onClick:function(){return this.onEveryoneWarningAccept()}.bind(this)})))};t.prototype.$MessengerInput25=function(){if(this.props.thread){var w=this.getMentions(this.props.thread.thread_fbid),x=c("getEveryoneMentionIndex")(w)>-1;if(x)this.setState({showEveryoneMentionDialog:x});else this.$MessengerInput24(w)}else this.$MessengerInput24()};t.prototype.$MessengerInput24=function(w){__p&&__p();if(this.props.onMessageSend&&this.props.onMessageSend(this.getValue(),{shareable_attachment:this.getShareData(),profile_ranges:w},function(x){var y,z=this;if(c("gkx")("AT5M-KOnq98igVULtzbIXLLujZOrcPEb_vzPxIrrMO4yDC59FjeQpdoZs2nMsaoB9WIY9SOWsfOkycr87iOYdoQQ"))c("MessengerActions").removeSharePreview(this.props.threadID);if(x&&this.props.mentionsEnabled&&(w&&w.length||this.state.addedMentionsCount||this.state.mentionsTriggeredCount||this.state.mentionsTriggerSource))(function(){var A=z.state,B=A.addedMentionsCount,C=A.mentionsTriggeredCount,D=A.mentionsTriggerSource,E=z.props,F=E.thread,G=E.participants,H=x;c("Bootloader").loadModules(["MessengerMentionsTypedLogger","MessengerMentionsLoggerEvents"],function(I,J){new I().setEvent(J.MENTION).setGroupSize(G&&G.size).setNumDelivered(w&&w.length||0).setNumSelects(B).setNumTriggers(C).setThreadid(F&&F.thread_id).setThreadType(c("getThreadTypeNameFromThreadType")(F&&F.thread_type)).setOfflineThreadid(H.offline_threading_id).updateExtraData({source:D}).log()},"MessengerComposerInput.react")})()}.bind(this)))this.$MessengerInput21(function(){this.$MessengerInput17();this.$MessengerInput8&&this.$MessengerInput8.resetState()}.bind(this))};t.prototype.getMentions=function(w){return c("getProfileRangesForContentState")(this.state.editorState.getCurrentContent(),w)};t.prototype.getInput=function(){return this.refs.input};t.prototype.render=function(){__p&&__p();var w=this.props,x=w.participants,y=w.thread,z=w.viewer,A=null;if(x&&y&&z)A=i._("Conversation with {participantListAsShownInThreadList}. Updated {lastUpdatedTime} by {recentUpdateStringAsShownInThreadList}",[i.param("participantListAsShownInThreadList",this.$MessengerInput26(y,z)),i.param("lastUpdatedTime",c("MercuryTimestamp").getAbsoluteTimestamp(y.timestamp)),i.param("recentUpdateStringAsShownInThreadList",this.$MessengerInput27(x,y,z))]);else A=i._("Composing a new message");var B=null;if(this.props.threadID&&this.props.pageID)B=c("React").createElement("div",{ref:"botsMenuContainer",className:"_3km1"},c("React").createElement(c("MessengerBotMenuButton.react"),{flyoutAlignment:"left",threadID:this.props.threadID,pageID:this.props.pageID,className:"_3km2"}));var C="";if(this.props.disableInput)C=i._("Composer is disabled for this thread.").toString();else if(this.props.thread&&!this.props.thread.is_canonical)C=i._("Type a message, \u0040name...").toString();else C=i._("Type a message...").toString();var D=this.getEveryoneMentionWarningDialog();return c("React").createElement("div",{className:"_kmc"+(this.props.smallerEqual640?" _2swd":"")+(c("shouldNotRenderSegoe")(this.state.editorState.getCurrentContent().getPlainText())?" _2por":"")+" navigationFocus",onClick:this.focus,role:"presentation"},this.state.showEveryoneMentionDialog?D:null,this.props.showMenu?B:null,c("React").createElement("div",{className:"_3-8x"+(this.props.showMenu?" _3km3":"")+" _3oh-"},c("React").createElement(c("DebouncedMentionsTextEditor.react"),{autoHighlight:true,ariaControls:m.CONVERSATION,ariaDescribedBy:m.COMPOSER_INPUT_DESCRIPTION,ariaLabel:C,editorState:this.state.editorState,handleBeforeInput:this.$MessengerInput28,handleContentReturn:this.$MessengerInput19,handlePastedFiles:this.$MessengerInput11,handleReturn:this.$MessengerInput19,maxResults:r,readOnly:this.props.disableInput,mentionCreationForContentStateFn:c("createMessengerMentionDraftEntity"),mentionResultsComponent:c("MentionsLayer.react"),mentionResultsProps:{typeaheadView:c("MessengerSingleSectionContactList.react"),typeaheadViewProps:{className:"_13iv",viewer:this.props.viewer},position:"above",autoflip:true},mentionsSource:this.state.mentionsSource,onChange:this.$MessengerInput18,placeholder:C,ref:"input",spellCheck:true,stripPastedStyles:true,tabIndex:this.props.threadID===c("MessengerConstants").NEW_THREAD_KEY?c("MessengerTabIndices").COMPOSER_INPUT:0,textAlignment:"left",onAddMention:this.$MessengerInput29,onShowMentions:this.$MessengerInput30}),c("React").createElement("div",{className:"_5ca7",id:m.COMPOSER_INPUT_DESCRIPTION},A)))};t.prototype.$MessengerInput26=function(w,x){return c("React").createElement(c("MercuryThreadTitle.react"),{thread:w,viewer:x})};t.prototype.$MessengerInput27=function(w,x,y){return c("React").createElement(c("MercuryThreadSnippet.react"),{participants:w,shouldAlwaysRenderSender:true,shouldRenderYou:true,thread:x,viewer:y})};t.prototype.$MessengerInput14=function(w,x){var y=this.$MessengerInput31(w),z=c("EditorState").set(w,{decorator:y});return x||this.props.disableAutofocus?z:c("EditorState").moveFocusToEnd(z)};t.prototype.$MessengerInput31=function(w){var x=c("MessengerEmoticonSpan.react"),y=w.getCurrentContent(),z=[{strategy:c("getEntityMatcher")(function(A){return A.getType()==="EMOTICON"},y.getEntity),component:x}];z.push({strategy:c("getEntityMatcher")(function(A){return A.getType()==="EMOJI"},y.getEntity),component:c("MessengerEmojiSpan.react")});z.push({strategy:c("getEntityMatcher")(function(A){return A.getType()==="MENTION"},y.getEntity),component:c("MessengerMentionsEntityDecorator.react")});return new(c("CompositeDraftDecorator"))(z)};t.prototype.$MessengerInput32=function(w,x){var y=c("handleBeforeInputForMessengerEmoticon")(x,w);if(y===x)return false;this.setState({editorState:y});return true};t.prototype.$MessengerInput33=function(w,x){var y=c("handleBeforeInputForMessengerEmoji")(x,w);if(y===x)return false;this.setState({editorState:y});return true};t.prototype.handleTextDropped=function(w){var x=this.state.editorState,y=x.getSelection();if(y.get("hasFocus"))return;var z=c("DraftModifier").replaceText(x.getCurrentContent(),y,w,x.getCurrentInlineStyle()),A=c("EditorState").push(x,z,"insert-fragment");this.$MessengerInput18(A)};t.prototype.getShareData=function(){__p&&__p();if(c("gkx")("AT5M-KOnq98igVULtzbIXLLujZOrcPEb_vzPxIrrMO4yDC59FjeQpdoZs2nMsaoB9WIY9SOWsfOkycr87iOYdoQQ")){var w=this.props.sharePreview;if(w&&w.type&&w.params)return{share_type:w.type,share_params:w.params.get("data")};return null}var x=c("URLMatcher").match(this.getValue());if(x===this.$MessengerInput2.getMatchedURL())return this.$MessengerInput2.getData();return null};t.prototype.exitCurrentMode=function(){this.refs.input&&this.refs.input.exitCurrentMode()};t.prototype.$MessengerInput34=function(){var w=this.props.sharePreview;return!!(w&&w.params&&w.type)};t.prototype.addMention=function(w){var x=c("insertMentionIntoEditorState")(w,this.state.editorState,0,c("createMessengerMentionDraftEntity"));if(!this.state.mentionsTriggerSource)this.setState({mentionsTriggerSource:c("MessengerMentionSource").REPLY});this.$MessengerInput18(x);this.$MessengerInput29()};t.propTypes={disableAutofocus:n.bool,fileUploader:n.object,handleOnlyImageUploads:n.bool.isRequired,isComposing:n.bool,mentionsEnabled:n.bool,pageID:n.string,participants:n.instanceOf(c("immutable").Map),sharePreview:n.object,showMenu:n.bool,disableInput:n.bool,smallerEqual640:n.bool,thread:n.object,threadID:n.string,viewer:n.string,onBeforeInput:n.func,onChange:n.func,onFileUpload:n.func,onResize:n.func,onMessageSend:n.func};var u=function u(){__p&&__p();this.$MessengerInput10=false;this.$MessengerInput18=function(w){if(w!==this.state.editorState)this.setState({editorState:w},function(){this.$MessengerInput5()}.bind(this))}.bind(this);this.$MessengerInput19=function(event,w){if(c("isSoftNewlineEvent")(event)){var x=c("handleSoftNewlineForMessengerEmoticon");this.setState({editorState:x(w)});return q}this.setState({},this.triggerSend);return q}.bind(this);this.getValue=function(){return c("getVisibleValueForContentStateWithMessengerEmoji")(this.state.editorState.getCurrentContent())}.bind(this);this.focus=function(){this.refs.input&&this.refs.input.focus()}.bind(this);this.$MessengerInput28=function(w,x){this.props.onBeforeInput&&this.props.onBeforeInput(w,x);var y=this.$MessengerInput32(w,x),z=this.$MessengerInput33(w,x);return y||z?q:s}.bind(this);this.$MessengerInput11=function(w){var x=this.props.handleOnlyImageUploads?w.filter(function(y){return y&&p.test(y.type)}):w;if(x.length){c("gkx")("AT5V6GuV7OE1f4CNmq1NUhZOeDrgnZF-AQ7WoOvZA8jFMJsYzyghwU79Bm31vgH-mi9DAlUGSFnfYvhwjhMfTolYEEzHhgUrhLD2UxTqbooHHw")?c("MessengerActions").prepareFilesForSend(this.props.threadID,x):this.props.onFileUpload(x);return q}return s}.bind(this);this.$MessengerInput15=function(){this.$MessengerInput17()}.bind(this);this.$MessengerInput16=function(){this.setState(this.$MessengerInput12(true))}.bind(this);this.triggerSend=function(){if(this.$MessengerInput20())this.$MessengerInput23();if(this.getValue().trim().length>0||this.$MessengerInput34())this.$MessengerInput25()}.bind(this);this.$MessengerInput29=function(){var w=(this.state.addedMentionsCount||0)+1;this.setState({addedMentionsCount:w})}.bind(this);this.$MessengerInput30=function(w,x){var y=(this.state.mentionsTriggeredCount||0)+1,z={mentionsTriggeredCount:y};if(!this.state.mentionsTriggerSource)z.mentionsTriggerSource=x===o?c("MessengerMentionSource").ATSIGN:c("MessengerMentionSource").TYPEAHEAD;this.setState(z)}.bind(this)};function v(w,x){var y=w.participants,z=x.participants;if(!y||!z)return true;var A=y.filter(Boolean),B=z.filter(Boolean);return A.size!==B.size||!A.equals(B)}f.exports=t}),null);