if (self.CavalryLogger) { CavalryLogger.start_js(["MPRbC"]); }

__d("MessengerRTCCallButton.react",["invariant","immutable","ImmutableObject","Link.react","MercuryIDs","MercuryThreadIDMap","messengerDialogsRe","MessengerRTCUnavailableDialog.react","messengerRTCVideoCallButtonReact","messengerRTCVoiceCallButtonReact","MessengerRTCFunnelLogger","MNRTCCallabilityStore","React","RTCCallState","StoreAndPropBasedStateMixin","FBRTCLogger"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=c("MercuryThreadIDMap").get(),j=c("messengerRTCVideoCallButtonReact").jsComponent,k=c("messengerRTCVoiceCallButtonReact").jsComponent,l=c("FBRTCLogger").Trigger,m=c("React").PropTypes,n=c("React").createClass({displayName:"MessengerRTCCallButton",mixins:[c("StoreAndPropBasedStateMixin")(c("MNRTCCallabilityStore"))],statics:{calculateState:function o(p){if(c("MercuryIDs").isGroupChat(p.threadID))return{isCallable:true};var q=c("MercuryIDs").getUserIDFromThreadID(p.threadID),r=q?c("MNRTCCallabilityStore").isCallable(q,p.thread):false;return{isCallable:r}}},propTypes:{className:m.string.isRequired,customColor:m.string.isRequired,isVideo:m.bool.isRequired,participants:m.instanceOf(c("immutable").Map).isRequired,thread:m.instanceOf(c("ImmutableObject")).isRequired,threadID:m.string.isRequired,viewer:m.string.isRequired,calleeName:m.string.isRequired},render:function o(){var p={customColor:this.props.customColor,isAvailable:this.state.isCallable,isGroupChat:c("MercuryIDs").isGroupChat(this.props.threadID)};return c("React").createElement(c("Link.react"),{className:this.props.className,onClick:this._handleStartCall},this.props.isVideo?c("React").createElement(j,p):c("React").createElement(k,p))},_handleStartCall:function o(p){__p&&__p();p.preventDefault();c("MessengerRTCFunnelLogger").startFunnel("FBMessagesPage");if(this.state.isCallable)if(c("MercuryIDs").isGroupChat(this.props.threadID)){c("MessengerRTCFunnelLogger").appendAction("start_in_group_thread");e(["FBRTCCore","FBRTCSupport","MessengerRTCGroupCallUnsupportedBrowserDialogController","MessengerRTCGroupCallParticipantsPickerDialogController"],function(q,r,s,t){__p&&__p();var u=this.props.thread.rtc_call_data;if(u&&u.call_state!==c("RTCCallState").NO_ONGOING_CALL&&u.server_info_data){c("MessengerRTCFunnelLogger").appendAction("join_existing_call");q.startGroupCall({conferenceName:"GROUP:"+this.props.thread.thread_fbid,hasVideo:this.props.isVideo,serverInfoData:u.server_info_data,trigger:u.call_state!==c("RTCCallState").AUDIO_GROUP_CALL?this.props.isVideo?l.MULTIWAY_THREAD_HEADER_JOIN_AUDIO_CALL_VIDEO_BUTTON:l.MULTIWAY_THREAD_HEADER_JOIN_AUDIO_CALL_AUDIO_BUTTON:this.props.isVideo?l.MULTIWAY_THREAD_HEADER_JOIN_VIDEO_CALL_VIDEO_BUTTON:l.MULTIWAY_THREAD_HEADER_JOIN_VIDEO_CALL_AUDIO_BUTTON});return}if(!r.isGroupCallWebtrcSupported()){c("MessengerRTCFunnelLogger").endFunnel("unsupported_browser");s.render({hasVideo:this.props.isVideo});return}var v=function(w){c("MessengerRTCFunnelLogger").appendAction("render_participant_picker");t.render({participants:this.props.participants.filter(function(x){var y=x.fbid;return y!==this.props.viewer}.bind(this)),thread:this.props.thread,viewerID:this.props.viewer,trigger:this.props.isVideo?l.MULTIWAY_THREAD_HEADER_VIDEO_BUTTON:l.MULTIWAY_THREAD_HEADER_AUDIO_BUTTON,conferenceName:"GROUP:"+w,hasVideo:this.props.isVideo})}.bind(this);if(c("MercuryIDs").isLocalThread(this.props.threadID))i.getServerIDFromClientID(this.props.threadID,function(w){return v(w)});else v(c("MercuryIDs").getThreadFBIDFromThreadID(this.props.threadID))}.bind(this))}else{c("MessengerRTCFunnelLogger").appendAction("start_in_p2p_thread");e(["FBRTCCore"],function(q){var r=c("MercuryIDs").getUserIDFromThreadID(this.props.threadID);r||h(0);q.startOutgoingCall(r,"messenger_dot_com",!this.props.isVideo)}.bind(this))}else{c("MessengerRTCFunnelLogger").endFunnel("callee_not_callable");c("messengerDialogsRe").showDialog(function(){return c("React").createElement(c("MessengerRTCUnavailableDialog.react"),{name:this.props.calleeName})}.bind(this))}}});f.exports=n}),null);