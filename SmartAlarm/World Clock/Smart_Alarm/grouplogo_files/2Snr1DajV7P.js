if (self.CavalryLogger) { CavalryLogger.start_js(["ofHtW"]); }

__d("FantaTypeFileUploader",["immutable"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=Object.freeze({ANIMATED_IMAGE:"animated_image",AUDIO:"audio",FILE:"file",GENERIC_ATTACHMENT:"generic_attachment",IMAGE:"image",VIDEO:"video"}),k={uploadedFiles:c("immutable").Map(),uploadingFiles:c("immutable").Map()};h=babelHelpers.inherits(l,c("immutable").Record(k));i=h&&h.prototype;l.prototype.getTypeIDs=function(m){return this.uploadedFiles.reduce(function(n,o){if(o.type===m&&o.uploadedID)n=n.concat(o.uploadedID);return n},[])};function l(){h.apply(this,arguments)}l.fileTypes=j;f.exports=l}),null);
__d("FantaTypeFileUploaderFile",["immutable"],(function a(b,c,d,e,f,g){"use strict";var h,i,j={file:{},id:"",startTime:0,type:null,uploadedID:null};h=babelHelpers.inherits(k,c("immutable").Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments)}f.exports=k}),null);
__d("MessengerUploadFilesStore",["fbt","Dialog","FantaTypeFileUploaderFile","FantaTypeFileUploader","immutable","MercuryConstants","MessengerActions","MessengerStore","PhotosUploadID"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j;i=babelHelpers.inherits(k,c("MessengerStore"));j=i&&i.prototype;function k(){j.constructor.call(this);this.$MessengerUploadFilesStore1=c("immutable").Map({})}k.prototype.getState=function(){return this.$MessengerUploadFilesStore1};k.prototype.__onDispatch=function(o){__p&&__p();var p=void 0,q=void 0,r=o.threadID,s=o.uploadID;switch(o.type){case c("MessengerActions").Types.PREPARE_FILES_FOR_SEND:var t=o.files;this.$MessengerUploadFilesStore1=l(this.$MessengerUploadFilesStore1,r,t);this.emitChange();break;case c("MessengerActions").Types.CANCEL_FILE_UPLOAD:p=this.$MessengerUploadFilesStore1.get(r);q=p.get("uploadingFiles").get(s);if(q)this.$MessengerUploadFilesStore1=this.$MessengerUploadFilesStore1.deleteIn([r,"uploadingFiles",s]);else{q=p.get("uploadedFiles").get(s);if(q)this.$MessengerUploadFilesStore1=this.$MessengerUploadFilesStore1.deleteIn([r,"uploadedFiles",s])}this.emitChange();break;case c("MessengerActions").Types.EMPTY_FILES:this.$MessengerUploadFilesStore1=this.$MessengerUploadFilesStore1.withMutations(function(u){if(u.get(r))u.set(r,new(c("FantaTypeFileUploader"))())});this.emitChange();break}};function l(o,p,q){__p&&__p();for(var r=0;r<q.length;r++){var s=q[r];if(s.size>c("MercuryConstants").AttachmentMaxSize){new(c("Dialog"))().setTitle(h._("The file you have selected is too large")).setBody(h._("The file you have selected is too large. The maximum size is 25MB.")).setButtons(c("Dialog").OK).setSemiModal(true).show();return o}}for(var t=0;t<q.length;t++){var u=q[t],v=n();o=m(o,p,v,u)}return o}function m(o,p,q,r){return o.withMutations(function(s){if(!s.get(p))s.set(p,new(c("FantaTypeFileUploader"))());var t=s.get(p);s.set(p,t.setIn(["uploadedFiles",q],new(c("FantaTypeFileUploaderFile"))({file:r,id:q,startTime:Date.now()})))})}function n(){return"upload_"+c("PhotosUploadID").getNewID()}f.exports=new k()}),null);