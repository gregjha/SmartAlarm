if (self.CavalryLogger) { CavalryLogger.start_js(["9LPnF"]); }

__d("MessengerConversationContainer.react",["Bootloader","immutable","ImmutableObject","mercuryBlockedParticipantsRe","mercuryIgnoredParticipantsRe","MercuryIDs","MercuryLogMessageType","MercuryMessageStore","MercuryThreadActions","MessagingTagConstants","MessengerActions","messengerBlockedGroupThreadWarningDialogReact","MessengerConfig","MessengerConversation.react","messengerDialogsRe","MessengerHotLikePreviewEvents","messengerIgnoredGroupThreadWarningDialogReact","MessengerLeaveGroupAction","React","SubscriptionsHandler","messengerServerErrorDialogReact","gkx"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=c("mercuryBlockedParticipantsRe").get(),k=c("mercuryIgnoredParticipantsRe").get(),l=c("MercuryThreadActions").get(),m=c("messengerServerErrorDialogReact").jsComponent,n=c("React").PropTypes,o=c("messengerBlockedGroupThreadWarningDialogReact").jsComponent,p=c("messengerIgnoredGroupThreadWarningDialogReact").jsComponent;h=babelHelpers.inherits(q,c("React").PureComponent);i=h&&h.prototype;function q(){__p&&__p();var r,s;for(var t=arguments.length,u=Array(t),v=0;v<t;v++)u[v]=arguments[v];return s=(r=i.constructor).call.apply(r,[this].concat(u)),this.state={isLoaded:false,isLoading:true,messages:c("immutable").List()},this.$MessengerConversationContainer2=undefined,this.$MessengerConversationContainer3=false,this.$MessengerConversationContainer4=undefined,this.$MessengerConversationContainer5=undefined,this.$MessengerConversationContainer6=undefined,this.$MessengerConversationContainer7=false,this.$MessengerConversationContainer15=function(){var w=this.props.thread;if(w==null)return;c("messengerBlockedGroupThreadWarningDialogReact").setWantsToSee(w.thread_id,true)}.bind(this),this.$MessengerConversationContainer18=function(){var w=this.props.thread;if(w==null)return;c("messengerIgnoredGroupThreadWarningDialogReact").setWantsToSee(w.thread_id,true)}.bind(this),this.$MessengerConversationContainer16=function(w){var x=this.props.thread;if(x==null)return;c("MessengerLeaveGroupAction").leaveGroup(x,this.props.viewer);this.$MessengerConversationContainer20(w)}.bind(this),this.$MessengerConversationContainer19=function(w){var x=this.props.thread;if(x==null)return;var y=x.thread_id;l.changeFolder(y,c("MessagingTagConstants").other);c("Bootloader").loadModules(["IgnoreMessagesTypedLogger","IgnoreMessagesLoggingEvent","IgnoreMessagesPlatforms"],function(z,A,B){new z().setEvent(A.IGNORE_CONFIRMED).setThreadID(c("MercuryIDs").getThreadFBIDFromThreadID(y)).setPlatform(B.MESSENGERDOTCOM).log()},"MessengerConversationContainer.react");this.$MessengerConversationContainer20(w)}.bind(this),this.$MessengerConversationContainer17=function(w){this.$MessengerConversationContainer20(w)}.bind(this),this.$MessengerConversationContainer13=function(){if(this.state.isLoading||this.state.isLoaded)return;this.setState({isLoading:true});if(!this.$MessengerConversationContainer1.fetchMoreMessages())this.setState({isLoading:false,isLoaded:true})}.bind(this),s}q.prototype.componentWillUnmount=function(){this.$MessengerConversationContainer2&&this.$MessengerConversationContainer2.release();clearTimeout(this.$MessengerConversationContainer6)};q.prototype.componentDidMount=function(){this.$MessengerConversationContainer8(this.props.threadID);if(this.$MessengerConversationContainer9())this.$MessengerConversationContainer10();else if(this.$MessengerConversationContainer11())this.$MessengerConversationContainer12()};q.prototype.componentDidUpdate=function(r){var s=this.props.threadID!==r.threadID;if(s)if(this.$MessengerConversationContainer9())this.$MessengerConversationContainer10(r.threadID);else if(this.$MessengerConversationContainer11())this.$MessengerConversationContainer12(r.threadID)};q.prototype.componentWillReceiveProps=function(r){if(this.props.threadID!==r.threadID){this.setState({isLoading:true,messages:c("immutable").List()});this.$MessengerConversationContainer8(r.threadID)}};q.prototype.render=function(){var r=this.state.messages,s=r.some(function(t){return t.log_message_type===c("MercuryLogMessageType").SERVER_ERROR});if(c("MessengerConfig").ErrorDialog&&s&&!this.$MessengerConversationContainer7)c("messengerDialogsRe").showDialog(function(){return c("React").createElement(m,{onMount:function(){return this.$MessengerConversationContainer7=true}.bind(this)})}.bind(this));return c("React").createElement(c("MessengerConversation.react"),{className:this.props.className,contact:this.props.contact,fetchMessages:this.$MessengerConversationContainer13,isCanonical:c("MercuryIDs").isCanonical(this.props.threadID),isLoading:this.state.isLoading,isLoaded:this.state.isLoaded,messages:this.state.messages,onRead:this.props.onMarkRead,onVoiceClipCreate:this.props.onVoiceClipCreate,participants:this.props.participants,ref:"conversation",thread:this.props.thread,threadID:this.props.threadID,viewer:this.props.viewer})};q.prototype.handleResize=function(){this.refs.conversation.handleResize()};q.prototype.isScrolledToBottom=function(){return!!(this.refs.conversation&&this.refs.conversation.isScrolledToBottom())};q.prototype.$MessengerConversationContainer9=function(){__p&&__p();var r=this.props.thread;if(r==null)return false;var s=r.thread_id;if(!this.$MessengerConversationContainer14())return false;if(!j.isPresentInGroupThread(r))return false;var t=c("messengerBlockedGroupThreadWarningDialogReact").getWantsToSee(s);if(t)return false;return true};q.prototype.$MessengerConversationContainer11=function(){__p&&__p();var r=this.props.thread;if(r==null)return false;var s=r.thread_id;if(!this.$MessengerConversationContainer14())return false;if(r.folder!=="inbox")return false;if(!k.isPresentInGroupThread(r))return false;var t=c("messengerIgnoredGroupThreadWarningDialogReact").getWantsToSee(s);if(t)return false;return c("gkx")("AT4mycXtTvfXJMAqrd_BSmI0_EEB-8pOs_AaNI2VArui1ThGLeffrrAudIg_2uctK6Ji6Zom3olu5BpcCU5_nD4U")};q.prototype.$MessengerConversationContainer14=function(){var r=this.props.thread;if(r==null)return false;if(c("MercuryIDs").isCanonical(this.props.threadID))return false;if(!r.is_subscribed)return false;return true};q.prototype.$MessengerConversationContainer10=function(r){c("messengerDialogsRe").showDialog(function(){return c("React").createElement(o,{onSee:this.$MessengerConversationContainer15,onLeave:this.$MessengerConversationContainer16,onCancel:this.$MessengerConversationContainer17,prevThreadID:r})}.bind(this))};q.prototype.$MessengerConversationContainer12=function(r){c("messengerDialogsRe").showDialog(function(){return c("React").createElement(p,{onSee:this.$MessengerConversationContainer18,onIgnore:this.$MessengerConversationContainer19,onCancel:this.$MessengerConversationContainer17,prevThreadID:r,threadID:c("MercuryIDs").getThreadFBIDFromThreadID(this.props.threadID)})}.bind(this))};q.prototype.$MessengerConversationContainer20=function(r){if(r==null)c("MessengerActions").selectThread(null);c("MessengerActions").selectThread(r)};q.prototype.$MessengerConversationContainer8=function(r){__p&&__p();if(!r)return;this.setState({isLoaded:false});this.$MessengerConversationContainer1&&this.$MessengerConversationContainer1.destroy();this.$MessengerConversationContainer7=false;this.$MessengerConversationContainer1=new(c("MercuryMessageStore"))(r,c("MessengerConfig").MessageLoadCount);clearTimeout(this.$MessengerConversationContainer6);this.$MessengerConversationContainer6=setTimeout(function(){if(this.props.thread&&this.props.thread.message_count<1)this.setState({isLoaded:true,isLoading:false})}.bind(this),6e3);this.$MessengerConversationContainer2&&this.$MessengerConversationContainer2.release();this.$MessengerConversationContainer2=new(c("SubscriptionsHandler"))();this.$MessengerConversationContainer2.addSubscriptions(this.$MessengerConversationContainer1.subscribe(function(s){this.setState({messages:this.$MessengerConversationContainer21(c("immutable").List(s.messages)),isLoading:false})}.bind(this)),c("MessengerHotLikePreviewEvents").addListener(c("MessengerHotLikePreviewEvents").START,function(s){this.$MessengerConversationContainer3=true;this.$MessengerConversationContainer4=s;this.setState({messages:this.$MessengerConversationContainer21(this.state.messages)});clearInterval(this.$MessengerConversationContainer5);this.$MessengerConversationContainer5=setInterval(this.refs.conversation.scrollToBottom,50)}.bind(this)),c("MessengerHotLikePreviewEvents").addListener(c("MessengerHotLikePreviewEvents").FINISH_ANIMATION,function(r){clearInterval(this.$MessengerConversationContainer5)}.bind(this)),c("MessengerHotLikePreviewEvents").addListener(c("MessengerHotLikePreviewEvents").FINISH_EMOJI_ANIMATION,function(r){clearInterval(this.$MessengerConversationContainer5)}.bind(this)),c("MessengerHotLikePreviewEvents").addListener(c("MessengerHotLikePreviewEvents").STOP,function(){this.$MessengerConversationContainer3=false;this.$MessengerConversationContainer4=null}.bind(this)),c("MessengerHotLikePreviewEvents").addListener(c("MessengerHotLikePreviewEvents").STOP_EMOJI,function(){this.$MessengerConversationContainer3=false;this.$MessengerConversationContainer4=null}.bind(this)),c("MessengerHotLikePreviewEvents").addListener(c("MessengerHotLikePreviewEvents").REMOVE,function(){clearInterval(this.$MessengerConversationContainer5);this.$MessengerConversationContainer3=false;this.setState({messages:this.$MessengerConversationContainer21(this.state.messages)})}.bind(this)))};q.prototype.$MessengerConversationContainer21=function(r){if(this.$MessengerConversationContainer3)r=r.set(r.size,this.$MessengerConversationContainer4);else{r=r.filterNot(function(s){return s.is_like_preview});this.$MessengerConversationContainer4=null}return r};q.propTypes={contact:n.instanceOf(c("ImmutableObject")),onMarkRead:n.func.isRequired,onVoiceClipCreate:n.func,participants:n.instanceOf(c("immutable").Map),thread:n.object,threadID:n.string.isRequired,viewer:n.string.isRequired};f.exports=q}),null);