if (self.CavalryLogger) { CavalryLogger.start_js(["eDfcR"]); }

__d("MessengerThreadPhotoUploader.react",["cx","fbt","FileInput","FileInputUploader","Link.react","MercuryConfig","React","ReactDOM","SubscriptionsHandler"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j=c("React").PropTypes,k=c("React").createClass({displayName:"MessengerThreadPhotoUploader",_fileInput:null,_subscriptions:null,_uploader:null,_uploadIsInProgress:false,propTypes:{onComplete:j.func.isRequired,onFail:j.func,onStart:j.func,uri:j.string},getDefaultProps:function l(){return{uri:c("MercuryConfig").upload_url}},componentDidMount:function l(){var m=c("ReactDOM").findDOMNode(this.refs.input),n=new(c("FileInput"))(c("ReactDOM").findDOMNode(this.refs.form),c("ReactDOM").findDOMNode(this.refs.uploadButton),m),o=new(c("FileInputUploader"))(m).setURI(this.props.uri).setAllowCrossOrigin(true).setAllowCrossPageTransition(true).setData({images_only:true}),p=new(c("SubscriptionsHandler"))();p.addSubscriptions(o.subscribe("success",this._handleAllUploadsCompleted),o.subscribe("failure",this._handleLastUploadFailed));this._subscriptions=p;this._uploader=o;this._fileInput=n},componentWillUnmount:function l(){if(!this._uploadIsInProgress)this._doUnmountComponents()},render:function l(){var m=i._("Click to change the image");return c("React").createElement("form",{action:this.props.uri,method:"post",ref:"form"},c("React").createElement("input",{type:"hidden",name:"attach_id",ref:"attachID"}),c("React").createElement("input",{type:"hidden",name:"images_only",value:"true"}),c("React").createElement("div",{className:"_m _4q60 _2lyy"},c("React").createElement(c("Link.react"),{className:"_4q61 _2lyz",ref:"uploadButton"},i._("edit")),c("React").createElement("input",{type:"file",className:"_n",name:"attachment[]",accept:".jpg,.png,.jpeg,.bmp,.tif,.tiff",ref:"input",onChange:this._handleFileInputChange,title:m})))},_handleAllUploadsCompleted:function l(m,n){this._uploadIsInProgress=false;this.props.onComplete&&this.props.onComplete(n.response.payload);if(!this.isMounted())this._doUnmountComponents()},_handleLastUploadFailed:function l(m,n){this._uploadIsInProgress=false;this.props.onFail&&this.props.onFail(n);if(!this.isMounted())this._doUnmountComponents()},_handleFileInputChange:function l(m){if(m.target.value&&this._uploader){this._uploader.send();this._uploadIsInProgress=true;this.props.onStart&&this.props.onStart()}},_doUnmountComponents:function l(){this._subscriptions&&this._subscriptions.release();this._fileInput&&this._fileInput.destroy();delete this._subscriptions;delete this._uploader}});f.exports=k}),null);